<!doctype html>
<html data-n-head-ssr>
  <head >
    <title>Kubernetes高可用集群二进制安装</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover"><meta data-n-head="ssr" name="google-site-verification" content="cCHsgG9ktuCTgWgYfqCJql8AeR4gAne4DTZqztPoirE"><meta data-n-head="ssr" name="google-site-verification" content="nPvn9R5NJLsZKTv5VKIbn0OmkRcJ4PC6KdDoTX3n5Mw"><meta data-n-head="ssr" name="apple-itunes-app" content="app-id=987739104"><meta data-n-head="ssr" name="baidu-site-verification" content="qiK2a1kcFc"><meta data-n-head="ssr" name="360-site-verification" content="4c3c7d57d59f0e1a308462fbc7fd7e51"><meta data-n-head="ssr" name="sogou_site_verification" content="c49WUDZczQ"><meta data-n-head="ssr" name="msapplication-config" content="https://b-gold-cdn.xitu.io/favicons/v2/browserconfig.xml"><meta data-n-head="ssr" name="theme-color" content="#ffffff"><meta data-n-head="ssr" vmid="keywords" name="keywords" content="掘金,稀土,Vue.js,微信小程序,Kotlin,RxJava,React Native,Wireshark,敏捷开发,Bootstrap,OKHttp,正则表达式,WebGL,Webpack,Docker,MVVM"><meta data-n-head="ssr" vmid="description" name="description" content="掘金是一个帮助开发者成长的社区，是给开发者用的 Hacker News，给设计师用的 Designer News，和给产品经理用的 Medium。掘金的技术文章由稀土上聚集的技术大牛和极客共同编辑为你筛选出最优质的干货，其中包括：Android、iOS、前端、后端等方面的内容。用户每天都可以在这里找到技术世界的头条内容。与此同时，掘金内还有沸点、掘金翻译计划、线下活动、专栏文章等内容。即使你是 GitHub、StackOverflow、开源中国的用户，我们相信你也可以在这里有所收获。"><meta data-n-head="ssr" vmid="keywords" name="keywords" content="Kubernetes"><meta data-n-head="ssr" vmid="description" name="description" content="&lt;section style=&quot;font-size: 16px; color: black; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-bre"><link data-n-head="ssr" rel="apple-touch-icon" sizes="180x180" href="https://b-gold-cdn.xitu.io/favicons/v2/apple-touch-icon.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="32x32" href="https://b-gold-cdn.xitu.io/favicons/v2/favicon-32x32.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="16x16" href="https://b-gold-cdn.xitu.io/favicons/v2/favicon-16x16.png"><link data-n-head="ssr" rel="manifest" href="https://b-gold-cdn.xitu.io/favicons/v2/manifest.json"><link data-n-head="ssr" rel="mask-icon" color="#5bbad5" href="https://b-gold-cdn.xitu.io/favicons/v2/safari-pinned-tab.svg"><link data-n-head="ssr" rel="shortcut icon" href="https://b-gold-cdn.xitu.io/favicons/v2/favicon.ico"><link data-n-head="ssr" rel="search" title="掘金" href="https://b-gold-cdn.xitu.io/conf/search.xml" type="application/opensearchdescription+xml"><link data-n-head="ssr" rel="stylesheet" href="https://b-gold-cdn.xitu.io/ionicons/2.0.1/css/ionicons.min.css"><link data-n-head="ssr" rel="stylesheet" href="https://b-gold-cdn.xitu.io/asset/fw-icon/1.0.9/iconfont.css"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/runtime.114be94.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/app.f6a55cd.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/vendors~app.75ea36e.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/app.6946cbd.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/layouts/default.30f8654.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/layouts.default.e3ae69c.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/16.042eec3.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/.c96a556.js" as="script"><style data-vue-ssr-id="6d4e8b07:0 580fe052:0 19f03031:0 50f339e4:0 bc0d363a:0 336652cb:0 0094bb9d:0 190e79e4:0 10d680ba:0 291dc925:0 0df5c402:0 6d1bad94:0 451eb286:0 c277c556:0 7192d33a:0">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}@font-face{font-family:iconfont;src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358);src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358#iefix) format("embedded-opentype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.woff?t=1470110358) format("woff"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.ttf?t=1470110358) format("truetype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.svg?t=1470110358#iconfont) format("svg")}.iconfont{font-family:iconfont!important;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-xlcollection:before{content:"\e600"}.icon-xlchatbox:before{content:"\e601"}.article-content{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.article-content h1{margin:1.3rem 0;line-height:1.2}.article-content p{line-height:2.27rem}.article-content hr{border:none;border-top:1px solid #ddd;margin-top:2.7rem;margin-bottom:2.7rem}.article-content embed,.article-content iframe,.article-content img:not(.equation),.article-content video{max-width:100%!important;margin:0}.article-content img.lazyload{visibility:hidden}.article-content img.inited{background-color:#f8f9fa;background-position:50%;background-repeat:no-repeat;visibility:visible}.article-content img.loaded{background-image:none;background-color:transparent}.article-content img.error{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/image-error.3338abe.png)}.article-content img.equation{margin:0 .1em;max-width:100%!important;vertical-align:middle}.article-content img:not(.equation){cursor:zoom-in}.article-content figure{margin:2.7rem auto;text-align:center}.article-content figure figcaption{text-align:center;font-size:1rem;line-height:2.7rem;color:#909090}.article-content pre{line-height:1.93rem;overflow:auto}.article-content code,.article-content pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.article-content code{font-size:1rem;padding:.26rem .53em;word-break:break-word;color:#4e5980;background-color:#f8f8f8;border-radius:2px;overflow-x:auto}.article-content pre>code{font-size:1rem;padding:.67rem 1.3rem;margin:0;word-break:normal;display:block}.article-content a{color:#259}.article-content a:active,.article-content a:hover{color:#275b8c}.article-content table{display:inline-block!important;font-size:1rem;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.article-content thead{background:#f6f6f6;color:#000;text-align:left}.article-content tr:nth-child(2n){background-color:#fcfcfc}.article-content td,.article-content th{padding:1rem .6rem;line-height:2rem}.article-content td{min-width:10rem}.article-content blockquote{margin:1em 0;border-left:4px solid #ddd;padding:0 1.3rem}.article-content blockquote>p{margin:.6rem 0}.article-content ol,.article-content ul{padding-left:2.7rem}.article-content ol li,.article-content ul li{margin-bottom:.6rem}.article-content ol ol,.article-content ol ul,.article-content ul ol,.article-content ul ul{margin-top:.27rem}.article-content pre>code{overflow-x:auto;-webkit-overflow-scrolling:touch;color:#333;background:#f8f8f8}.article-content .hljs-comment,.article-content .hljs-quote{color:#998}.article-content .hljs-keyword,.article-content .hljs-selector-tag,.article-content .hljs-subst{color:#333;font-weight:700}.article-content .hljs-literal,.article-content .hljs-number,.article-content .hljs-tag .hljs-attr,.article-content .hljs-template-variable,.article-content .hljs-variable{color:teal}.article-content .hljs-doctag,.article-content .hljs-string{color:#d14}.article-content .hljs-section,.article-content .hljs-selector-id,.article-content .hljs-title{color:#900;font-weight:700}.article-content .hljs-subst{font-weight:400}.article-content .hljs-class .hljs-title,.article-content .hljs-type{color:#458;font-weight:700}.article-content .hljs-attribute,.article-content .hljs-name,.article-content .hljs-tag{color:navy;font-weight:400}.article-content .hljs-link,.article-content .hljs-regexp{color:#009926}.article-content .hljs-bullet,.article-content .hljs-symbol{color:#990073}.article-content .hljs-built_in,.article-content .hljs-builtin-name{color:#0086b3}.article-content .hljs-meta{color:#999;font-weight:700}.article-content .hljs-deletion{background:#fdd}.article-content .hljs-addition{background:#dfd}.article-content .hljs-emphasis{font-style:italic}.article-content .hljs-strong{font-weight:700}.article-content p{line-height:inherit;margin-top:22px;margin-bottom:22px}.article-content img{max-height:none}.article-content a{color:#0269c8;border-bottom:1px solid #d1e9ff}.article-content code{background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.article-content figure{margin:22px auto}.article-content figure figcaption{margin-top:2px;line-height:1.6}.article-content blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.article-content blockquote:after{display:block;content:""}.article-content blockquote>p{margin:10px 0}.article-content blockquote.warning{position:relative;border-left-color:#f75151;margin-left:8px}.article-content blockquote.warning:before{position:absolute;top:14px;left:-12px;background:#f75151;border-radius:50%;content:"!";width:20px;height:20px;color:#fff;display:flex;align-items:center;justify-content:center}.article-content ol,.article-content ul{padding-left:28px}.article-content ol li,.article-content ul li{margin-bottom:0;list-style:inherit}.article-content ol li.task-list-item,.article-content ul li.task-list-item{list-style:none}.article-content ol li.task-list-item ol,.article-content ol li.task-list-item ul,.article-content ul li.task-list-item ol,.article-content ul li.task-list-item ul{margin-top:0}.article-content ol li{padding-left:6px}.article-content pre{position:relative;line-height:1.75}.article-content pre>code{padding:15px 12px}.article-content pre>code.hljs[lang]{padding:18px 15px 12px}.article-content pre>code.hljs[lang]:before{content:attr(lang);position:absolute;right:15px;top:2px;color:hsla(0,0%,54.9%,.8)}.article-content pre>code.hljs[lang][lang=bash]:before{content:""}.article-content pre>code.copyable .copy-code-btn{position:absolute;top:6px;right:15px;font-size:12px;line-height:1;cursor:pointer;color:hsla(0,0%,54.9%,.8);transition:color .1s}.article-content pre>code.copyable .copy-code-btn:hover{color:#8c8c8c}.article-content pre>code.copyable.hljs[lang]:before{right:70px}.article-content h1,.article-content h2,.article-content h3,.article-content h4,.article-content h5,.article-content h6{color:#333;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.article-content h1{font-size:30px;margin-bottom:5px}.article-content h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.article-content h3{font-size:18px;padding-bottom:0}.article-content h4{font-size:16px}.article-content h5{font-size:15px}.article-content h6{margin-top:5px}.article-content h1.heading+h2.heading{margin-top:20px}.article-content h1.heading+h3.heading{margin-top:15px}.article-content .heading+.heading{margin-top:0}.article-content h1+:not(.heading){margin-top:25px}@media (max-width:720px){.article-content h1{font-size:24px}.article-content h2{font-size:20px}.article-content h3{font-size:18px}.article-content pre>code .copy-code-btn{display:none}.article-content pre>code.hljs[lang]:before{top:2px;right:15px}}@media (max-width:720px){.article-content pre>code.copyable.hljs[lang]:before{right:1rem}}#nprogress{pointer-events:none}#nprogress .bar{background:#007fff;position:fixed;z-index:1031;top:0;left:0;width:100%;height:2px}#nprogress .peg{display:block;position:absolute;right:0;width:100px;height:100%;box-shadow:0 0 10px #007fff,0 0 5px #007fff;opacity:1;transform:rotate(3deg) translateY(-4px)}.nprogress-custom-parent{overflow:hidden;position:relative}.nprogress-custom-parent #nprogress .bar,.nprogress-custom-parent #nprogress .spinner{position:absolute}@-webkit-keyframes nprogress-spinner{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes nprogress-spinner{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}body{font-size:12px;line-height:normal}a,button,input{margin:initial}img{width:auto;height:auto}#juejin{overflow-x:visible;overflow-x:initial}html{font-size:12px;font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;word-break:break-word;text-rendering:optimizeLegibility;color:#333;background-color:#f4f5f5}html.white{background-color:#fff}body{word-break:break-word;overflow-y:scroll}a{text-decoration:none;cursor:pointer;color:#909090}a:hover{color:#007fff}button{list-style:1}button:disabled{cursor:not-allowed}button.disabled,button.disabled:hover{background-color:#d2d2d2;cursor:not-allowed}ul{padding:0;margin:0}li{list-style:none}#juejin-seo-meta{display:none}.container{position:relative;margin:0 auto;width:100%;max-width:960px}.container:after{display:table;content:"";clear:both}.hidden{display:none}.root-view-bg{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:-1}.shadow{box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}.align-center{text-align:center}.align-right{text-align:right}.align-middle{vertical-align:middle}.center{margin-left:auto;margin-right:auto}.text-normal{color:#333}.text-muted{color:#666}.text-muted1{color:#909090}.text-muted2{color:#838383}.text-gray{color:#909090}.text-light{color:#d2d2d2}.text-blue{color:#007fff}.text-blue-hover{color:#0371df}.text-green{color:#37c700}.text-green-hover{color:#3cb40e}.text-orange{color:#ff8900}.text-red{color:#e22323}.text-a,.text-link{cursor:pointer;color:#333}@include transition(color $speed-normal);.text-a:active,.text-a:hover,.text-link:active,.text-link:hover{color:#275b8c}.text-link{color:#259}.text-pointer{cursor:pointer}.line-wrap{white-space:pre-wrap;word-break:break-all}.ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.text-bold,b,strong{font-weight:700}.view-nav{position:fixed;top:5rem;width:100%;height:3.833rem;z-index:100;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);transition:all .2s;transform:translateZ(0)}.view-nav,.view-nav:before{left:0;background-color:#fff}.view-nav:before{content:"";position:absolute;right:0;bottom:0;height:200%;z-index:-1}.view-nav.top{transform:translate3d(0,-5rem,0)}.view-nav .nav-list{max-width:960px;height:100%;margin:auto;display:flex;align-items:center;line-height:1}.view-nav .nav-list .nav-item{height:100%;align-items:center;display:flex;flex-shrink:0;font-size:1.16rem;color:#71777c;padding:0 1rem}.view-nav .nav-list .nav-item:first-child{padding:0 1rem 0 0}.view-nav .nav-list .nav-item:last-child{padding:0 0 0 1rem}.view-nav .nav-list .nav-item.active,.view-nav .nav-list .nav-item:hover{color:#007fff}.view-nav .nav-list .nav-item a{color:inherit}.nav-item{position:relative;cursor:pointer}.nav-item>a:before{content:"";position:absolute;top:0;right:0;bottom:0;left:0}@media (max-width:980px){.view-nav .nav-list{width:auto;overflow-x:auto}.view-nav .nav-list .nav-item:first-child,.view-nav .nav-list .nav-item:last-child{padding:0 1.5rem}}.list-header{padding:1.3rem 1rem;border-bottom:1px solid hsla(0,0%,59.2%,.1)}.list-header .list-nav,.list-header .nav-list{display:flex;justify-content:space-between}.list-header .nav-list{align-items:center;line-height:1}.list-header .nav-list .nav-item.active a,.list-header .nav-list .nav-item a:hover{color:#007fff}.list-header .left .nav-item{padding:0 1.2rem;font-size:1.16rem;border-right:1px solid hsla(0,0%,59.2%,.2)}.list-header .left .nav-item:last-child{border:none}.list-header .right .nav-item{font-size:1.16rem;padding:0 .7rem;position:relative}.list-header .right .nav-item:not(:last-child):after{width:2px;height:2px;border-radius:50%;transform:translate(-50%,-50%);content:"";position:absolute;left:100%;top:50%;background-color:#2b445d;transform:translateY(-50%);opacity:.5}@media (max-width:600px){.list-header .right{display:none}}.button,button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#007fff;color:#fff;border-radius:2px;border:none;padding:.5rem 1.3rem;outline:none;transition:background-color .3s,color .3s;cursor:pointer}.button:hover,button:hover{background-color:#0371df;color:#fff}i+span{margin-left:.6rem}button+button{margin-left:.8rem}.subscribe-btn{border:1px solid #37c700;background-color:#fff;color:#37c700;margin:1rem auto;font-size:1.1rem}.subscribe-btn:hover{background-color:#fff;color:#3cb40e;border-color:#3cb40e}.subscribe-btn.subscribed{background-color:#37c700;color:#fff}.subscribe-btn.subscribed:hover{background-color:#3cb40e}.radio-group{cursor:pointer;display:flex;align-items:center;font-size:14px}.radio-group .radio-label{margin-left:6px}input[type=radio]{width:16px;height:16px;border:1px solid #bfcbd9;border-radius:50%;background-color:#fff;cursor:pointer;box-sizing:border-box;position:relative;outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none}input[type=radio]:after{width:6px;height:6px;border-radius:50%;background-color:#fff;content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(0);transition:transform .15s cubic-bezier(.71,-.46,.88,.6)}input[type=radio]:checked{border-color:#20a0ff;background:#3a9afc}input[type=radio]:checked:after{transform:translate(-50%,-50%) scale(1)}input[type=radio]:disabled{background-color:#eef1f6;border-color:#d1dbe5;cursor:not-allowed}input[type=radio]:disabled:checked{border-color:#d1dbe5;background-color:#d1dbe5}input[name=registerSmsCode]::-webkit-contacts-auto-fill-button{display:none;visibility:hidden}.editable,input[type=password],input[type=text],input[type=url],textarea{resize:none;outline:none;width:100%;display:block;box-shadow:none;border:1px solid #ddd;border-radius:2px;transition:border .3s;background-color:#fff;box-sizing:border-box}.aside-top-section{background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);border-radius:2px;margin-bottom:1.3rem;font-size:1.16rem;line-height:1.29;color:#333}.aside-top-section .aside-header{padding:1rem 1.3rem;border-bottom:1px solid hsla(0,0%,59.2%,.1);color:#333;font-size:1.16rem}.aside-top-section .aside-list{padding:1rem 1.3rem}.aside-top-section .aside-list .item{margin-bottom:1.5rem}.busy-icon:before{-webkit-animation:busy-ani 1s linear infinite;animation:busy-ani 1s linear infinite}@-webkit-keyframes busy-ani{to{transform:rotate(1turn)}}@keyframes busy-ani{to{transform:rotate(1turn)}}
.request-health-alert[data-v-ded0787a]{position:fixed;left:2rem;bottom:2rem;padding:1rem;max-width:50%;color:#e33;background-color:#f6e3e3;border:1px solid #e99;z-index:10000}@media (max-width:600px){.request-health-alert[data-v-ded0787a]{display:none}}.title[data-v-ded0787a]{margin:0 0 .4em;font-size:1.5em}.content[data-v-ded0787a]{line-height:1.5}.btn[data-v-ded0787a]{color:inherit;text-decoration:underline;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.close[data-v-ded0787a]{position:absolute;top:0;right:0;padding:1rem;cursor:pointer;opacity:.5}.close[data-v-ded0787a]:hover{opacity:1}
.emoji-barrage .full-screen[data-v-68506677]{position:fixed;left:0;top:0;width:100%;height:100%;z-index:1001;overflow:hidden}.emoji-inner-screen[data-v-68506677]{position:absolute;left:0;width:100%;height:100%;transform:translate3d(-100%,-100%,0)}.emoji-inner-screen .template[data-v-68506677]{position:relative;width:100%;height:100%}.emojin-inner-screen__0.animate[data-v-68506677]{-webkit-animation:left-data-v-68506677 6s ease-in;animation:left-data-v-68506677 6s ease-in}.emojin-inner-screen__1.animate[data-v-68506677]{-webkit-animation:6s ease-in normal-data-v-68506677;animation:6s ease-in normal-data-v-68506677}.emojin-inner-screen__2.animate[data-v-68506677]{-webkit-animation:right-data-v-68506677 6s ease-in;animation:right-data-v-68506677 6s ease-in}@-webkit-keyframes left-data-v-68506677{0%{transform:translate3d(-50%,-100%,0)}to{transform:translate3d(0,100%,0)}}@keyframes left-data-v-68506677{0%{transform:translate3d(-50%,-100%,0)}to{transform:translate3d(0,100%,0)}}@-webkit-keyframes normal-data-v-68506677{0%{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,100%,0)}}@keyframes normal-data-v-68506677{0%{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,100%,0)}}@-webkit-keyframes right-data-v-68506677{0%{transform:translate3d(50%,-100%,0)}to{transform:translate3d(0,100%,0)}}@keyframes right-data-v-68506677{0%{transform:translate3d(50%,-100%,0)}to{transform:translate3d(0,100%,0)}}
.modal-mask[data-v-6217922a]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3);z-index:501}.bind-phone-number-form[data-v-6217922a]{position:fixed;padding:1.83rem 2.08rem;width:26.5rem;max-width:100%;font-size:1.167rem;background-color:#fff;border-radius:3px;box-sizing:border-box;top:50%;left:50%;z-index:502;transform:translate(-50%,-60%);box-shadow:0 2px 3px 0 rgba(0,0,0,.2)}.close-btn[data-v-6217922a]{float:right;cursor:pointer;opacity:.4}.close-btn[data-v-6217922a]:hover{opacity:1}.title[data-v-6217922a]{font-size:1.42rem;color:#000;font-weight:600;margin:0 0 1rem}.hint[data-v-6217922a]{font-size:1.25rem;line-height:1.6;font-weight:400;color:#000;margin-bottom:2rem}.hint>a[data-v-6217922a]{color:#007fff}.input-group[data-v-6217922a]{margin-bottom:1.5rem}.input-box[data-v-6217922a]{position:relative;margin-bottom:.8rem}.dropdown-box[data-v-6217922a]{padding:0 10px;border:1px solid #d9d9d9;display:flex;border-radius:2px;justify-content:center;align-items:center}.dropdown-box .input[data-v-6217922a]{border:none}.dropdown-box.focus[data-v-6217922a]{border-color:#007fff}.input[data-v-6217922a]{width:100%;border:1px solid #e9e9e9;border-radius:2px;outline:none;box-sizing:border-box;padding:.67rem .67rem .67rem 4px}.input[data-v-6217922a]:focus{border-color:#007fff}.number-input[data-v-6217922a]{width:74%}.btn[data-v-6217922a]{width:100%;height:2.92rem;color:#fff;background-color:#007fff;border-radius:2px;outline:none;box-sizing:border-box;cursor:pointer}.btn[data-v-6217922a]:disabled{background-color:#909090;cursor:default}.vcode-box[data-v-6217922a]{display:flex;justify-content:center;align-items:center}.vcode-box .input[data-v-6217922a]{width:auto;flex-grow:1;overflow:hidden}.vcode-box .img-vcode[data-v-6217922a]{border:1px solid #ddd;position:relative;box-sizing:border-box;overflow:hidden;z-index:0;width:160px;color:#333;height:40px;margin-left:15px;flex-shrink:0}.vcode-box .img-vcode img[data-v-6217922a]{max-height:46px}.vcode-box .img-vcode .hint[data-v-6217922a]{position:absolute;z-index:-1;top:0;left:0;display:flex;height:100%;width:100%;justify-content:center;align-items:center}.send-vcode-btn[data-v-6217922a]{position:absolute;top:0;right:0;height:100%;color:#007fff;font-size:1.25rem;line-height:1;background-color:transparent}.send-vcode-btn[data-v-6217922a]:disabled{color:#909090;cursor:default}.send-vcode-btn[data-v-6217922a]:hover(:not(:disabled)){opacity:.8}.masker-fade-enter-active[data-v-6217922a],.masker-fade-leave-active[data-v-6217922a]{transition:opacity .3s}.masker-fade-enter[data-v-6217922a],.masker-fade-leave-to[data-v-6217922a]{opacity:0}.form-fade-enter-active[data-v-6217922a],.form-fade-leave-active[data-v-6217922a]{transition:.3s}.form-fade-enter[data-v-6217922a],.form-fade-leave-to[data-v-6217922a]{transform:translate(-50%,-52%);opacity:0}
.dropdown-input-container[data-v-4e5eda86]{height:100%;display:flex}.dropdown-input-container input[data-v-4e5eda86]{border:none;outline:none;width:32px;margin:0;padding:0}.dropdown-input-container .dropdown-input-box[data-v-4e5eda86]:before{content:"+"}.dropdown-input-container .arrow[data-v-4e5eda86]{cursor:pointer;transition:all .45s cubic-bezier(.8,.15,.15,.86)}.dropdown-input-container .dropdown-pannel[data-v-4e5eda86]{position:absolute;width:220px;max-height:188px;border-radius:4px;box-shadow:0 2px 5px 0 rgba(0,0,0,.08);border:1px solid #e8e8e8;background-color:#fff;overflow-y:auto;z-index:200;top:40px;left:-2px}.dropdown-input-container li.item[data-v-4e5eda86]{padding:8px 10px;font-size:14px;line-height:20px;justify-content:space-between;display:flex}.dropdown-input-container li.item[data-v-4e5eda86]:hover{cursor:pointer;background-color:#f5f5f5}.dropdown-input-container li.item.selected[data-v-4e5eda86]{color:#007fff}.dropdown-input-container li>span[data-v-4e5eda86]:last-child{color:#999}
@font-face{font-family:iconfont;src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358);src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358#iefix) format("embedded-opentype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.woff?t=1470110358) format("woff"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.ttf?t=1470110358) format("truetype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.svg?t=1470110358#iconfont) format("svg")}.iconfont[data-v-d6ec2d02]{font-family:iconfont!important;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-xlcollection[data-v-d6ec2d02]:before{content:"\e600"}.icon-xlchatbox[data-v-d6ec2d02]:before{content:"\e601"}.column-view[data-v-d6ec2d02]{padding:0 0 8rem}.main-area[data-v-d6ec2d02]{position:relative;width:700px;max-width:100%;background-color:#fff;border-radius:2px;box-sizing:border-box}.main-area[data-v-d6ec2d02]:after{display:table;content:"";clear:both}.article-area[data-v-d6ec2d02]{margin-bottom:1.5rem;padding:0 2rem}.article[data-v-d6ec2d02]{margin-bottom:3rem;padding:2rem 0 0}.article-placeholder[data-v-d6ec2d02]{width:100%}.author-info-block[data-v-d6ec2d02]{display:flex;align-items:center;margin-bottom:2rem}.author-info-block .avatar-link[data-v-d6ec2d02]{font-size:0}.author-info-block .avatar[data-v-d6ec2d02]{flex:0 0 auto;margin-right:1rem;width:3.333rem;height:3.333rem;border-radius:50%}.author-info-block .author-info-box[data-v-d6ec2d02]{min-width:0;flex-grow:1;flex:1}.author-info-block .username[data-v-d6ec2d02]{display:inline-block;width:100%;font-size:1.3rem;font-weight:700;color:#333}.author-info-block .meta-box[data-v-d6ec2d02]{font-size:1.1rem;color:#909090}.author-info-block .time[data-v-d6ec2d02]{letter-spacing:1px}.author-info-block .views-count[data-v-d6ec2d02]{margin-left:.5em}.author-info-block .dot[data-v-d6ec2d02]{margin:0 .5em}@media (max-width:600px){.author-info-block .dot[data-v-d6ec2d02]{margin:0 .2em}}@media (max-width:600px){.author-info-block .follow[data-v-d6ec2d02]{margin-top:12px}}.author-info-block .edit-btn[data-v-d6ec2d02]{color:#1264b6;cursor:pointer}.author-info-block .edit-btn[data-v-d6ec2d02]:hover{text-decoration:underline}.article-hero[data-v-d6ec2d02]{margin-bottom:2rem;width:100%}.article-hero[data-v-d6ec2d02]:after{content:"";display:block;padding-top:56.29%;width:100%;pointer-events:none}.audit-show[data-v-d6ec2d02]{width:100%;height:70px;line-height:70px;background:#f4f5f5;border-radius:2px;font-size:16px;font-weight:400;color:#2e3135;text-align:center}.article-title[data-v-d6ec2d02]{margin:.67em 0;font-size:2.5rem;font-weight:700;line-height:1.5}@media (max-width:600px){.article-title[data-v-d6ec2d02]{font-size:2rem}}.tag-list-box[data-v-d6ec2d02]{margin-bottom:2rem}.tag-list-box .tag-list-title[data-v-d6ec2d02]{margin-bottom:2rem;padding:0 0 0 2rem;font-size:1.25rem;font-weight:600;color:#000;border-left:6px solid #ddd}.tag-list-box .tag-list[data-v-d6ec2d02]{display:flex;flex-wrap:wrap}.tag-list-box .tag-list .item[data-v-d6ec2d02]{display:flex;align-items:center;margin:0 1.25rem 1rem 0;padding:.167rem;background-color:#fff;border:1px solid #e3e3e3;border-radius:2px}.tag-list-box .tag-list .tag-icon[data-v-d6ec2d02]{width:1.75rem;height:1.75rem;border-radius:2px}@media (max-width:600px){.tag-list-box .tag-list .tag-icon[data-v-d6ec2d02]{display:none}}.tag-list-box .tag-list .tag-title[data-v-d6ec2d02]{padding:0 .75rem;font-size:1rem;line-height:1.75rem;color:#919191}.wechat-banner[data-v-d6ec2d02]{margin-bottom:2rem}@media (min-width:960px){.wechat-banner[data-v-d6ec2d02]{display:none}}.book-box[data-v-d6ec2d02]{margin-bottom:2rem}@media (min-width:960px){.book-box[data-v-d6ec2d02]{display:none}}.footer-author-block[data-v-d6ec2d02]{padding:15px 17px;border-radius:2px;background-color:#f4f5f5;margin-bottom:2rem}@media (max-width:600px){.footer-author-block[data-v-d6ec2d02]{padding:15px 1rem}}.article-banner[data-v-d6ec2d02]{margin-bottom:2.5rem;padding:0 0 0 2rem;border-left:6px solid #ddd}.article-banner .banner-title[data-v-d6ec2d02]{font-size:1.3rem;line-height:1.6;color:#007fff}.article-banner .banner-content[data-v-d6ec2d02]{margin-top:.2rem;font-size:1.1rem;line-height:1.4;color:#909090}.comment-box[data-v-d6ec2d02]{padding:0 2rem}.comment-box.extended[data-v-d6ec2d02]{padding-bottom:2rem}@media (max-width:600px){.comment-box[data-v-d6ec2d02]{padding:0}}.comment-box .comment-title[data-v-d6ec2d02]{margin-bottom:1.3rem;font-size:1.3rem;font-weight:500;text-align:center;color:#909090}.comment-box .comment-form[data-v-d6ec2d02]{margin-bottom:1rem}.recommended-entry-list-title[data-v-d6ec2d02]{padding:1.3rem 2rem;font-size:1.25rem;font-weight:600;color:#909090;border-bottom:1px solid rgba(178,186,194,.15)}.sidebar[data-v-d6ec2d02]{position:absolute;top:0;right:0;width:20rem}.article-suspended-panel[data-v-d6ec2d02]{position:fixed;margin-left:-7rem;top:16rem}.action-bar[data-v-d6ec2d02]{position:fixed;z-index:1;bottom:0;width:100%;left:0}@media (max-width:960px){.sidebar[data-v-d6ec2d02]{display:none}.main-area[data-v-d6ec2d02]{width:100%}.article-area[data-v-d6ec2d02]{margin-bottom:0}.open-in-app[data-v-d6ec2d02]{bottom:6rem}}.border[data-v-d6ec2d02]{border-bottom:1px solid rgba(178,186,194,.15)}
.main-header-box[data-v-6a3e47cf]{position:relative;height:5rem}.main-header[data-v-6a3e47cf]{position:fixed;top:0;left:0;right:0;transition:all .2s;transform:translate3d(0,-100%,0)}.main-header.visible[data-v-6a3e47cf]{transform:translateZ(0)}.main-container>.view[data-v-6a3e47cf]{margin-top:1.767rem}.main-container.with-view-nav>.view[data-v-6a3e47cf]{margin-top:4.67rem}.main-container.tight>.view[data-v-6a3e47cf]{margin-top:0}.main-container.tight.with-view-nav>.view[data-v-6a3e47cf]{margin-top:3.833rem}
@font-face{font-family:iconfont;src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358);src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358#iefix) format("embedded-opentype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.woff?t=1470110358) format("woff"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.ttf?t=1470110358) format("truetype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.svg?t=1470110358#iconfont) format("svg")}.iconfont[data-v-20709686]{font-family:iconfont!important;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-xlcollection[data-v-20709686]:before{content:"\e600"}.icon-xlchatbox[data-v-20709686]:before{content:"\e601"}.logo[data-v-20709686]{min-width:98px;margin-right:2rem}.nav-item a[data-v-20709686]{color:#71777c}.nav-item.active>.icon[data-v-20709686],.nav-item.active>a[data-v-20709686]{color:#007fff}.nav-item.discount[data-v-20709686]:after{content:"";position:absolute;width:35px;height:28px;background:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/half_discount.3daad5d.gif);background-size:35px 28px;right:-14px;top:10px}.nav-menu-item>a[data-v-20709686]{display:block;color:#71777c}.avatar[data-v-20709686]{width:2.5rem;height:2.5rem;position:relative}.avatar[data-v-20709686],.badge[data-v-20709686]{border-radius:50%}.badge[data-v-20709686]{position:absolute;top:10px;right:-5px;width:11px;height:11px;background-color:#2f74e9}.main-header[data-v-20709686]{background:#fff;border-bottom:1px solid #f1f1f1;color:#909090;height:5rem;z-index:250}.main-header .container[data-v-20709686]{max-width:960px;margin:auto}.container[data-v-20709686]{display:flex;align-items:center;height:100%}.main-nav[data-v-20709686]{height:100%;flex:1 0 auto}.main-nav-list[data-v-20709686]{display:flex}.phone-show-menu[data-v-20709686]{cursor:pointer;display:none}.phone-hide[data-v-20709686]{display:flex}.nav-list[data-v-20709686]{justify-content:flex-end;position:relative}.nav-item[data-v-20709686],.nav-list[data-v-20709686]{display:flex;align-items:center;height:100%;margin:0}.nav-item[data-v-20709686]{color:#71777c;padding:0 1.2rem;font-size:1.33rem;justify-content:center;cursor:pointer}.nav-item.activities .tip[data-v-20709686]{z-index:2;cursor:auto;width:17rem;background:#fff;padding:1rem;display:flex;justify-content:flex-start;position:absolute;top:4.5rem;left:-50%;margin-left:-3.7rem;color:#17181a;font-size:15px;border-radius:2px;box-shadow:0 2px 20px 0 rgba(0,0,0,.12)}.nav-item.activities .tip .panfish[data-v-20709686]{height:63px;width:57px;flex:0 0 auto;background-repeat:no-repeat;background-size:contain}.nav-item.activities .tip .content[data-v-20709686]{display:flex;flex-direction:column;padding:.5rem 0 0 .5rem;color:#17181a}.nav-item.activities .tip .content button[data-v-20709686]{padding:0;width:6.41rem;height:2rem;color:#fff;font-size:13px;border-radius:12px;margin-top:.5rem}.nav-item.activities .tip .triangle[data-v-20709686]{display:block;position:absolute;top:0;left:50%;width:1rem;height:1rem;transform:translate(-50%,-50%) rotate(45deg);background:#fff;border-top:1px solid #f4f5f5;border-left:1px solid #f4f5f5}.nav-item.activities .tip .close[data-v-20709686]{cursor:pointer;width:1rem;height:1rem;position:absolute;top:.5rem;right:.5rem;border-radius:50%;background:#fff;transform:rotate(45deg)}.nav-item.activities .tip .close[data-v-20709686]:after,.nav-item.activities .tip .close[data-v-20709686]:before{content:"";width:.8rem;height:2px;display:block;position:absolute;background:#c5c5c5;left:50%;top:50%;transform:translate(-50%,-50%)}.nav-item.activities .tip .close[data-v-20709686]:after{transform:translate(-50%,-50%) rotate(90deg)}.nav-item.activities .tip .close[data-v-20709686]:hover{opacity:.8}.nav-item .login-button[data-v-20709686]{border:1px solid #007fff;background-color:#fff;padding:.3rem 1.6rem;color:#007fff;line-height:1.9rem}.nav-item:hover>a[data-v-20709686]{color:#007fff}.nav-item[data-v-20709686]:last-child{padding-right:0}.nav-item.link-item[data-v-20709686]{padding:0 1.5rem;height:5rem}.nav-item.book.new-year a[data-v-20709686]:after{left:0;top:0;position:absolute;content:"";background-position:50%;background-repeat:no-repeat;background-size:60px auto;width:100%;height:100%}.nav-item.search[data-v-20709686]{flex:1 1 auto;justify-content:flex-end;cursor:auto}.nav-item.add[data-v-20709686]{cursor:default}.nav-item.notification:hover .icon[data-v-20709686]{color:#007fff}.nav-item.menu[data-v-20709686],.nav-item.submit[data-v-20709686]{position:relative}.nav-item.submit[data-v-20709686]{color:#007fff}.nav-item.submit[data-v-20709686]:hover{color:#0371df}.nav-item.submit[data-v-20709686]:after{content:"|";position:absolute;top:20px;left:100%;color:hsla(0,0%,59.2%,.4)}.nav-item.submit .submit-panel[data-v-20709686]{position:absolute;top:101%;left:-123px;width:326px;box-sizing:border-box;padding:2.5rem 2rem;border-radius:2px;color:#909090;font-size:1.1rem;background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.1);border:1px solid rgba(178,181,187,.5);cursor:default;z-index:11}.nav-item.submit .submit-panel[data-v-20709686]:before{content:"";position:absolute;top:0;left:50%;width:1rem;height:1rem;border-top:1px solid rgba(178,181,187,.5);border-left:1px solid rgba(178,181,187,.5);background-color:#fff;transform:rotate(45deg) translate(-50%,-50%);transform-origin:0 0}.nav-item.submit .submit-panel .title[data-v-20709686]{font-size:1.4rem;line-height:1;font-weight:700;color:#000;text-align:center;margin-bottom:2rem}.nav-item.submit .submit-panel .benefit-list[data-v-20709686]{margin-left:2rem}.nav-item.submit .submit-panel .item[data-v-20709686]{list-style:disc outside none;list-style:initial;margin-bottom:1rem}.nav-item.submit .submit-panel .link[data-v-20709686]{color:#6cbd45;text-decoration:underline}.nav-item.submit .submit-panel button[data-v-20709686]{display:block;margin:2rem auto 0;background-color:#83c73a;font-size:1.2rem;padding:1rem 4rem}.nav-item.auth[data-v-20709686]{color:#007fff;padding:0}.nav-item.auth span[data-v-20709686]:hover{color:#0371df}.nav-item.auth .login[data-v-20709686]:after{content:"·";margin:0 .4rem}.nav-item .icon[data-v-20709686]{font-size:2rem;color:#71777c}.nav-item .icon[data-v-20709686]:hover{color:#007fff}.submit-fixed-bg[data-v-20709686]{position:fixed;top:0;left:0;right:0;bottom:0;opacity:0;z-index:10}.search-form[data-v-20709686]{border:1px solid hsla(0,0%,59.2%,.2);background-color:rgba(227,231,236,.2);display:flex;align-items:center;justify-content:space-between;border-radius:2px}.search-form.active[data-v-20709686]{background-color:#fff;border:1px solid #007fff}.search-form .search-icon[data-v-20709686]{padding:0 .5rem;cursor:pointer}.search-form .search-input[data-v-20709686]{border:none;width:11rem;padding:.6rem 0 .6rem 1rem;box-shadow:none;outline:none;font-size:1.1rem;color:#666;background-color:transparent}.nav-menu[data-v-20709686]{position:absolute;width:11rem;left:50%;top:100%;transform:translateX(-50%);margin:0;padding:0;list-style:none;background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.1);border:1px solid rgba(177,180,185,.45);border-radius:4px;font-size:1.2rem}.nav-menu .nav-menu-item-group[data-v-20709686]{padding:1rem 0}.nav-menu .nav-menu-item[data-v-20709686]{font-size:1.3rem;cursor:pointer}.nav-menu .nav-menu-item[data-v-20709686]:hover{background-color:hsla(0,0%,94.9%,.5)}.nav-menu .nav-menu-item>a[data-v-20709686]{display:flex;align-items:center;padding:.5rem 1rem}.nav-menu .nav-menu-item>a>span[data-v-20709686]{margin-left:0;flex-grow:1}.nav-menu .nav-menu-item>a.link-icon[data-v-20709686]{padding-right:.5rem}.nav-menu .nav-menu-item .collect[data-v-20709686],.nav-menu .nav-menu-item .zan[data-v-20709686]{margin-right:.8rem;width:18.72px;height:18px}.nav-menu .nav-menu-item .icon-2018[data-v-20709686]{width:38px;height:20px;border-radius:1rem;margin-left:2px;background-image:url(https://gold-cdn.xitu.io/asset/2018/2018-icon.png);background-size:102% 100%;background-repeat:no-repeat;box-shadow:3px 3px 6px -3px #999}.nav-menu .nav-menu-item .icon-2018[data-v-20709686]:hover{opacity:.9}.nav-menu .more[data-v-20709686]{position:relative}.nav-menu .more:hover .more-dropdown-list[data-v-20709686]{display:block}.nav-menu .more .more-icon[data-v-20709686]{float:right;color:#b2bac2;font-size:1.2rem;line-height:2rem}.nav-menu.user-dropdown-list[data-v-20709686]{width:13.1rem;right:0;left:auto;transform:translateX(0)}.nav-menu.user-dropdown-list .nav-menu-item-group[data-v-20709686]:not(:last-child){border-bottom:1px solid rgba(0,0,0,.04)}.add-group[data-v-20709686]{display:flex;align-items:center;position:relative;height:2.667rem;cursor:pointer}.add-group.active .more-list[data-v-20709686]{display:block}.add-group .add-btn[data-v-20709686],.add-group .more[data-v-20709686]{height:100%;color:#fff;background-color:#007fff;border-radius:3px}.add-group .add-btn.active[data-v-20709686],.add-group .add-btn[data-v-20709686]:hover,.add-group .more.active[data-v-20709686],.add-group .more[data-v-20709686]:hover{background-color:#0876e4}.add-group .add-btn[data-v-20709686]{padding:0 .9rem;font-size:1.167rem;border-top-right-radius:0;border-bottom-right-radius:0}.add-group .more[data-v-20709686]{flex:0 0 auto;display:flex;align-items:center;justify-content:center;width:1.25rem;border-left:1px solid hsla(0,0%,100%,.1);border-top-left-radius:0;border-bottom-left-radius:0}.add-group .more .more-icon[data-v-20709686]{margin-top:.2rem;font-size:1rem}.add-group .more-list[data-v-20709686]{position:absolute;top:100%;left:0;right:0;padding:.417rem 0;font-size:1.167rem;color:#3b76c5;background-color:#fff;border:1px solid #ebebeb;border-radius:2px;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);display:none;z-index:1}.add-group .more-list .item[data-v-20709686]{padding:0 0 0 .8rem;line-height:1.9}.add-group .more-list .item[data-v-20709686]:hover{background-color:#f9f9f9}.more-dropdown-list[data-v-20709686]{position:absolute;left:auto;top:0;right:102%;transform:translateX(0);display:none}.more-dropdown-list[data-v-20709686]:after{content:"";position:absolute;top:0;left:100%;width:1.3rem;height:4rem}.notification[data-v-20709686]{position:relative}.notification.active .icon[data-v-20709686]{color:#007fff}.notification .count[data-v-20709686]{position:absolute;left:50%;bottom:43%;margin:0;font-size:1rem;line-height:1;text-align:center;background-color:#007fff;border-radius:3rem;word-break:normal;display:inline-block;color:#f1f1f1;transform:scale(.8);font-size:13px;font-weight:500;padding:3px 6px;background:#f03535;border-radius:100px;border:2px solid #fff}.fengwei[data-v-20709686]{display:inline-block;width:1em;height:1em;margin-right:.8rem;font-size:1.2em;vertical-align:middle;color:#b2bac2}.fix-bg[data-v-20709686]{position:fixed;top:0;left:0;bottom:0;right:0;opacity:0}.mobile[data-v-20709686]{display:none}@media (max-width:980px){.logo[data-v-20709686]{margin-right:0;margin-left:.67rem}.container[data-v-20709686]{width:96%}.main-nav-list[data-v-20709686]{display:block;position:absolute;left:0;top:0;background-color:#fff;z-index:1}.phone-show-menu[data-v-20709686]{height:5rem;display:flex;align-items:center;color:#007fff;font-size:1.33rem;justify-content:center;padding:0;width:5.66rem}.phone-show-menu span[data-v-20709686]{margin-right:.6rem}.phone-hide[data-v-20709686]{display:none;background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.1);border:1px solid rgba(177,180,185,.45);border-radius:4px;font-size:1.2rem}.phone-hide.show[data-v-20709686]{display:block}.nav-item.link-item[data-v-20709686]{height:4rem}.nav-item.add[data-v-20709686],.nav-item.submit[data-v-20709686],.pinTip[data-v-20709686]{display:none}.tip[data-v-20709686]{display:none!important}.nav-menu .nav-menu-item .icon-2018[data-v-20709686]{width:35px;margin-left:0}}@media (max-width:700px){.nav-item.search[data-v-20709686]{display:flex;padding-right:1.2rem}.nav-item .search-form .search-input[data-v-20709686]{width:11rem;padding:.6rem}.nav-item .search-form .search-icon[data-v-20709686]{display:none}.logo[data-v-20709686]{min-width:3.75rem}.logo-img[data-v-20709686]{display:none}.mobile[data-v-20709686]{display:block}.notification[data-v-20709686]{padding:0 .8rem}}@media (max-width:375px){.nav-item .search-form .search-input[data-v-20709686]{width:10rem}}@media (max-width:330px){.nav-item.search[data-v-20709686]{display:none}.nav-item.search .search-form .search-input[data-v-20709686]{width:5rem}}.tip-fade-enter-active[data-v-20709686],.tip-fade-leave-active[data-v-20709686]{transition:.3s}.tip-fade-enter[data-v-20709686],.tip-fade-leave-to[data-v-20709686]{transform:translateY(-10px);opacity:0}
.avatar[data-v-1c418ef0]{display:inline-block;position:relative;background-size:cover;background-color:#eee}.avatar[data-v-1c418ef0],.avatar.xmas[data-v-1c418ef0]:after{background-position:50%;background-repeat:no-repeat}.avatar.xmas[data-v-1c418ef0]:after{content:"";position:absolute;left:25%;bottom:30%;width:90%;height:90%;background-size:contain;background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/hats.12a740a.svg);transform:rotate(15deg);transform-origin:bottom right;transition:all .2s}.avatar.xmas[data-v-1c418ef0]:hover:after{transform:rotate(20deg)}
.lazy[data-v-47cc2604]{position:relative}.lazy[data-v-47cc2604]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background-color:inherit;border-radius:inherit}.lazy[data-v-47cc2604]:not(.immediate):before{transition:opacity .2s}.lazy.loaded[data-v-47cc2604]:before{opacity:0;pointer-events:none}
.username[data-v-1b6b7cba]{font-size:1.25rem;font-weight:600;color:#2e3135}.username .name[data-v-1b6b7cba]{display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.recommend-author-block .username .name[data-v-1b6b7cba]{max-width:130px}.recommendation-index-view .username .name[data-v-1b6b7cba]{max-width:200px}
.follow-button[data-v-06c7d5b3]{margin:0 0 0 auto;padding:0;width:55px;height:26px;font-size:13px;border:1px solid #6cbd45;color:#6cbd45;background-color:#fff}.follow-button[data-v-06c7d5b3]:hover{opacity:.8}.follow-button.followed[data-v-06c7d5b3]{color:#fff;border-color:#6cbd45;background-color:#6cbd45}
[data-v-78c9b824] .image-viewer{position:fixed;top:0;left:0;right:0;bottom:0;z-index:10000}[data-v-78c9b824] .image-viewer.loading:after{content:"";position:absolute;top:0;right:100%;width:50%;height:.2rem;background-color:#007fff;z-index:1;-webkit-animation:pro-data-v-78c9b824 1s ease-in-out infinite;animation:pro-data-v-78c9b824 1s ease-in-out infinite;-webkit-animation-delay:1s;animation-delay:1s}@-webkit-keyframes pro-data-v-78c9b824{0%{transform:translateZ(0)}to{transform:translate3d(300%,0,0)}}@keyframes pro-data-v-78c9b824{0%{transform:translateZ(0)}to{transform:translate3d(300%,0,0)}}
.panel-btn[data-v-19356a56]{position:relative;margin-bottom:.75rem;width:3rem;height:3rem;background-color:#fff;background-position:50%;background-repeat:no-repeat;border-radius:50%;box-shadow:0 2px 4px 0 rgba(0,0,0,.04);cursor:pointer}.panel-btn:not(.share-btn).active.with-badge[data-v-19356a56]:after{background-color:#74ca46}.panel-btn.with-badge[data-v-19356a56]:after{content:attr(badge);position:absolute;top:0;left:75%;padding:.1rem .4rem;font-size:1rem;text-align:center;line-height:1;white-space:nowrap;color:#fff;background-color:#b2bac2;border-radius:.7rem;transform-origin:left top;transform:scale(.75)}.panel-btn.like-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE2IDE1Ij4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTIuODc0IDYuMDQ0VjE1aC0xLjczQy41MTMgMTUgMCAxNC4zODIgMCAxMy42MjRWNy41MjljMC0uNzkuNTM1LTEuNDg1IDEuMTQzLTEuNDg1aDEuNzMxek03LjYwNyAxLjI1QzcuNzIuNTA3IDguMzQ0LS4wMTMgOS4wMyAwYy45OC4wMTkgMS41NjMuODMzIDEuNzY2IDEuMjM1LjM3LjczNS4zOCAxLjk0Ni4xMjYgMi43MjQtLjIzLjcwNC0uNzYxIDEuNjI5LS43NjEgMS42MjloMy45ODJjLjQyIDAgLjgxMS4yMDYgMS4wNzIuNTYzYTEuNSAxLjUgMCAwIDEgLjIzMiAxLjI3MmwtMS44MDEgNi41MTNjLS4xNjQuNjI3LS43MDcgMS4wNjQtMS4zMiAxLjA2NEg0LjVWNS44OThDNi4yOTkgNS41MSA3LjQwNCAyLjU5IDcuNjA3IDEuMjQ5eiIvPgo8L3N2Zz4K)}.panel-btn.like-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE2IDE1Ij4KICAgIDxwYXRoIGZpbGw9IiM4QTkzQTAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTIuODc0IDYuMDQ0VjE1aC0xLjczQy41MTMgMTUgMCAxNC4zODIgMCAxMy42MjRWNy41MjljMC0uNzkuNTM1LTEuNDg1IDEuMTQzLTEuNDg1aDEuNzMxek03LjYwNyAxLjI1QzcuNzIuNTA3IDguMzQ0LS4wMTMgOS4wMyAwYy45OC4wMTkgMS41NjMuODMzIDEuNzY2IDEuMjM1LjM3LjczNS4zOCAxLjk0Ni4xMjYgMi43MjQtLjIzLjcwNC0uNzYxIDEuNjI5LS43NjEgMS42MjloMy45ODJjLjQyIDAgLjgxMS4yMDYgMS4wNzIuNTYzYTEuNSAxLjUgMCAwIDEgLjIzMiAxLjI3MmwtMS44MDEgNi41MTNjLS4xNjQuNjI3LS43MDcgMS4wNjQtMS4zMiAxLjA2NEg0LjVWNS44OThDNi4yOTkgNS41MSA3LjQwNCAyLjU5IDcuNjA3IDEuMjQ5eiIvPgo8L3N2Zz4K)}.panel-btn.like-btn.active[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE2IDE1Ij4KICAgIDxwYXRoIGZpbGw9IiM2Q0JENDUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTIuODc0IDYuMDQ0VjE1aC0xLjczQy41MTMgMTUgMCAxNC4zODIgMCAxMy42MjRWNy41MjljMC0uNzkuNTM1LTEuNDg1IDEuMTQzLTEuNDg1aDEuNzMxek03LjYwNyAxLjI1QzcuNzIuNTA3IDguMzQ0LS4wMTMgOS4wMyAwYy45OC4wMTkgMS41NjMuODMzIDEuNzY2IDEuMjM1LjM3LjczNS4zOCAxLjk0Ni4xMjYgMi43MjQtLjIzLjcwNC0uNzYxIDEuNjI5LS43NjEgMS42MjloMy45ODJjLjQyIDAgLjgxMS4yMDYgMS4wNzIuNTYzYTEuNSAxLjUgMCAwIDEgLjIzMiAxLjI3MmwtMS44MDEgNi41MTNjLS4xNjQuNjI3LS43MDcgMS4wNjQtMS4zMiAxLjA2NEg0LjVWNS44OThDNi4yOTkgNS41MSA3LjQwNCAyLjU5IDcuNjA3IDEuMjQ5eiIvPgo8L3N2Zz4K)}.panel-btn.like-btn.like-adjust[data-v-19356a56]{background-position:53% 46%}.panel-btn.comment-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNCIgaGVpZ2h0PSIxMyIgdmlld0JveD0iMCAwIDE0IDEzIj4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0IDB2OS4yM0g4LjgxNUwzLjM3IDEzVjkuMjNIMFYweiIvPgo8L3N2Zz4K)}.panel-btn.comment-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNCIgaGVpZ2h0PSIxMyIgdmlld0JveD0iMCAwIDE0IDEzIj4KICAgIDxwYXRoIGZpbGw9IiM4QTkzQTAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0IDB2OS4yM0g4LjgxNUwzLjM3IDEzVjkuMjNIMFYweiIvPgo8L3N2Zz4K)}.panel-btn.comment-btn.comment-adjust[data-v-19356a56]{background-position:50% 55%}.panel-btn.collect-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNyIgaGVpZ2h0PSIxNyIgdmlld0JveD0iMCAwIDE3IDE3Ij4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTkuMzMyIDE0Ljk2OGMtLjQ2LS4yNTUtMS4yMDUtLjI1NS0xLjY2NiAwTDQuMzUgMTYuNzk0Yy0uOTIxLjUwNi0xLjUyMy4wNDQtMS4zNDktMS4wMjdsLjYzNS0zLjg2N2MuMDg4LS41MzctLjE0Mi0xLjI4LS41MTYtMS42NkwuNDM2IDcuNWMtLjc0NS0uNzYtLjUxMS0xLjUwNC41MTYtMS42NmwzLjcwNy0uNTY0Yy41MTQtLjA4IDEuMTE5LS41MzggMS4zNDgtMS4wMjdMNy42NjUuNzMxYy40NjItLjk3NiAxLjIwOC0uOTczIDEuNjY3IDBsMS42NiAzLjUxOWMuMjMuNDg5LjgzMy45NSAxLjM0OSAxLjAyN2wzLjcwOC41NjRjMS4wMjkuMTU2IDEuMjU4LjkwMi41MTUgMS42NmwtMi42ODUgMi43MzljLS4zNzIuMzgtLjYwMyAxLjEyMy0uNTE1IDEuNjZsLjYzNCAzLjg2N2MuMTc2IDEuMDc0LS40MyAxLjUzMy0xLjM0OCAxLjAyN2wtMy4zMTgtMS44MjZ6Ii8+Cjwvc3ZnPgo=)}.panel-btn.collect-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNyIgaGVpZ2h0PSIxNyIgdmlld0JveD0iMCAwIDE3IDE3Ij4KICAgIDxwYXRoIGZpbGw9IiM4QTkzQTAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTkuMzMyIDE0Ljk2OGMtLjQ2LS4yNTUtMS4yMDUtLjI1NS0xLjY2NiAwTDQuMzUgMTYuNzk0Yy0uOTIxLjUwNi0xLjUyMy4wNDQtMS4zNDktMS4wMjdsLjYzNS0zLjg2N2MuMDg4LS41MzctLjE0Mi0xLjI4LS41MTYtMS42NkwuNDM2IDcuNWMtLjc0NS0uNzYtLjUxMS0xLjUwNC41MTYtMS42NmwzLjcwNy0uNTY0Yy41MTQtLjA4IDEuMTE5LS41MzggMS4zNDgtMS4wMjdMNy42NjUuNzMxYy40NjItLjk3NiAxLjIwOC0uOTczIDEuNjY3IDBsMS42NiAzLjUxOWMuMjMuNDg5LjgzMy45NSAxLjM0OSAxLjAyN2wzLjcwOC41NjRjMS4wMjkuMTU2IDEuMjU4LjkwMi41MTUgMS42NmwtMi42ODUgMi43MzljLS4zNzIuMzgtLjYwMyAxLjEyMy0uNTE1IDEuNjZsLjYzNCAzLjg2N2MuMTc2IDEuMDc0LS40MyAxLjUzMy0xLjM0OCAxLjAyN2wtMy4zMTgtMS44MjZ6Ii8+Cjwvc3ZnPgo=)}.panel-btn.collect-btn.active[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNyIgaGVpZ2h0PSIxNyIgdmlld0JveD0iMCAwIDE3IDE3Ij4KICAgIDxwYXRoIGZpbGw9IiNGRkMzNDciIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTkuMzMyIDE0Ljk2OGMtLjQ2LS4yNTUtMS4yMDUtLjI1NS0xLjY2NiAwTDQuMzUgMTYuNzk0Yy0uOTIxLjUwNi0xLjUyMy4wNDQtMS4zNDktMS4wMjdsLjYzNS0zLjg2N2MuMDg4LS41MzctLjE0Mi0xLjI4LS41MTYtMS42NkwuNDM2IDcuNWMtLjc0NS0uNzYtLjUxMS0xLjUwNC41MTYtMS42NmwzLjcwNy0uNTY0Yy41MTQtLjA4IDEuMTE5LS41MzggMS4zNDgtMS4wMjdMNy42NjUuNzMxYy40NjItLjk3NiAxLjIwOC0uOTczIDEuNjY3IDBsMS42NiAzLjUxOWMuMjMuNDg5LjgzMy45NSAxLjM0OSAxLjAyN2wzLjcwOC41NjRjMS4wMjkuMTU2IDEuMjU4LjkwMi41MTUgMS42NmwtMi42ODUgMi43MzljLS4zNzIuMzgtLjYwMyAxLjEyMy0uNTE1IDEuNjZsLjYzNCAzLjg2N2MuMTc2IDEuMDc0LS40MyAxLjUzMy0xLjM0OCAxLjAyN2wtMy4zMTgtMS44MjZ6Ii8+Cjwvc3ZnPgo=)}.panel-btn.weibo-btn[data-v-19356a56]{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/weibo.2076a57.svg)}.panel-btn.weibo-btn[data-v-19356a56]:hover{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/weibo-hover.9abf502.svg)}.panel-btn.qq-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNSIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE1IDE2Ij4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjQ2OCAxMC4zMTJjLS4wMS0uOTU3LS4zOC0xLjQ3Ni0uODA3LTIuMTUzLS4xOTEtLjI4My0uNDEzLS40NzMtLjYwNS0uNzU1LS4wMy0uMTU0LjAzMy0uMjY4LS4wMTItLjY3MS0uMDQyLS42MDQtLjI2My0uODM4LS4zMS0uOTEyLjAyLS4xNi0uMDQzLTEuNDg1LS41MjMtMi4yNjhDMTAuNzUxLjk0MSA3Ljk4Mi44NDYgNy42NDMuODQ0SDcuNjRjLS4zMzkuMDAyLTMuMTA3LjA5Ny00LjU2OCAyLjcxLS40NzkuNzgyLS41NDMgMi4xMDYtLjUyMyAyLjI2Ny0uMDQ2LjA3NC0uMjY3LjMwOC0uMzEuOTEyLS4wNDQuNDAzLjAxOC41MTctLjAxMi42Ny0uMTkyLjI4NC0uNDEzLjQ3My0uNjA1Ljc1Ni0uNDI2LjY3Ny0uNzk3IDEuMTk2LS44MDYgMi4xNTMtLjAwNy43MTQuMTYyIDEuNjg3LjY2MyAxLjcuMTU4LS4wMTIuMjkyLS4xMTcuNTY2LS40MjQuMDgyLS4wOTIuMzctLjQ4LjQyOS0uNTg3LjA1Ni4xNDguMTkgMS4xODMgMS4xMiAxLjcyMy0uOTU2LjQ1LTEuNDI0LjczNS0xLjQ0IDEuMzE5LjAyLjMzOC40MjMuNzg3IDEuMTY1Ljk5NmE2LjA1IDYuMDUgMCAwIDAgMi45MjcuMDVjLjUzNS0uMTMuNjk2LS4yNiAxLjM5Ni0uNjQ0LjcuMzg1Ljg2LjUxNCAxLjM5NS42NDNhNi4wNTIgNi4wNTIgMCAwIDAgMi45MjctLjA0OWMuNzQyLS4yMDkgMS4xNDYtLjY1OCAxLjE2Ni0uOTk2LS4wMTYtLjU4NC0uNDg0LS44Ny0xLjQ0LTEuMzIuOTMtLjUzOCAxLjA2My0xLjU3NCAxLjEyLTEuNzIyLjA1OC4xMDcuMzQ2LjQ5NS40MjguNTg3LjI3NC4zMDcuNDA5LjQxMi41NjcuNDI0LjUtLjAxMy42Ny0uOTg2LjY2My0xLjd6Ii8+Cjwvc3ZnPgo=)}.panel-btn.qq-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNSIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE1IDE2Ij4KICAgIDxwYXRoIGZpbGw9IiM1NUIyRjEiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjQ2OCAxMC4zMTJjLS4wMS0uOTU3LS4zOC0xLjQ3Ni0uODA3LTIuMTUzLS4xOTEtLjI4My0uNDEzLS40NzMtLjYwNS0uNzU1LS4wMy0uMTU0LjAzMy0uMjY4LS4wMTItLjY3MS0uMDQyLS42MDQtLjI2My0uODM4LS4zMS0uOTEyLjAyLS4xNi0uMDQzLTEuNDg1LS41MjMtMi4yNjhDMTAuNzUxLjk0MSA3Ljk4Mi44NDYgNy42NDMuODQ0SDcuNjRjLS4zMzkuMDAyLTMuMTA3LjA5Ny00LjU2OCAyLjcxLS40NzkuNzgyLS41NDMgMi4xMDYtLjUyMyAyLjI2Ny0uMDQ2LjA3NC0uMjY3LjMwOC0uMzEuOTEyLS4wNDQuNDAzLjAxOC41MTctLjAxMi42Ny0uMTkyLjI4NC0uNDEzLjQ3My0uNjA1Ljc1Ni0uNDI2LjY3Ny0uNzk3IDEuMTk2LS44MDYgMi4xNTMtLjAwNy43MTQuMTYyIDEuNjg3LjY2MyAxLjcuMTU4LS4wMTIuMjkyLS4xMTcuNTY2LS40MjQuMDgyLS4wOTIuMzctLjQ4LjQyOS0uNTg3LjA1Ni4xNDguMTkgMS4xODMgMS4xMiAxLjcyMy0uOTU2LjQ1LTEuNDI0LjczNS0xLjQ0IDEuMzE5LjAyLjMzOC40MjMuNzg3IDEuMTY1Ljk5NmE2LjA1IDYuMDUgMCAwIDAgMi45MjcuMDVjLjUzNS0uMTMuNjk2LS4yNiAxLjM5Ni0uNjQ0LjcuMzg1Ljg2LjUxNCAxLjM5NS42NDNhNi4wNTIgNi4wNTIgMCAwIDAgMi45MjctLjA0OWMuNzQyLS4yMDkgMS4xNDYtLjY1OCAxLjE2Ni0uOTk2LS4wMTYtLjU4NC0uNDg0LS44Ny0xLjQ0LTEuMzIuOTMtLjUzOCAxLjA2My0xLjU3NCAxLjEyLTEuNzIyLjA1OC4xMDcuMzQ2LjQ5NS40MjguNTg3LjI3NC4zMDcuNDA5LjQxMi41NjcuNDI0LjUtLjAxMy42Ny0uOTg2LjY2My0xLjd6Ii8+Cjwvc3ZnPgo=)}.panel-btn.wechat-btn[data-v-19356a56]{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/wechat.63e1ce0.svg)}.panel-btn.wechat-btn[data-v-19356a56]:hover{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/wechat-hover.c8ce019.svg)}.panel-btn.wechat-btn:hover .wechat-qr-code-img[data-v-19356a56]{display:block}.share-title[data-v-19356a56]{margin:2.5rem 0 1rem;font-size:1rem;text-align:center;color:#c6c6c6;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.wechat-qr-code-img[data-v-19356a56]{position:absolute;top:100%;left:50%;width:8rem;height:8rem;margin-top:1rem;border:.5rem solid #fff;transform:translateX(-50%);display:none}
.extension[data-v-7e9c74a6]{position:fixed;bottom:0;left:0;z-index:1000;width:100%;height:180px;cursor:pointer;display:none}.extension[data-v-7e9c74a6]:before{display:flex;width:100%;position:absolute;bottom:0;z-index:0;height:148px;z-index:-1;content:"";background-color:#fff}.extension .link[data-v-7e9c74a6]{width:100%;height:100%;color:#000;background-repeat:no-repeat;background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/extension.c1307da.png);background-position:bottom;background-size:auto 180px;image-rendering:-webkit-optimize-contrast}.extension .link .price[data-v-7e9c74a6]{margin-left:5px;margin-right:5px;color:#007fff}.extension .link .description[data-v-7e9c74a6],.extension .link .title[data-v-7e9c74a6]{font-size:26px;padding-top:50px;box-sizing:border-box;width:960px;margin:0 auto;padding-left:22px}.extension .link .description[data-v-7e9c74a6]{color:rgba(0,0,0,.7);font-size:13px;padding-top:8px}.extension .ion-close[data-v-7e9c74a6]{position:absolute;top:45px;right:15px;font-size:12px;color:#bbb}.extension .ion-close[data-v-7e9c74a6]:hover{color:#999}.books[data-v-7e9c74a6]{display:none;left:15px;right:15px;position:fixed;bottom:15px;z-index:900}.books.book--mobile[data-v-7e9c74a6]{bottom:55px}.books .book-inner[data-v-7e9c74a6]{width:100%;height:50px;padding-left:15px;padding-right:15px;display:flex;justify-content:center;align-items:center;background:#fd4243;box-sizing:border-box;border-radius:2px;background:linear-gradient(108deg,#f87554,#f0232f);background:-webkit-linear-gradient(-12deg,#f87554,#f0232f)}.books .book-inner .icon[data-v-7e9c74a6]{width:38px}.books .book-inner .icon img[data-v-7e9c74a6]{width:100%;display:block}.books .book-inner .title[data-v-7e9c74a6]{flex-grow:1;padding-left:15px;color:#fff;font-size:15px}.books .book-inner .btn-get[data-v-7e9c74a6]{padding-left:15px;padding-right:15px;height:26px;line-height:26px;border-radius:2px;border:1px solid #fff;color:#fff}@media (max-width:960px){.books[data-v-7e9c74a6]{display:block}}@media (min-width:960px){.extension[data-v-7e9c74a6]{display:block}}</style>
  </head>
  <body >
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div id="juejin"><div class="global-component-box"><!----> <!----> <!----> <!----> <!----> <div class="emoji-barrage" data-v-68506677><!----></div> <!----> <!----> <div class="bind-phone-number-modal-box" data-v-6217922a><div st:block="bindPhoneNumberModal" class="modal-mask" style="display:none;" data-v-6217922a data-v-6217922a></div> <form class="bind-phone-number-form" style="display:none;" data-v-6217922a data-v-6217922a><i title="关闭" class="close-btn ion-close-round" data-v-6217922a></i> <h1 class="title" data-v-6217922a>提示</h1> <h2 class="hint" data-v-6217922a>根据我国<a href="http://www.cac.gov.cn/2016-11/07/c_1119867116.htm" target="_blank" style="color:#007fff">《网络安全法》</a>，您需要绑定手机号后才可在掘金社区内发布内容。</h2> <div class="input-group" data-v-6217922a><div class="input-box dropdown-box" data-v-6217922a><div class="dropdown-input-container" style="width:26%;" data-v-4e5eda86 data-v-6217922a><div class="dropdown-input-box" data-v-4e5eda86><input autocomplete="off" value="86" data-v-4e5eda86> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgdmlld0JveD0iMCAwIDEyIDEyIj4KICAgIDxwYXRoIGZpbGw9IiM5OTkiIGZpbGwtcnVsZT0ibm9uemVybyIgZD0iTTYgNy42NTlsMy4xNDYtMy40OTZhLjQ2NS40NjUgMCAwIDEgLjcwOCAwIC42LjYgMCAwIDEgMCAuNzg1bC0zLjUgMy44OWEuNDY1LjQ2NSAwIDAgMS0uNzA4IDBsLTMuNS0zLjg5YS42LjYgMCAwIDEgMC0uNzg1LjQ2NS40NjUgMCAwIDEgLjcwOCAwTDYgNy42NTl6Ii8+Cjwvc3ZnPg==" class="arrow" style="transform:rotate(0deg);" data-v-4e5eda86></div> <div class="dropdown-pannel" style="display:none;" data-v-4e5eda86 data-v-4e5eda86><ul data-v-4e5eda86><li class="item selected" data-v-4e5eda86><span data-v-4e5eda86>中国</span> <span data-v-4e5eda86>+86</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中国澳门</span> <span data-v-4e5eda86>+853</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中国台湾</span> <span data-v-4e5eda86>+886</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中国香港</span> <span data-v-4e5eda86>+852</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿尔巴尼亚</span> <span data-v-4e5eda86>+355</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿尔及利亚</span> <span data-v-4e5eda86>+213</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿根廷</span> <span data-v-4e5eda86>+54</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿拉伯联合酋长国</span> <span data-v-4e5eda86>+971</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿鲁巴岛</span> <span data-v-4e5eda86>+297</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿曼</span> <span data-v-4e5eda86>+968</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿塞拜疆</span> <span data-v-4e5eda86>+994</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿森松</span> <span data-v-4e5eda86>+247</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>埃及</span> <span data-v-4e5eda86>+20</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>埃塞俄比亚</span> <span data-v-4e5eda86>+251</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>爱尔兰</span> <span data-v-4e5eda86>+353</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>爱沙尼亚</span> <span data-v-4e5eda86>+372</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安道尔</span> <span data-v-4e5eda86>+376</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安哥拉</span> <span data-v-4e5eda86>+244</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安圭拉</span> <span data-v-4e5eda86>+1264</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安提瓜和巴布达</span> <span data-v-4e5eda86>+1268</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>奥地利</span> <span data-v-4e5eda86>+43</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>奥兰群岛</span> <span data-v-4e5eda86>+358</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>澳大利亚</span> <span data-v-4e5eda86>+61</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴巴多斯</span> <span data-v-4e5eda86>+1246</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴哈马</span> <span data-v-4e5eda86>+1242</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴拉圭</span> <span data-v-4e5eda86>+595</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴勒斯坦</span> <span data-v-4e5eda86>+970</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴林</span> <span data-v-4e5eda86>+973</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴拿马</span> <span data-v-4e5eda86>+507</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴西</span> <span data-v-4e5eda86>+55</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>白俄罗斯</span> <span data-v-4e5eda86>+375</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>百慕大</span> <span data-v-4e5eda86>+1441</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>保加利亚</span> <span data-v-4e5eda86>+359</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>北马里亚纳群岛</span> <span data-v-4e5eda86>+1670</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>贝宁</span> <span data-v-4e5eda86>+229</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>比利时</span> <span data-v-4e5eda86>+32</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>冰岛</span> <span data-v-4e5eda86>+354</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>波多黎各</span> <span data-v-4e5eda86>+1787</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>波黑</span> <span data-v-4e5eda86>+387</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>波兰</span> <span data-v-4e5eda86>+48</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>玻利维亚</span> <span data-v-4e5eda86>+591</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>伯利兹</span> <span data-v-4e5eda86>+501</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>博茨瓦纳</span> <span data-v-4e5eda86>+267</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>不丹</span> <span data-v-4e5eda86>+975</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>布基拉法索</span> <span data-v-4e5eda86>+226</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>布隆迪</span> <span data-v-4e5eda86>+257</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>朝鲜</span> <span data-v-4e5eda86>+850</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>赤道几内亚</span> <span data-v-4e5eda86>+240</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>丹麦</span> <span data-v-4e5eda86>+45</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>德国</span> <span data-v-4e5eda86>+49</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>多哥</span> <span data-v-4e5eda86>+228</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>多米尼加共和国</span> <span data-v-4e5eda86>+1809</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>多米尼克</span> <span data-v-4e5eda86>+1767</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>俄罗斯</span> <span data-v-4e5eda86>+7</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>厄瓜多尔</span> <span data-v-4e5eda86>+593</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>厄立特里亚</span> <span data-v-4e5eda86>+291</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法国</span> <span data-v-4e5eda86>+33</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法罗群岛</span> <span data-v-4e5eda86>+298</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法属波利尼西亚</span> <span data-v-4e5eda86>+689</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法属圭亚那</span> <span data-v-4e5eda86>+594</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>梵蒂冈</span> <span data-v-4e5eda86>+379</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>菲律宾</span> <span data-v-4e5eda86>+63</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斐济</span> <span data-v-4e5eda86>+679</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>芬兰</span> <span data-v-4e5eda86>+358</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>佛得角</span> <span data-v-4e5eda86>+238</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>冈比亚</span> <span data-v-4e5eda86>+220</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>刚果</span> <span data-v-4e5eda86>+242</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>刚果民主共和国</span> <span data-v-4e5eda86>+243</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>哥伦比亚</span> <span data-v-4e5eda86>+57</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>哥斯达黎加</span> <span data-v-4e5eda86>+506</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>格林纳达</span> <span data-v-4e5eda86>+1473</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>格陵兰岛</span> <span data-v-4e5eda86>+299</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>格鲁吉亚</span> <span data-v-4e5eda86>+995</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>瓜德罗普</span> <span data-v-4e5eda86>+590</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>关岛</span> <span data-v-4e5eda86>+1671</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圭亚那</span> <span data-v-4e5eda86>+592</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>海地</span> <span data-v-4e5eda86>+509</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>韩国</span> <span data-v-4e5eda86>+82</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>荷兰</span> <span data-v-4e5eda86>+31</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>荷属安的列斯</span> <span data-v-4e5eda86>+599</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>洪都拉斯</span> <span data-v-4e5eda86>+504</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>吉布提</span> <span data-v-4e5eda86>+253</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加拿大</span> <span data-v-4e5eda86>+1</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>吉尔吉斯斯坦</span> <span data-v-4e5eda86>+996</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>几内亚</span> <span data-v-4e5eda86>+224</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加那利群岛</span> <span data-v-4e5eda86>+3491</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加纳</span> <span data-v-4e5eda86>+233</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加蓬</span> <span data-v-4e5eda86>+241</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>柬埔寨</span> <span data-v-4e5eda86>+855</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>捷克</span> <span data-v-4e5eda86>+420</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>喀麦隆</span> <span data-v-4e5eda86>+237</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>卡塔尔</span> <span data-v-4e5eda86>+974</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>开曼群岛</span> <span data-v-4e5eda86>+1345</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科摩罗</span> <span data-v-4e5eda86>+269</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科索沃</span> <span data-v-4e5eda86>+883</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科特迪瓦</span> <span data-v-4e5eda86>+225</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科威特</span> <span data-v-4e5eda86>+965</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>克罗地亚</span> <span data-v-4e5eda86>+385</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>肯尼亚</span> <span data-v-4e5eda86>+254</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>拉脱维亚</span> <span data-v-4e5eda86>+371</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>莱索托</span> <span data-v-4e5eda86>+266</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>老挝</span> <span data-v-4e5eda86>+856</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>黎巴嫩</span> <span data-v-4e5eda86>+961</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>立陶宛</span> <span data-v-4e5eda86>+370</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>利比里亚</span> <span data-v-4e5eda86>+231</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>利比亚</span> <span data-v-4e5eda86>+218</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>列支敦士登</span> <span data-v-4e5eda86>+423</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>留尼旺岛</span> <span data-v-4e5eda86>+262</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>卢森堡</span> <span data-v-4e5eda86>+352</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>卢旺达</span> <span data-v-4e5eda86>+250</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>罗马尼亚</span> <span data-v-4e5eda86>+40</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马达加斯加</span> <span data-v-4e5eda86>+261</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马尔代夫</span> <span data-v-4e5eda86>+960</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马耳他</span> <span data-v-4e5eda86>+356</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马拉维</span> <span data-v-4e5eda86>+265</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马来西亚</span> <span data-v-4e5eda86>+60</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马里</span> <span data-v-4e5eda86>+223</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马其顿</span> <span data-v-4e5eda86>+389</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马绍尔群岛</span> <span data-v-4e5eda86>+692</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马提尼克</span> <span data-v-4e5eda86>+596</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马约特</span> <span data-v-4e5eda86>+262</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>毛里求斯</span> <span data-v-4e5eda86>+230</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>毛里塔尼亚</span> <span data-v-4e5eda86>+222</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>美国</span> <span data-v-4e5eda86>+1</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>美属萨摩亚</span> <span data-v-4e5eda86>+1684</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>美属维尔京群岛</span> <span data-v-4e5eda86>+1340</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>蒙古</span> <span data-v-4e5eda86>+976</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>蒙塞拉特岛</span> <span data-v-4e5eda86>+1664</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>蒙特內哥羅</span> <span data-v-4e5eda86>+382</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>孟加拉国</span> <span data-v-4e5eda86>+880</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>秘鲁</span> <span data-v-4e5eda86>+51</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>密克罗尼西亚联邦</span> <span data-v-4e5eda86>+691</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>缅甸</span> <span data-v-4e5eda86>+95</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>摩尔多瓦</span> <span data-v-4e5eda86>+373</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>摩洛哥</span> <span data-v-4e5eda86>+212</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>摩纳哥</span> <span data-v-4e5eda86>+377</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>莫桑比克</span> <span data-v-4e5eda86>+258</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>墨西哥</span> <span data-v-4e5eda86>+52</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>纳米比亚</span> <span data-v-4e5eda86>+264</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>南非</span> <span data-v-4e5eda86>+27</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼泊尔</span> <span data-v-4e5eda86>+977</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼加拉瓜</span> <span data-v-4e5eda86>+505</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼日尔</span> <span data-v-4e5eda86>+227</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼日利亚</span> <span data-v-4e5eda86>+234</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>挪威</span> <span data-v-4e5eda86>+47</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>帕劳</span> <span data-v-4e5eda86>+680</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>葡萄牙</span> <span data-v-4e5eda86>+351</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>千里达及托巴哥</span> <span data-v-4e5eda86>+1868</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>日本</span> <span data-v-4e5eda86>+81</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>瑞典</span> <span data-v-4e5eda86>+46</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>瑞士</span> <span data-v-4e5eda86>+41</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣诞岛</span> <span data-v-4e5eda86>+61</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣基茨和尼维斯</span> <span data-v-4e5eda86>+1869</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣卢西亚</span> <span data-v-4e5eda86>+1758</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣马力诺</span> <span data-v-4e5eda86>+223</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣马力诺</span> <span data-v-4e5eda86>+378</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣皮埃尔和密克隆群岛</span> <span data-v-4e5eda86>+508</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣文森特和格林纳丁斯</span> <span data-v-4e5eda86>+1784</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯里兰卡</span> <span data-v-4e5eda86>+94</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯洛伐克</span> <span data-v-4e5eda86>+421</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯洛文尼亚</span> <span data-v-4e5eda86>+386</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯威士兰</span> <span data-v-4e5eda86>+268</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>苏丹</span> <span data-v-4e5eda86>+249</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>苏里南</span> <span data-v-4e5eda86>+597</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>索马里</span> <span data-v-4e5eda86>+252</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塔吉克斯坦</span> <span data-v-4e5eda86>+992</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>沙特阿拉伯</span> <span data-v-4e5eda86>+966</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞舌尔</span> <span data-v-4e5eda86>+248</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞浦路斯</span> <span data-v-4e5eda86>+357</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞内加尔</span> <span data-v-4e5eda86>+221</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞拉利昂</span> <span data-v-4e5eda86>+232</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞尔维亚</span> <span data-v-4e5eda86>+381</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>萨尔瓦多</span> <span data-v-4e5eda86>+503</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>萨尔瓦多</span> <span data-v-4e5eda86>+503</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>汤加</span> <span data-v-4e5eda86>+676</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>坦桑尼亚</span> <span data-v-4e5eda86>+255</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>泰国</span> <span data-v-4e5eda86>+66</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>特克斯和凯科斯群岛</span> <span data-v-4e5eda86>+1649</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>突尼斯</span> <span data-v-4e5eda86>+216</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>图瓦卢</span> <span data-v-4e5eda86>+688</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>土库曼斯坦</span> <span data-v-4e5eda86>+993</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌兹别克斯坦</span> <span data-v-4e5eda86>+998</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌拉圭</span> <span data-v-4e5eda86>+598</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌克兰</span> <span data-v-4e5eda86>+380</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌干达</span> <span data-v-4e5eda86>+256</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>文莱</span> <span data-v-4e5eda86>+673</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>委内瑞拉</span> <span data-v-4e5eda86>+58</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>危地马拉</span> <span data-v-4e5eda86>+502</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>匈牙利</span> <span data-v-4e5eda86>+36</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>新西兰</span> <span data-v-4e5eda86>+64</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>新喀里多尼亚</span> <span data-v-4e5eda86>+687</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>新加坡</span> <span data-v-4e5eda86>+65</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>希腊</span> <span data-v-4e5eda86>+30</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>西萨摩亚</span> <span data-v-4e5eda86>+685</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>西撒哈拉</span> <span data-v-4e5eda86>+212</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>西班牙</span> <span data-v-4e5eda86>+34</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>越南</span> <span data-v-4e5eda86>+84</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>约旦</span> <span data-v-4e5eda86>+962</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>英属维尔京群岛</span> <span data-v-4e5eda86>+1284</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>英国</span> <span data-v-4e5eda86>+44</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>印度尼西亚</span> <span data-v-4e5eda86>+62</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>印度</span> <span data-v-4e5eda86>+91</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>意大利</span> <span data-v-4e5eda86>+39</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>以色列</span> <span data-v-4e5eda86>+972</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>伊朗</span> <span data-v-4e5eda86>+98</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>伊拉克</span> <span data-v-4e5eda86>+964</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>也门</span> <span data-v-4e5eda86>+967</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>亚美尼亚</span> <span data-v-4e5eda86>+374</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>牙买加</span> <span data-v-4e5eda86>+1876</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中非</span> <span data-v-4e5eda86>+236</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>智利</span> <span data-v-4e5eda86>+56</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>直布罗陀</span> <span data-v-4e5eda86>+350</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乍得</span> <span data-v-4e5eda86>+235</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>赞比亚</span> <span data-v-4e5eda86>+260</span></li></ul></div></div> <input maxlength="11" placeholder="请输入要绑定的手机号码" value="" class="input number-input" data-v-6217922a></div> <div class="input-box vcode-box" data-v-6217922a></div> <div class="input-box" data-v-6217922a><input maxlength="4" placeholder="验证码" value="" class="input" data-v-6217922a> <button class="send-vcode-btn" data-v-6217922a>
            获取验证码
          </button></div></div> <button st:name="bindBtn" class="btn" data-v-6217922a>
        绑定手机
      </button></form></div> <!----></div> <!----> <div class="view-container" data-v-6a3e47cf data-v-d6ec2d02><div class="main-header-box" data-v-6a3e47cf><header class="main-header main-header unauthorized visible" data-v-20709686 data-v-6a3e47cf><div class="container" data-v-20709686><a href="/" class="logo" data-v-20709686><img src="//s3.pstatp.com/toutiao/xitu_juejin_web/img/logo.a7995ad.svg" alt="掘金" class="logo-img" data-v-20709686> <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQ1cHgiIGhlaWdodD0iMzhweCIgdmlld0JveD0iMCAwIDQ1IDM4IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPHRpdGxlPkp1ZWppbjwvdGl0bGU+CiAgICA8ZGVzYz5KdWVqaW4uaW08L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iMC4xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iR3JvdXAtMTQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuMDAwMDAwLCA1LjAwMDAwMCkiIGZpbGw9IiMwMDZDRkYiPgogICAgICAgICAgICA8cGF0aCBkPSJNMjEuMjkzNDMyOCwyLjU4MzEzMDQ5IEwxOC4wMTczOTg0LDAgTDE0LjU5NDYyNCwyLjY5ODg3ODAxIEwxNC40MTcyMDc3LDIuODQxODIzMDQgTDE4LjAxNzM5ODQsNS43MTI0MjQ4MyBMMjEuNjI4NjU3OCwyLjg0MTgyMzA0IEwyMS4yOTM0MzI4LDIuNTgzMTMwNDkgWiBNMzMuNzA3ODI4OSwxMi42MDA2Njc0IEwxOC4wMDc5MTA5LDI0Ljk4MDI3NiBMMi4zMTc0ODA0NCwxMi42MDgyNTc0IEwwLDE0LjQ2OTcwNTIgTDE4LjAwNzkxMDksMjguNjY5MDE2NyBMMzYuMDI1NjI1NiwxNC40NjIxMTUyIEwzMy43MDc4Mjg5LDEyLjYwMDY2NzQgWiBNMTguMDA3OTEwOSwxMy42MDUwNzc2IEw5LjQ2NDQxNTU0LDYuODY4NjM1MDUgTDcuMTQ2NjE4ODUsOC43MzAwODI5IEwxOC4wMDc5MTA5LDE3LjI5NDEzNDUgTDI4Ljg3ODM3NDIsOC43MjI0OTI5IEwyNi41NjA1Nzc1LDYuODYxMDQ1MDUgTDE4LjAwNzkxMDksMTMuNjA1MDc3NiBaIiBpZD0iRmlsbC0xLUNvcHkiPjwvcGF0aD4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==" alt="掘金" class="mobile" data-v-20709686></a> <nav role="navigation" class="main-nav" data-v-20709686><ul class="nav-list" data-v-20709686><li class="main-nav-list" data-v-20709686><div class="phone-show-menu" data-v-20709686><span data-v-20709686>首页</span> <div class="icon ion-arrow-down-b" data-v-20709686></div></div> <ul class="phone-hide" data-v-20709686><li class="nav-item link-item route-active" data-v-20709686><a href="/" data-v-20709686>首页</a></li> <li class="nav-item link-item activities" data-v-20709686><a href="/pins" data-v-20709686>沸点</a></li> <li class="nav-item link-item" data-v-20709686><a href="/topics" data-v-20709686>话题</a></li> <li class="nav-item link-item book" data-v-20709686><a href="/books" data-v-20709686>小册</a></li> <li class="nav-item link-item" data-v-20709686><a href="/events/all" data-v-20709686>活动</a></li></ul></li> <li class="nav-item search" data-v-20709686><form role="search" class="search-form" data-v-20709686><input type="search" maxlength="32" placeholder="探索掘金" value="" class="search-input" data-v-20709686> <img src="//s3.pstatp.com/toutiao/xitu_juejin_web/img/juejin-search-icon.6f8ba1b.svg" alt="搜索" class="search-icon" data-v-20709686></form></li> <li class="nav-item add" data-v-20709686><div class="add-group" data-v-20709686><button class="add-btn" data-v-20709686>写文章</button> <div class="more" data-v-20709686><i class="more-icon ion-android-arrow-dropdown" data-v-20709686></i></div> <ul class="more-list" data-v-20709686><li class="item" data-v-20709686>发布沸点</li> <!----></ul></div> <!----></li> <!----> <!----> <li class="nav-item auth" data-v-20709686><button class="login-button" data-v-20709686>登录</button></li></ul></nav></div></header></div>  <main class="container main-container" style="max-width:;" data-v-6a3e47cf><div class="view column-view" data-v-6a3e47cf data-v-d6ec2d02><div class="main-area article-area shadow" data-v-6a3e47cf data-v-d6ec2d02><article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="6844904205556121608" data-draft-id="6845076845545684999" class="article" data-v-d6ec2d02><meta itemprop="url" content="https://juejin.im/post/6844904205556121608"> <meta itemprop="headline" content="Kubernetes高可用集群二进制安装"> <meta itemprop="keywords" content="Kubernetes"> <meta itemprop="datePublished" content="2020-07-01T04:18:27.000Z"> <meta itemprop="image" content="https://b-gold-cdn.xitu.io/icon/icon-128.png"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iuskye"> <meta itemprop="url" content="https://juejin.im/user/1503787639375096"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://b-gold-cdn.xitu.io/icon/icon-white-180.png"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <div class="author-info-block" data-v-d6ec2d02><a href="/user/1503787639375096" target="_blank" rel="" class="avatar-link" data-v-d6ec2d02><div data-src="https://user-gold-cdn.xitu.io/2020/7/1/173088b467209a0b?imageView2/1/w/100/h/100/q/85/interlace/1" class="lazy avatar avatar" style="background-image:none;" data-v-47cc2604 data-v-1c418ef0 data-v-d6ec2d02></div></a> <div class="author-info-box" data-v-d6ec2d02><!----> <div class="meta-box" data-v-d6ec2d02><time datetime="2020-07-01T04:18:27.000Z" title="Wed Jul 01 2020 12:18:27 GMT+0800 (China Standard Time)" class="time" data-v-d6ec2d02>
                  2020年07月01日
                </time> <span class="views-count" data-v-d6ec2d02>阅读 784</span> <!----></div></div> <button class="follow-button follow" data-v-06c7d5b3 data-v-d6ec2d02><span data-v-06c7d5b3>关注</span></button></div> <!----> <!----> <h1 class="article-title" data-v-d6ec2d02>Kubernetes高可用集群二进制安装</h1> <div itemprop="articleBody" class="article-content" data-v-d6ec2d02><div><section style="font-size: 16px; color: black; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; margin-top: -10px; font-family: PingFangSC-Light;" id="user-content-nice"><h2 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;" data-id="heading-0"><span style="display: none;" class="prefix"></span><span style="font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;" class="content">1. 前置知识点</span><span class="suffix"></span></h2>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-1"><span style="display: none;" class="prefix"></span><span class="content">1.1 生产环境可部署Kubernetes集群的两种方式</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">目前生产部署Kubernetes集群主要有两种方式：</p>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">Kubeadm
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: square;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">Kubeadm是一个K8s部署工具，提供kubeadm init和kubeadm join，用于快速部署Kubernetes集群。官方地址：<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/</code>。</section></li></ul>
</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">二进制包
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: square;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">从github下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群。Kubeadm降低部署门槛，但屏蔽了很多细节，遇到问题很难排查。如果想更容易可控，推荐使用二进制包部署Kubernetes集群，虽然手动部署麻烦点，期间可以学习很多工作原理，也利于后期维护。</section></li></ul>
</section></li></ul>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-2"><span style="display: none;" class="prefix"></span><span class="content">1.2 安装要求</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">在开始之前，部署Kubernetes集群机器需要满足以下几个条件：</p>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">一台或多台机器，操作系统 CentOS7.x-86_x64</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">硬件配置：2GB或更多RAM，2个CPU或更多CPU，硬盘30GB或更多</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">可以访问外网，需要拉取镜像，如果服务器不能上网，需要提前下载镜像并导入节点</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">禁止swap分区</section></li></ul>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-3"><span style="display: none;" class="prefix"></span><span class="content">1.3 准备环境</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">软件环境：</p>
<table style="display: table; text-align: left;">
<thead>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">软件</th>
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">版本</th>
</tr>
</thead>
<tbody style="border: 0;">
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">操作系统</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">CentOS7.6_x64(mini)</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">Docker</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">19-ce</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">Kubernetes</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">1.18</td>
</tr>
</tbody>
</table>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">服务器规划：</p>
<table style="display: table; text-align: left;">
<thead>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">角色</th>
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">IP</th>
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">组件</th>
</tr>
</thead>
<tbody style="border: 0;">
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-master1</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.204</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">kube-apiserver, kube-controller-manager, kube-scheduler, etcd</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-master2</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.230</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">kube-apiserver, kube-controller-manager, kube-scheduler, etcd</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-worker1</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.151</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">kubelet, kube-proxy, docker, etcd</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-worker2</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.186</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">kubelet, kube-proxy, docker, etcd</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-lb1</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.220, 10.1.1.170(VIP)</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">Nginx L4</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-lb2</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.169</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">Nginx L4</td>
</tr>
</tbody>
</table>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">须知：考虑到有些朋友电脑配置较低，这么多虚拟机跑不动，所以这一套高可用集群分两部分实施，先部署一套单Master架构（10.1.1.204/151/186），再扩容为多Master架构（上述规划），顺便熟悉下Master扩容流程。</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">单Master架构图：</p>
<figure style="margin: 0; margin-top: 10px; margin-bottom: 10px;"><img style="max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;" alt="" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2020/7/1/1730895b367d0ea1?imageView2/0/w/1280/h/960/ignore-error/1" data-width="1280" data-height="930"></figure>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">单Master服务器规划：</p>
<table style="display: table; text-align: left;">
<thead>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">角色</th>
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">IP</th>
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">组件</th>
</tr>
</thead>
<tbody style="border: 0;">
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-master1</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.204</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">kube-apiserver, kube-controller-manager, kube-scheduler, etcd</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-worker1</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.151</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">kubelet, kube-proxy, docker, etcd</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-worker2</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.186</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">kubelet, kube-proxy, docker, etcd</td>
</tr>
</tbody>
</table>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-4"><span style="display: none;" class="prefix"></span><span class="content">1.4 操作系统初始化配置</span><span style="display: none;" class="suffix"></span></h4>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable"><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 关闭防火墙</span>
<span>systemctl stop firewalld
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">disable</span> firewalld
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 关闭selinux</span>
<span>sed -i <span style="color: #98c379; line-height: 26px;" class="hljs-string">'s/enforcing/disabled/'</span> /etc/selinux/config  <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 永久</span>
<span>setenforce 0  <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 临时</span>
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 关闭swap</span>
<span>swapoff -a  <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 临时</span>
<span>sed -ri <span style="color: #98c379; line-height: 26px;" class="hljs-string">'s/.*swap.*/#&#x26;/'</span> /etc/fstab    <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 永久</span>
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 根据规划设置主机名</span>
<span>hostnamectl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">set</span>-hostname &#x3C;hostname>
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 在所有主机添加hosts</span>
<span>cat >> /etc/hosts &#x3C;&#x3C; EOF
<span>10.1.1.204 k8s-master1
<span>10.1.1.230 k8s-master2
<span>10.1.1.151 k8s-worker1
<span>10.1.1.186 k8s-worker2
<span>10.1.1.220 k8s-lb1
<span>10.1.1.169 k8s-lb2
<span>EOF
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 将桥接的IPv4流量传递到iptables的链</span>
<span>cat > /etc/sysctl.d/k8s.conf &#x3C;&#x3C; EOF
<span>net.bridge.bridge-nf-call-ip6tables = 1
<span>net.bridge.bridge-nf-call-iptables = 1
<span>EOF
<span>sysctl --system  <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 生效</span>
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 时间同步</span>
<span>yum install ntpdate -y
<span>ntpdate time.windows.com
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h2 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;" data-id="heading-5"><span style="display: none;" class="prefix"></span><span style="font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;" class="content">2. 部署Etcd集群</span><span class="suffix"></span></h2>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">Etcd 是一个分布式键值存储系统，Kubernetes使用Etcd进行数据存储，所以先准备一个Etcd数据库，为解决Etcd单点故障，应采用集群方式部署，这里使用3台组建集群，可容忍1台机器故障，当然，你也可以使用5台组建集群，可容忍2台机器故障。</p>
<table style="display: table; text-align: left;">
<thead>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">节点名称</th>
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">IP</th>
</tr>
</thead>
<tbody style="border: 0;">
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">etcd1(k8s-master1)</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.204</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">etcd2(k8s-worker1)</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.151</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">etcd3(k8s-worker2)</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.186</td>
</tr>
</tbody>
</table>
<blockquote style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;"><span style="display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;">★ </span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;">注：为了节省机器，这里与K8s节点机器复用。也可以独立于k8s集群之外部署，只要apiserver能连接到就行。</p>
<span style="float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;">”</span></blockquote>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-6"><span style="display: none;" class="prefix"></span><span class="content">2.1 准备cfssl证书生成工具</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">cfssl是一个开源的证书管理工具，使用json文件生成证书，相比openssl更方便使用。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">找任意一台服务器操作，这里用Master节点。</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64
<span>wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64
<span>wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64
<span>chmod +x cfssl_linux-amd64 cfssljson_linux-amd64 cfssl-certinfo_linux-amd64
<span>mv cfssl_linux-amd64 /usr/<span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">local</span>/bin/cfssl
<span>mv cfssljson_linux-amd64 /usr/<span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">local</span>/bin/cfssljson
<span>mv cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo
<span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-7"><span style="display: none;" class="prefix"></span><span class="content">2.2 生成Etcd证书</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 自签证书颁发机构（CA）</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">创建工作目录：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">mkdir -p ~/TLS/{etcd,k8s}
<span><span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">cd</span> ~/TLS/etcd
<span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">自签CA：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > ca-config.json &#x3C;&#x3C; EOF
<span>{
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"signing"</span>: {
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"default"</span>: {
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"expiry"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"87600h"</span>
<span>    },
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"profiles"</span>: {
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"www"</span>: {
<span>         <span style="color: #98c379; line-height: 26px;" class="hljs-string">"expiry"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"87600h"</span>,
<span>         <span style="color: #98c379; line-height: 26px;" class="hljs-string">"usages"</span>: [
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"signing"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"key encipherment"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"server auth"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"client auth"</span>
<span>        ]
<span>      }
<span>    }
<span>  }
<span>}
<span>EOF
<span>
<span>cat > ca-csr.json &#x3C;&#x3C; EOF
<span>{
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"CN"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"etcd CA"</span>,
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"key"</span>: {
<span>        <span style="color: #98c379; line-height: 26px;" class="hljs-string">"algo"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"rsa"</span>,
<span>        <span style="color: #98c379; line-height: 26px;" class="hljs-string">"size"</span>: 2048
<span>    },
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"names"</span>: [
<span>        {
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"C"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"CN"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"L"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"Beijing"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"ST"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"Beijing"</span>
<span>        }
<span>    ]
<span>}
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">生成证书：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
<span>ls *pem
<span>ca-key.pem  ca.pem
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. 使用自签CA签发Etcd HTTPS证书</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">创建证书申请文件：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > server-csr.json &#x3C;&#x3C; EOF
<span>{
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"CN"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"etcd"</span>,
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"hosts"</span>: [
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.1.1.204"</span>,
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.1.1.151"</span>,
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.1.1.186"</span>
<span>    ],
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"key"</span>: {
<span>        <span style="color: #98c379; line-height: 26px;" class="hljs-string">"algo"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"rsa"</span>,
<span>        <span style="color: #98c379; line-height: 26px;" class="hljs-string">"size"</span>: 2048
<span>    },
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"names"</span>: [
<span>        {
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"C"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"CN"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"L"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"BeiJing"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"ST"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"BeiJing"</span>
<span>        }
<span>    ]
<span>}
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<blockquote style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;"><span style="display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;">★ </span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;">注：上述文件hosts字段中IP为所有etcd节点的集群内部通信IP，一个都不能少！为了方便后期扩容可以多写几个预留的IP。</p>
<span style="float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;">”</span></blockquote>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">生成证书：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=www server-csr.json | cfssljson -bare server
<span>
<span>ls server*pem
<span>server-key.pem  server.pem
<span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-8"><span style="display: none;" class="prefix"></span><span class="content">2.3 从GitHub上下载二进制文件</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">下载地址：<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">https://github.com/etcd-io/etcd/releases/download/v3.4.9/etcd-v3.4.9-linux-amd64.tar.gz</code></p>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-9"><span style="display: none;" class="prefix"></span><span class="content">2.4 部署Etcd集群</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">以下在节点1上操作，为简化操作，待会将节点1生成的所有文件拷贝到节点2和节点3。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 创建工作目录并解压二进制包</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">mkdir /opt/etcd/{bin,cfg,ssl} -p
<span>tar zxvf etcd-v3.4.9-linux-amd64.tar.gz
<span>mv etcd-v3.4.9-linux-amd64/{etcd,etcdctl} /opt/etcd/bin/
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. 创建etcd配置文件</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /opt/etcd/cfg/etcd.conf &#x3C;&#x3C; EOF
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment">#[Member]</span>
<span>ETCD_NAME=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"etcd-1"</span>
<span>ETCD_DATA_DIR=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"/var/lib/etcd/default.etcd"</span>
<span>ETCD_LISTEN_PEER_URLS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://10.1.1.204:2380"</span>
<span>ETCD_LISTEN_CLIENT_URLS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://10.1.1.204:2379"</span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment">#[Clustering]</span>
<span>ETCD_INITIAL_ADVERTISE_PEER_URLS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://10.1.1.204:2380"</span>
<span>ETCD_ADVERTISE_CLIENT_URLS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://10.1.1.204:2379"</span>
<span>ETCD_INITIAL_CLUSTER=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"etcd-1=https://10.1.1.204:2380,etcd-2=https://10.1.1.151:2380,etcd-3=https://10.1.1.186:2380"</span>
<span>ETCD_INITIAL_CLUSTER_TOKEN=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"etcd-cluster"</span>
<span>ETCD_INITIAL_CLUSTER_STATE=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"new"</span>
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">ETCD_NAME：节点名称，集群中唯一</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">ETCD_DATA_DIR：数据目录</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">ETCD_LISTEN_PEER_URLS：集群通信监听地址</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">ETCD_LISTEN_CLIENT_URLS：客户端访问监听地址</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">ETCD_INITIAL_ADVERTISE_PEER_URLS：集群通告地址</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">ETCD_ADVERTISE_CLIENT_URLS：客户端通告地址</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">ETCD_INITIAL_CLUSTER：集群节点地址</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">ETCD_INITIAL_CLUSTER_TOKEN：集群Token</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">ETCD_INITIAL_CLUSTER_STATE：加入集群的当前状态，new是新集群，existing表示加入已有集群</section></li></ul>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">3. systemd管理etcd集群</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /usr/lib/systemd/system/etcd.service &#x3C;&#x3C; EOF
<span>[Unit]
<span>Description=Etcd Server
<span>After=network.target
<span>After=network-online.target
<span>Wants=network-online.target
<span>[Service]
<span>Type=notify
<span>EnvironmentFile=/opt/etcd/cfg/etcd.conf
<span>ExecStart=/opt/etcd/bin/etcd \
<span>--cert-file=/opt/etcd/ssl/server.pem \
<span>--key-file=/opt/etcd/ssl/server-key.pem \
<span>--peer-cert-file=/opt/etcd/ssl/server.pem \
<span>--peer-key-file=/opt/etcd/ssl/server-key.pem \
<span>--trusted-ca-file=/opt/etcd/ssl/ca.pem \
<span>--peer-trusted-ca-file=/opt/etcd/ssl/ca.pem \
<span>--logger=zap
<span>Restart=on-failure
<span>LimitNOFILE=65536
<span>[Install]
<span>WantedBy=multi-user.target
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">4. 拷贝刚才生成的证书</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">把刚才生成的证书拷贝到配置文件中的路径：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cp ~/TLS/etcd/ca*pem ~/TLS/etcd/server*pem /opt/etcd/ssl/
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">5. 启动并设置开机自启</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">systemctl daemon-reload
<span>systemctl start etcd
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> etcd
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">6. 将上面节点1所有生成的文件拷贝到节点2和节点3</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">scp -r /opt/etcd/ root@10.1.1.151:/opt/
<span>scp /usr/lib/systemd/system/etcd.service root@10.1.1.151:/usr/lib/systemd/system/
<span>scp -r /opt/etcd/ root@10.1.1.186:/opt/
<span>scp /usr/lib/systemd/system/etcd.service root@10.1.1.186:/usr/lib/systemd/system/
<span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">然后在节点2和节点3分别修改etcd.conf配置文件中的节点名称和当前服务器IP：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">vi /opt/etcd/cfg/etcd.conf
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment">#[Member]</span>
<span>ETCD_NAME=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"etcd-1"</span>   <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 修改此处，节点2改为etcd-2，节点3改为etcd-3</span>
<span>ETCD_DATA_DIR=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"/var/lib/etcd/default.etcd"</span>
<span>ETCD_LISTEN_PEER_URLS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://192.168.31.71:2380"</span>   <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 修改此处为当前服务器IP</span>
<span>ETCD_LISTEN_CLIENT_URLS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://192.168.31.71:2379"</span> <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 修改此处为当前服务器IP</span>
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment">#[Clustering]</span>
<span>ETCD_INITIAL_ADVERTISE_PEER_URLS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://192.168.31.71:2380"</span> <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 修改此处为当前服务器IP</span>
<span>ETCD_ADVERTISE_CLIENT_URLS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://192.168.31.71:2379"</span> <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 修改此处为当前服务器IP</span>
<span>ETCD_INITIAL_CLUSTER=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"etcd-1=https://192.168.31.71:2380,etcd-2=https://192.168.31.72:2380,etcd-3=https://192.168.31.73:2380"</span>
<span>ETCD_INITIAL_CLUSTER_TOKEN=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"etcd-cluster"</span>
<span>ETCD_INITIAL_CLUSTER_STATE=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"new"</span>
<span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">最后启动etcd并设置开机启动，同上。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">7. 查看集群状态</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">ETCDCTL_API=3 /opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://10.1.1.204:2379,https://10.1.1.151:2379,https://10.1.1.186:2379"</span> endpoint health
<span>
<span>https://10.1.1.204:2379 is healthy: successfully committed proposal: took = 12.415974ms
<span>https://10.1.1.151:2379 is healthy: successfully committed proposal: took = 14.409434ms
<span>https://10.1.1.186:2379 is healthy: successfully committed proposal: took = 14.447958ms
<span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">如果输出上面信息，就说明集群部署成功。如果有问题第一步先看日志：/var/log/message 或 journalctl -u etcd</p>
<h2 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;" data-id="heading-10"><span style="display: none;" class="prefix"></span><span style="font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;" class="content">3. 安装Docker</span><span class="suffix"></span></h2>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">下载地址：<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">https://download.docker.com/linux/static/stable/x86_64/docker-19.03.9.tgz</code>。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">以下在所有节点操作。这里采用二进制安装，用yum安装也一样。</p>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-11"><span style="display: none;" class="prefix"></span><span class="content">3.1 解压二进制包</span><span style="display: none;" class="suffix"></span></h4>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">tar zxf docker-19.03.9.tgz
<span>mv docker/* /usr/bin
<span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-12"><span style="display: none;" class="prefix"></span><span class="content">3.2 systemd管理docker</span><span style="display: none;" class="suffix"></span></h4>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /usr/lib/systemd/system/docker.service &#x3C;&#x3C; EOF
<span>[Unit]
<span>Description=Docker Application Container Engine
<span>Documentation=https://docs.docker.com
<span>After=network-online.target firewalld.service
<span>Wants=network-online.target
<span>[Service]
<span>Type=notify
<span>ExecStart=/usr/bin/dockerd
<span>ExecReload=/bin/<span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">kill</span> -s HUP <span style="color: #d19a66; line-height: 26px;" class="hljs-variable">$MAINPID</span>
<span>LimitNOFILE=infinity
<span>LimitNPROC=infinity
<span>LimitCORE=infinity
<span>TimeoutStartSec=0
<span>Delegate=yes
<span>KillMode=process
<span>Restart=on-failure
<span>StartLimitBurst=3
<span>StartLimitInterval=60s
<span>[Install]
<span>WantedBy=multi-user.target
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-13"><span style="display: none;" class="prefix"></span><span class="content">3.3 创建配置文件</span><span style="display: none;" class="suffix"></span></h4>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">mkdir /etc/docker
<span>cat > /etc/docker/daemon.json &#x3C;&#x3C; EOF
<span>{
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"registry-mirrors"</span>: [<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://b9pmyelo.mirror.aliyuncs.com"</span>]
<span>}
<span>EOF
<span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">registry-mirrors 阿里云镜像加速器</section></li></ul>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-14"><span style="display: none;" class="prefix"></span><span class="content">3.4 启动并设置开机启动</span><span style="display: none;" class="suffix"></span></h4>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">systemctl daemon-reload
<span>systemctl start docker
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> docker
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h2 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;" data-id="heading-15"><span style="display: none;" class="prefix"></span><span style="font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;" class="content">4. 部署Master Node</span><span class="suffix"></span></h2>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-16"><span style="display: none;" class="prefix"></span><span class="content">4.1 生成kube-apiserver证书</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 自签证书颁发机构（CA）</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable"><span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">cd</span> ~/TLS/k8s/
<span>
<span>cat > ca-config.json &#x3C;&#x3C; EOF
<span>{
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"signing"</span>: {
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"default"</span>: {
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"expiry"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"87600h"</span>
<span>    },
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"profiles"</span>: {
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"kubernetes"</span>: {
<span>         <span style="color: #98c379; line-height: 26px;" class="hljs-string">"expiry"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"87600h"</span>,
<span>         <span style="color: #98c379; line-height: 26px;" class="hljs-string">"usages"</span>: [
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"signing"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"key encipherment"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"server auth"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"client auth"</span>
<span>        ]
<span>      }
<span>    }
<span>  }
<span>}
<span>EOF
<span>
<span>cat > ca-csr.json &#x3C;&#x3C; EOF
<span>{
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"CN"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"kubernetes"</span>,
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"key"</span>: {
<span>        <span style="color: #98c379; line-height: 26px;" class="hljs-string">"algo"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"rsa"</span>,
<span>        <span style="color: #98c379; line-height: 26px;" class="hljs-string">"size"</span>: 2048
<span>    },
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"names"</span>: [
<span>        {
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"C"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"CN"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"L"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"Beijing"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"ST"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"Beijing"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"O"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"k8s"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"OU"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"System"</span>
<span>        }
<span>    ]
<span>}
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">生成证书：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
<span>
<span>ls *pem
<span>ca-key.pem  ca.pem
<span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. 使用自签CA签发kube-apiserver HTTPS证书</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">创建证书申请文件：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > server-csr.json &#x3C;&#x3C; EOF
<span>{
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"CN"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"kubernetes"</span>,
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"hosts"</span>: [
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.0.0.1"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"127.0.0.1"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.1.1.204"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.1.1.230"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.1.1.151"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.1.1.186"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.1.1.220"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.1.1.169"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"10.1.1.170"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"kubernetes"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"kubernetes.default"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"kubernetes.default.svc"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"kubernetes.default.svc.cluster"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"kubernetes.default.svc.cluster.local"</span>
<span>    ],
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"key"</span>: {
<span>        <span style="color: #98c379; line-height: 26px;" class="hljs-string">"algo"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"rsa"</span>,
<span>        <span style="color: #98c379; line-height: 26px;" class="hljs-string">"size"</span>: 2048
<span>    },
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"names"</span>: [
<span>        {
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"C"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"CN"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"L"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"BeiJing"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"ST"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"BeiJing"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"O"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"k8s"</span>,
<span>            <span style="color: #98c379; line-height: 26px;" class="hljs-string">"OU"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"System"</span>
<span>        }
<span>    ]
<span>}
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<blockquote style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;"><span style="display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;">★ </span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;">注：上述文件hosts字段中IP为所有Master/LB/VIP IP，一个都不能少！为了方便后期扩容可以多写几个预留的IP。</p>
<span style="float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;">”</span></blockquote>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">生成证书：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes server-csr.json | cfssljson -bare server
<span>
<span>ls server*pem
<span>server-key.pem  server.pem
<span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-17"><span style="display: none;" class="prefix"></span><span class="content">4.2 从GitHub下载二进制文件</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">下载地址<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.18.md#v1183</code>。</p>
<blockquote style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;"><span style="display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;">★ </span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;">注：打开链接你会发现里面有很多包，下载一个server包就够了，包含了Master和Worker Node二进制文件。</p>
<span style="float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;">”</span></blockquote>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">例如：<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">https://dl.k8s.io/v1.18.3/kubernetes-server-linux-amd64.tar.gz</code>。</p>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-18"><span style="display: none;" class="prefix"></span><span class="content">4.3 解压二进制包</span><span style="display: none;" class="suffix"></span></h4>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">mkdir -p /opt/kubernetes/{bin,cfg,ssl,logs} 
<span>tar zxf kubernetes-server-linux-amd64.tar.gz
<span><span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">cd</span> kubernetes/server/bin
<span>cp kube-apiserver kube-scheduler kube-controller-manager /opt/kubernetes/bin
<span>cp kubectl /usr/bin/
<span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-19"><span style="display: none;" class="prefix"></span><span class="content">4.4 部署kube-apiserver</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 创建配置文件</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /opt/kubernetes/cfg/kube-apiserver.conf &#x3C;&#x3C; EOF
<span>KUBE_APISERVER_OPTS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"--logtostderr=false \\
<span>--v=2 \\
<span>--log-dir=/opt/kubernetes/logs \\
<span>--etcd-servers=https://10.1.1.204:2379,https://10.1.1.151:2379,https://10.1.1.186:2379 \\
<span>--bind-address=10.1.1.204 \\
<span>--secure-port=6443 \\
<span>--advertise-address=10.1.1.204 \\
<span>--allow-privileged=true \\
<span>--service-cluster-ip-range=10.0.0.0/24 \\
<span>--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\
<span>--authorization-mode=RBAC,Node \\
<span>--enable-bootstrap-token-auth=true \\
<span>--token-auth-file=/opt/kubernetes/cfg/token.csv \\
<span>--service-node-port-range=30000-32767 \\
<span>--kubelet-client-certificate=/opt/kubernetes/ssl/server.pem \\
<span>--kubelet-client-key=/opt/kubernetes/ssl/server-key.pem \\
<span>--tls-cert-file=/opt/kubernetes/ssl/server.pem  \\
<span>--tls-private-key-file=/opt/kubernetes/ssl/server-key.pem \\
<span>--client-ca-file=/opt/kubernetes/ssl/ca.pem \\
<span>--service-account-key-file=/opt/kubernetes/ssl/ca-key.pem \\
<span>--etcd-cafile=/opt/etcd/ssl/ca.pem \\
<span>--etcd-certfile=/opt/etcd/ssl/server.pem \\
<span>--etcd-keyfile=/opt/etcd/ssl/server-key.pem \\
<span>--audit-log-maxage=30 \\
<span>--audit-log-maxbackup=3 \\
<span>--audit-log-maxsize=100 \\
<span>--audit-log-path=/opt/kubernetes/logs/k8s-audit.log"</span>
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<blockquote style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;"><span style="display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;">★ </span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;">注：上面两个\ \ 第一个是转义符，第二个是换行符，使用转义符是为了使用EOF保留换行符。</p>
<span style="float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;">”</span></blockquote>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--logtostderr：启用日志</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--v：日志等级</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--log-dir：日志目录</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--etcd-servers：etcd集群地址</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--bind-address：监听地址</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--secure-port：https安全端口</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--advertise-address：集群通告地址</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--allow-privileged：启用授权</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--service-cluster-ip-range：Service虚拟IP地址段</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--enable-admission-plugins：准入控制模块</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--authorization-mode：认证授权，启用RBAC授权和节点自管理</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--enable-bootstrap-token-auth：启用TLS bootstrap机制</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--token-auth-file：bootstrap token文件</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--service-node-port-range：Service nodeport类型默认分配端口范围</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--kubelet-client-xxx：apiserver访问kubelet客户端证书</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--tls-xxx-file：apiserver https证书</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--etcd-xxxfile：连接Etcd集群证书</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--audit-log-xxx：审计日志</section></li></ul>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. 拷贝刚才生成的证书</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">把刚才生成的证书拷贝到配置文件中的路径：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cp ~/TLS/k8s/ca*pem ~/TLS/k8s/server*pem /opt/kubernetes/ssl/
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">3. 启用 TLS Bootstrapping 机制</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">TLS Bootstraping：Master apiserver启用TLS认证后，Node节点kubelet和kube-proxy要与kube-apiserver进行通信，必须使用CA签发的有效证书才可以，当Node节点很多时，这种客户端证书颁发需要大量工作，同样也会增加集群扩展复杂度。为了简化流程，Kubernetes引入了TLS bootstraping机制来自动颁发客户端证书，kubelet会以一个低权限用户自动向apiserver申请证书，kubelet的证书由apiserver动态签署。所以强烈建议在Node上使用这种方式，目前主要用于kubelet，kube-proxy还是由我们统一颁发一个证书。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">TLS bootstraping 工作流程：</p>
<figure style="margin: 0; margin-top: 10px; margin-bottom: 10px;"><img style="max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;" alt="" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2020/7/1/1730895b37203331?imageView2/0/w/1280/h/960/ignore-error/1" data-width="779" data-height="677"></figure>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">创建上述配置文件中token文件：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /opt/kubernetes/cfg/token.csv &#x3C;&#x3C; EOF
<span>8054b7219e601b121e8d2b4f73d255ad,kubelet-bootstrap,10001,<span style="color: #98c379; line-height: 26px;" class="hljs-string">"system:node-bootstrapper"</span>
<span>EOF
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">格式：token，用户名，UID，用户组</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">token也可自行生成替换：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">head -c 16 /dev/urandom | od -An -t x | tr -d <span style="color: #98c379; line-height: 26px;" class="hljs-string">' '</span>
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">4. systemd管理apiserver</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /usr/lib/systemd/system/kube-apiserver.service &#x3C;&#x3C; EOF
<span>[Unit]
<span>Description=Kubernetes API Server
<span>Documentation=https://github.com/kubernetes/kubernetes
<span>[Service]
<span>EnvironmentFile=/opt/kubernetes/cfg/kube-apiserver.conf
<span>ExecStart=/opt/kubernetes/bin/kube-apiserver \<span style="color: #d19a66; line-height: 26px;" class="hljs-variable">$KUBE_APISERVER_OPTS</span>
<span>Restart=on-failure
<span>[Install]
<span>WantedBy=multi-user.target
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">5. 启动并设置开机启动</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">systemctl daemon-reload
<span>systemctl start kube-apiserver
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kube-apiserver
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">6. 授权kubelet-bootstrap用户允许请求证书</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl create clusterrolebinding kubelet-bootstrap \
<span>--clusterrole=system:node-bootstrapper \
<span>--user=kubelet-bootstrap
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-20"><span style="display: none;" class="prefix"></span><span class="content">4.5 部署kube-controller-manager</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 创建配置文件</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /opt/kubernetes/cfg/kube-controller-manager.conf &#x3C;&#x3C; EOF
<span>KUBE_CONTROLLER_MANAGER_OPTS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"--logtostderr=false \\
<span>--v=2 \\
<span>--log-dir=/opt/kubernetes/logs \\
<span>--leader-elect=true \\
<span>--master=127.0.0.1:8080 \\
<span>--bind-address=127.0.0.1 \\
<span>--allocate-node-cidrs=true \\
<span>--cluster-cidr=10.244.0.0/16 \\
<span>--service-cluster-ip-range=10.0.0.0/24 \\
<span>--cluster-signing-cert-file=/opt/kubernetes/ssl/ca.pem \\
<span>--cluster-signing-key-file=/opt/kubernetes/ssl/ca-key.pem  \\
<span>--root-ca-file=/opt/kubernetes/ssl/ca.pem \\
<span>--service-account-private-key-file=/opt/kubernetes/ssl/ca-key.pem \\
<span>--experimental-cluster-signing-duration=87600h0m0s"</span>
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--master：通过本地非安全本地端口8080连接apiserver</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--leader-elect：当该组件启动多个时，自动选举（HA）</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--cluster-signing-cert-file/–cluster-signing-key-file：自动为kubelet颁发证书的CA，与apiserver保持一致</section></li></ul>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. systemd管理controller-manager</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /usr/lib/systemd/system/kube-controller-manager.service &#x3C;&#x3C; EOF
<span>[Unit]
<span>Description=Kubernetes Controller Manager
<span>Documentation=https://github.com/kubernetes/kubernetes
<span>[Service]
<span>EnvironmentFile=/opt/kubernetes/cfg/kube-controller-manager.conf
<span>ExecStart=/opt/kubernetes/bin/kube-controller-manager \<span style="color: #d19a66; line-height: 26px;" class="hljs-variable">$KUBE_CONTROLLER_MANAGER_OPTS</span>
<span>Restart=on-failure
<span>[Install]
<span>WantedBy=multi-user.target
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">3. 启动并设置开机启动</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">systemctl daemon-reload
<span>systemctl start kube-controller-manager
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kube-controller-manager
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-21"><span style="display: none;" class="prefix"></span><span class="content">4.6 部署kube-scheduler</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 创建配置文件</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /opt/kubernetes/cfg/kube-scheduler.conf &#x3C;&#x3C; EOF
<span>KUBE_SCHEDULER_OPTS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"--logtostderr=false \
<span>--v=2 \
<span>--log-dir=/opt/kubernetes/logs \
<span>--leader-elect \
<span>--master=127.0.0.1:8080 \
<span>--bind-address=127.0.0.1"</span>
<span>EOF
<span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--master：通过本地非安全本地端口8080连接apiserver</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">--leader-elect：当该组件启动多个时，自动选举（HA）</section></li></ul>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. systemd管理scheduler</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /usr/lib/systemd/system/kube-scheduler.service &#x3C;&#x3C; EOF
<span>[Unit]
<span>Description=Kubernetes Scheduler
<span>Documentation=https://github.com/kubernetes/kubernetes
<span>[Service]
<span>EnvironmentFile=/opt/kubernetes/cfg/kube-scheduler.conf
<span>ExecStart=/opt/kubernetes/bin/kube-scheduler \<span style="color: #d19a66; line-height: 26px;" class="hljs-variable">$KUBE_SCHEDULER_OPTS</span>
<span>Restart=on-failure
<span>[Install]
<span>WantedBy=multi-user.target
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">3. 启动并设置开机启动</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">systemctl daemon-reload
<span>systemctl start kube-scheduler
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kube-scheduler
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">4. 查看集群状态</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">所有组件都已经启动成功，通过kubectl工具查看当前集群组件状态：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl get cs
<span>
<span>NAME                 STATUS    MESSAGE             ERROR
<span>scheduler            Healthy   ok                  
<span>controller-manager   Healthy   ok                  
<span>etcd-0               Healthy   {<span style="color: #98c379; line-height: 26px;" class="hljs-string">"health"</span>:<span style="color: #98c379; line-height: 26px;" class="hljs-string">"true"</span>}   
<span>etcd-2               Healthy   {<span style="color: #98c379; line-height: 26px;" class="hljs-string">"health"</span>:<span style="color: #98c379; line-height: 26px;" class="hljs-string">"true"</span>}   
<span>etcd-1               Healthy   {<span style="color: #98c379; line-height: 26px;" class="hljs-string">"health"</span>:<span style="color: #98c379; line-height: 26px;" class="hljs-string">"true"</span>}
<span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">如上输出说明Master节点组件运行正常。</p>
<h2 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;" data-id="heading-22"><span style="display: none;" class="prefix"></span><span style="font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;" class="content">5. 部署Worker Node</span><span class="suffix"></span></h2>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">下面还是在Master Node上操作，即同时作为Worker Node。</p>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-23"><span style="display: none;" class="prefix"></span><span class="content">5.1 创建工作目录并拷贝二进制文件</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">在所有worker node创建工作目录：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">mkdir -p /opt/kubernetes/{bin,cfg,ssl,logs}
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">从master节点拷贝：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable"><span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">cd</span> ~/kubernetes/server/bin
<span>cp kubelet kube-proxy /opt/kubernetes/bin   <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 本地拷贝</span>
<span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-24"><span style="display: none;" class="prefix"></span><span class="content">5.2 部署kubelet</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 创建配置文件</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /opt/kubernetes/cfg/kubelet.conf &#x3C;&#x3C; EOF
<span>KUBELET_OPTS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"--logtostderr=false \\
<span>--v=2 \\
<span>--log-dir=/opt/kubernetes/logs \\
<span>--hostname-override=k8s-master1 \\
<span>--network-plugin=cni \\
<span>--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\
<span>--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\
<span>--config=/opt/kubernetes/cfg/kubelet-config.yml \\
<span>--cert-dir=/opt/kubernetes/ssl \\
<span>--pod-infra-container-image=lizhenliang/pause-amd64:3.0"</span>
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">–hostname-override：显示名称，集群中唯一</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">–network-plugin：启用CNI</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">–kubeconfig：空路径，会自动生成，后面用于连接apiserver</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">–bootstrap-kubeconfig：首次启动向apiserver申请证书</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">–config：配置参数文件</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">–cert-dir：kubelet证书生成目录</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">–pod-infra-container-image：管理Pod网络容器的镜像</section></li></ul>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. 配置参数文件</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /opt/kubernetes/cfg/kubelet-config.yml &#x3C;&#x3C; EOF
<span>kind: KubeletConfiguration
<span>apiVersion: kubelet.config.k8s.io/v1beta1
<span>address: 0.0.0.0
<span>port: 10250
<span>readOnlyPort: 10255
<span>cgroupDriver: cgroupfs
<span>clusterDNS:
<span>- 10.0.0.2
<span>clusterDomain: cluster.local 
<span>failSwapOn: <span style="color: #56b6c2; line-height: 26px;" class="hljs-literal">false</span>
<span>authentication:
<span>  anonymous:
<span>    enabled: <span style="color: #56b6c2; line-height: 26px;" class="hljs-literal">false</span>
<span>  webhook:
<span>    cacheTTL: 2m0s
<span>    enabled: <span style="color: #56b6c2; line-height: 26px;" class="hljs-literal">true</span>
<span>  x509:
<span>    clientCAFile: /opt/kubernetes/ssl/ca.pem 
<span>authorization:
<span>  mode: Webhook
<span>  webhook:
<span>    cacheAuthorizedTTL: 5m0s
<span>    cacheUnauthorizedTTL: 30s
<span>evictionHard:
<span>  imagefs.available: 15%
<span>  memory.available: 100Mi
<span>  nodefs.available: 10%
<span>  nodefs.inodesFree: 5%
<span>maxOpenFiles: 1000000
<span>maxPods: 110
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">3. 生成bootstrap.kubeconfig文件</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">KUBE_APISERVER=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://10.1.1.204:6443"</span> <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># apiserver IP:PORT</span>
<span>TOKEN=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"8054b7219e601b121e8d2b4f73d255ad"</span> <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 与token.csv里保持一致</span>
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 生成 kubelet bootstrap kubeconfig 配置文件</span>
<span>kubectl config <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">set</span>-cluster kubernetes \
<span>  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
<span>  --embed-certs=<span style="color: #56b6c2; line-height: 26px;" class="hljs-literal">true</span> \
<span>  --server=<span style="color: #d19a66; line-height: 26px;" class="hljs-variable">${KUBE_APISERVER}</span> \
<span>  --kubeconfig=bootstrap.kubeconfig
<span>
<span>kubectl config <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">set</span>-credentials <span style="color: #98c379; line-height: 26px;" class="hljs-string">"kubelet-bootstrap"</span> \
<span>  --token=<span style="color: #d19a66; line-height: 26px;" class="hljs-variable">${TOKEN}</span> \
<span>  --kubeconfig=bootstrap.kubeconfig
<span>
<span>kubectl config <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">set</span>-context default \
<span>  --cluster=kubernetes \
<span>  --user=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"kubelet-bootstrap"</span> \
<span>  --kubeconfig=bootstrap.kubeconfig
<span>
<span>kubectl config use-context default --kubeconfig=bootstrap.kubeconfig
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">拷贝到配置文件路径：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cp bootstrap.kubeconfig /opt/kubernetes/cfg
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">4. systemd管理kubelet</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /usr/lib/systemd/system/kubelet.service &#x3C;&#x3C; EOF
<span>[Unit]
<span>Description=Kubernetes Kubelet
<span>After=docker.service
<span>[Service]
<span>EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf
<span>ExecStart=/opt/kubernetes/bin/kubelet \<span style="color: #d19a66; line-height: 26px;" class="hljs-variable">$KUBELET_OPTS</span>
<span>Restart=on-failure
<span>LimitNOFILE=65536
<span>[Install]
<span>WantedBy=multi-user.target
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">5. 启动并设置开机启动</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">systemctl daemon-reload
<span>systemctl start kubelet
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kubelet
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-25"><span style="display: none;" class="prefix"></span><span class="content">5.3 批准kubelet证书申请并加入集群</span><span style="display: none;" class="suffix"></span></h4>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable"><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 查看kubelet证书请求</span>
<span>kubectl get csr
<span>
<span>NAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION
<span>node-csr-ngC06Pj7kmQUvmzBnbfLRxUVG1J90dlT2lWMkCNbnBA   26s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 批准申请(approve后跟上一步生成的node-*)</span>
<span>kubectl certificate approve node-csr-uCEGPOIiDdlLODKts8J658HrFq9CZ--K6M4G7bjhk8A
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 查看节点</span>
<span>kubectl get node
<span>NAME          STATUS     ROLES    AGE   VERSION
<span>k8s-master1   NotReady   &#x3C;none>   6s    v1.18.3
<span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<blockquote style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;"><span style="display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;">★ </span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;">注：由于网络插件还没有部署，节点会没有准备就绪 NotReady。</p>
<span style="float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;">”</span></blockquote>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-26"><span style="display: none;" class="prefix"></span><span class="content">5.4 部署kube-proxy</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 创建配置文件</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /opt/kubernetes/cfg/kube-proxy.conf &#x3C;&#x3C; EOF
<span>KUBE_PROXY_OPTS=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"--logtostderr=false \\
<span>--v=2 \\
<span>--log-dir=/opt/kubernetes/logs \\
<span>--config=/opt/kubernetes/cfg/kube-proxy-config.yml"</span>
<span>EOF
<span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. 配置参数文件</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /opt/kubernetes/cfg/kube-proxy-config.yml &#x3C;&#x3C; EOF
<span>kind: KubeProxyConfiguration
<span>apiVersion: kubeproxy.config.k8s.io/v1alpha1
<span>bindAddress: 0.0.0.0
<span>metricsBindAddress: 0.0.0.0:10249
<span>clientConnection:
<span>  kubeconfig: /opt/kubernetes/cfg/kube-proxy.kubeconfig
<span>hostnameOverride: k8s-master1
<span>clusterCIDR: 10.0.0.0/24
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">3. 生成kube-proxy.kubeconfig文件</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">生成kube-proxy证书：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable"><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 切换工作目录</span>
<span><span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">cd</span> ~/TLS/k8s
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 创建证书请求文件</span>
<span>cat > kube-proxy-csr.json &#x3C;&#x3C; EOF
<span>{
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"CN"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"system:kube-proxy"</span>,
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"hosts"</span>: [],
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"key"</span>: {
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"algo"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"rsa"</span>,
<span>    <span style="color: #98c379; line-height: 26px;" class="hljs-string">"size"</span>: 2048
<span>  },
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"names"</span>: [
<span>    {
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"C"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"CN"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"L"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"BeiJing"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"ST"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"BeiJing"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"O"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"k8s"</span>,
<span>      <span style="color: #98c379; line-height: 26px;" class="hljs-string">"OU"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"System"</span>
<span>    }
<span>  ]
<span>}
<span>EOF
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 生成证书</span>
<span>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy
<span>
<span>ls kube-proxy*pem
<span>kube-proxy-key.pem  kube-proxy.pem
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">生成kubeconfig文件：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">KUBE_APISERVER=<span style="color: #98c379; line-height: 26px;" class="hljs-string">"https://10.1.1.204:6443"</span>
<span>
<span>kubectl config <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">set</span>-cluster kubernetes \
<span>  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
<span>  --embed-certs=<span style="color: #56b6c2; line-height: 26px;" class="hljs-literal">true</span> \
<span>  --server=<span style="color: #d19a66; line-height: 26px;" class="hljs-variable">${KUBE_APISERVER}</span> \
<span>  --kubeconfig=kube-proxy.kubeconfig
<span>
<span>kubectl config <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">set</span>-credentials kube-proxy \
<span>  --client-certificate=./kube-proxy.pem \
<span>  --client-key=./kube-proxy-key.pem \
<span>  --embed-certs=<span style="color: #56b6c2; line-height: 26px;" class="hljs-literal">true</span> \
<span>  --kubeconfig=kube-proxy.kubeconfig
<span>
<span>kubectl config <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">set</span>-context default \
<span>  --cluster=kubernetes \
<span>  --user=kube-proxy \
<span>  --kubeconfig=kube-proxy.kubeconfig
<span>
<span>kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">拷贝到配置文件指定路径：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cp kube-proxy.kubeconfig /opt/kubernetes/cfg/
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">4. systemd管理kube-proxy</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /usr/lib/systemd/system/kube-proxy.service &#x3C;&#x3C; EOF
<span>[Unit]
<span>Description=Kubernetes Proxy
<span>After=network.target
<span>[Service]
<span>EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf
<span>ExecStart=/opt/kubernetes/bin/kube-proxy \<span style="color: #d19a66; line-height: 26px;" class="hljs-variable">$KUBE_PROXY_OPTS</span>
<span>Restart=on-failure
<span>LimitNOFILE=65536
<span>[Install]
<span>WantedBy=multi-user.target
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">5. 启动并设置开机启动</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">systemctl daemon-reload
<span>systemctl start kube-proxy
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kube-proxy
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-27"><span style="display: none;" class="prefix"></span><span class="content">5.5 部署CNI网络</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">先准备好CNI二进制文件：</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">下载地址：<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">https://github.com/containernetworking/plugins/releases/download/v0.8.6/cni-plugins-linux-amd64-v0.8.6.tgz</code>。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">解压二进制包并移动到默认工作目录：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">mkdir -p /opt/cni/bin
<span>tar zxvf cni-plugins-linux-amd64-v0.8.6.tgz -C /opt/cni/bin
<span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">部署CNI网络：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
<span>sed -i -r <span style="color: #98c379; line-height: 26px;" class="hljs-string">"s#quay.io/coreos/flannel:.*-amd64#lizhenliang/flannel:v0.12.0-amd64#g"</span> kube-flannel.yml
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 这里需要一个国内镜像地址，国外的无法访问</span>
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">默认镜像地址无法访问，修改为docker hub镜像仓库。</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl apply -f kube-flannel.yml
<span>
<span>kubectl get pods -n kube-system
<span>NAME                          READY   STATUS     RESTARTS   AGE
<span>kube-flannel-ds-amd64-jj98k   0/1     Init:0/1   0          14s
<span>
<span>kubectl get node
<span>NAME          STATUS     ROLES    AGE   VERSION
<span>k8s-master1   Ready   &#x3C;none>   14m   v1.18.3
<span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">部署好网络插件，Node准备就绪。</p>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-28"><span style="display: none;" class="prefix"></span><span class="content">5.6 授权apiserver访问kubelet</span><span style="display: none;" class="suffix"></span></h4>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > apiserver-to-kubelet-rbac.yaml &#x3C;&#x3C; EOF
<span>apiVersion: rbac.authorization.k8s.io/v1
<span>kind: ClusterRole
<span>metadata:
<span>  annotations:
<span>    rbac.authorization.kubernetes.io/autoupdate: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"true"</span>
<span>  labels:
<span>    kubernetes.io/bootstrapping: rbac-defaults
<span>  name: system:kube-apiserver-to-kubelet
<span>rules:
<span>  - apiGroups:
<span>      - <span style="color: #98c379; line-height: 26px;" class="hljs-string">""</span>
<span>    resources:
<span>      - nodes/proxy
<span>      - nodes/stats
<span>      - nodes/<span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">log</span>
<span>      - nodes/spec
<span>      - nodes/metrics
<span>      - pods/<span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">log</span>
<span>    verbs:
<span>      - <span style="color: #98c379; line-height: 26px;" class="hljs-string">"*"</span>
<span>---
<span>apiVersion: rbac.authorization.k8s.io/v1
<span>kind: ClusterRoleBinding
<span>metadata:
<span>  name: system:kube-apiserver
<span>  namespace: <span style="color: #98c379; line-height: 26px;" class="hljs-string">""</span>
<span>roleRef:
<span>  apiGroup: rbac.authorization.k8s.io
<span>  kind: ClusterRole
<span>  name: system:kube-apiserver-to-kubelet
<span>subjects:
<span>  - apiGroup: rbac.authorization.k8s.io
<span>    kind: User
<span>    name: kubernetes
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl apply -f apiserver-to-kubelet-rbac.yaml
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-29"><span style="display: none;" class="prefix"></span><span class="content">5.7 新增加Worker Node</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 拷贝已部署好的Node相关文件到新节点(k8s-master1上执行)</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">在Master节点将Worker Node涉及文件拷贝到新节点10.1.1.151/186</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">scp -r /opt/kubernetes root@10.1.1.151:/opt/
<span>scp -r /usr/lib/systemd/system/{kubelet,kube-proxy}.service root@10.1.1.151:/usr/lib/systemd/system
<span>scp -r /opt/cni/ root@10.1.1.151:/opt/
<span>scp -r /opt/kubernetes/ssl/ca.pem root@10.1.1.151:/opt/kubernetes/ssl
<span>
<span>scp -r /opt/kubernetes root@10.1.1.186:/opt/
<span>scp -r /usr/lib/systemd/system/{kubelet,kube-proxy}.service root@10.1.1.186:/usr/lib/systemd/system
<span>scp -r /opt/cni/ root@10.1.1.186:/opt/
<span>scp -r /opt/kubernetes/ssl/ca.pem root@10.1.1.186:/opt/kubernetes/ssl
<span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. 删除kubelet证书和kubeconfig文件(k8s-worker1/2上执行)</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">rm -f /opt/kubernetes/cfg/kubelet.kubeconfig
<span>rm -f /opt/kubernetes/ssl/kubelet*
<span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<blockquote style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;"><span style="display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;">★ </span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;">注：这几个文件是证书申请审批后自动生成的，每个Node不同，必须删除重新生成。</p>
<span style="float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;">”</span></blockquote>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">3. 修改主机名(k8s-worker1/2上执行)</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">vi /opt/kubernetes/cfg/kubelet.conf
<span>--hostname-override=k8s-worker1
<span>
<span>vi /opt/kubernetes/cfg/kube-proxy-config.yml
<span>hostnameOverride: k8s-worker1
<span>
<span>vi /opt/kubernetes/cfg/kubelet.conf
<span>--hostname-override=k8s-worker2
<span>
<span>vi /opt/kubernetes/cfg/kube-proxy-config.yml
<span>hostnameOverride: k8s-worker2
<span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">4. 启动并设置开机启动(k8s-worker1/2上执行)</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">systemctl daemon-reload
<span>systemctl start kubelet
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kubelet
<span>systemctl start kube-proxy
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kube-proxy
<span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">5. 在Master上批准新Node kubelet证书申请</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl get csr
<span>NAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION
<span>node-csr-mZ1Shcds5I90zfqQupi-GaI_4MeKl7PizK5dgOF2wC8   14s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
<span>node-csr-x-lWfrl2pFrMUblecU5NYgpn3zI6j_iiTmcKZ1JRefY   20s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
<span>
<span>kubectl certificate approve node-csr-mZ1Shcds5I90zfqQupi-GaI_4MeKl7PizK5dgOF2wC8
<span>
<span>kubectl certificate approve node-csr-x-lWfrl2pFrMUblecU5NYgpn3zI6j_iiTmcKZ1JRefY
<span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">6. 查看Node状态</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl get node
<span>NAME         STATUS     ROLES    AGE   VERSION
<span>k8s-master1   Ready      &#x3C;none>   65m   v1.18.3
<span>k8s-worker1    Ready      &#x3C;none>   12m   v1.18.3
<span>k8s-worker2    Ready      &#x3C;none>   81s   v1.18.3
<span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h2 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;" data-id="heading-30"><span style="display: none;" class="prefix"></span><span style="font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;" class="content">6. 部署Dashboard和CoreDNS</span><span class="suffix"></span></h2>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-31"><span style="display: none;" class="prefix"></span><span class="content">6.1 部署Dashboard</span><span style="display: none;" class="suffix"></span></h4>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta8/aio/deploy/recommended.yaml
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">默认Dashboard只能集群内部访问，修改Service为NodePort类型，暴露到外部：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">vi recommended.yaml
<span>kind: Service
<span>apiVersion: v1
<span>metadata:
<span>  labels:
<span>    k8s-app: kubernetes-dashboard
<span>  name: kubernetes-dashboard
<span>  namespace: kubernetes-dashboard
<span>spec:
<span>  ports:
<span>    - port: 443
<span>      targetPort: 8443
<span>      nodePort: 30001
<span>  <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">type</span>: NodePort
<span>  selector:
<span>    k8s-app: kubernetes-dashboard
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl apply -f recommended.yaml    <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 这里有个坑，需要等待一段时间下方STATUS为Running才行</span>
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl get pods,svc -n kubernetes-dashboard
<span>
<span>NAME                                             READY   STATUS    RESTARTS   AGE
<span>pod/dashboard-metrics-scraper-694557449d-dhlrq   1/1     Running   0          27s
<span>pod/kubernetes-dashboard-9774cc786-7d6qn         1/1     Running   0          27s
<span>
<span>NAME                                TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)         AGE
<span>service/dashboard-metrics-scraper   ClusterIP   10.0.0.36    &#x3C;none>        8000/TCP        27s
<span>service/kubernetes-dashboard        NodePort    10.0.0.154   &#x3C;none>        443:30001/TCP   27s
<span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">访问地址：<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">https://NodeIP:30001</code></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">创建service account并绑定默认cluster-admin管理员集群角色：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl create serviceaccount dashboard-admin -n kube-system
<span>kubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin
<span>kubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk <span style="color: #98c379; line-height: 26px;" class="hljs-string">'/dashboard-admin/{print $1}'</span>)
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">获得token：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">eyJhbGciOiJSUzI1NiIsImtpZCI6IlVZczd4TDN3VHRpLWdNUnRlc1BOY2E0T3Z1Q3UzQmlwUEZpaEZHclJ0MWcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tNWRod2YiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMTMzZmVkODItM2Q3OC00ODk5LWJiMzYtY2YyZjU4NzgzZTRlIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.gTuj33hMUmvgdPU499ifrn4V8AjinlRhzkw2ItdNRVdUmU6YLbSjZIp8WlPOkdtmDM2c3LCkLmnBqIabkIiIwb1HkNOtmglnFghzV8Td5GIGnoRqAmKPXO0aY4Y97w_X0sVC3DB34EY6soPlcI_v6_-nSqRC1rPOSJ9xd8yU774YHYucYqiU-ViiIgqHELo7BT6CVD1iLw4K_C5wfWs4o6htplhGpJ0edLPsZpwnTrW-4qn4d-EdKXcVJhpTUxxLoKL7HrerTwxeUMM1SL0vGnD5z2io9gybylubbgV7xRsSQQCwuXWqlzI6A_YWzl3-wmhwty4x9cWjQHMGw87YhA
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">使用输出的token登录Dashboard。</p>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-32"><span style="display: none;" class="prefix"></span><span class="content">6.2 部署CoreDNS</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">CoreDNS用于集群内部Service名称解析。</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">curl -o ./coredns.yaml https://github.com/kubernetes/kubernetes/blob/e176e477195f92919724bd02f81e2b18d4477af7/cluster/addons/dns/coredns/coredns.yaml.sed
<span>kubectl apply -f coredns.yaml    <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 这个地方需要修改下把CLUSTER_DNS_IP变量删除</span>
<span>
<span>kubectl get pods -n kube-system     <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 等待下方第一个STATUS为Running为准</span>
<span>NAME                          READY   STATUS    RESTARTS   AGE
<span>coredns-5ffbfd976d-j6shb      1/1     Running   0          32s
<span>kube-flannel-ds-amd64-2pc95   1/1     Running   0          38m
<span>kube-flannel-ds-amd64-7qhdx   1/1     Running   0          15m
<span>kube-flannel-ds-amd64-99cr8   1/1     Running   0          26m
<span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">DNS解析测试：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl run -it --rm dns-test --image=busybox:1.28.4 sh
<span>If you don<span style="color: #98c379; line-height: 26px;" class="hljs-string">'t see a command prompt, try pressing enter.
<span>
<span>/ # nslookup kubernetes
<span>Server:    10.0.0.2
<span>Address 1: 10.0.0.2 kube-dns.kube-system.svc.cluster.local
<span>
<span>Name:      kubernetes
<span>Address 1: 10.0.0.1 kubernetes.default.svc.cluster.local
<span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">解析没问题。</p>
<h2 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;" data-id="heading-33"><span style="display: none;" class="prefix"></span><span style="font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;" class="content">7. 高可用架构（扩容多Master架构）</span><span class="suffix"></span></h2>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">Kubernetes作为容器集群系统，通过健康检查+重启策略实现了Pod故障自我修复能力，通过调度算法实现将Pod分布式部署，并保持预期副本数，根据Node失效状态自动在其他Node拉起Pod，实现了应用层的高可用性。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">针对Kubernetes集群，高可用性还应包含以下两个层面的考虑：Etcd数据库的高可用性和Kubernetes Master组件的高可用性。 而Etcd我们已经采用3个节点组建集群实现高可用，本节将对Master节点高可用进行说明和实施。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">Master节点扮演着总控中心的角色，通过不断与工作节点上的Kubelet和kube-proxy进行通信来维护整个集群的健康工作状态。如果Master节点故障，将无法使用kubectl工具或者API做任何集群管理。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">Master节点主要有三个服务kube-apiserver、kube-controller-manager和kube-scheduler，其中kube-controller-manager和kube-scheduler组件自身通过选择机制已经实现了高可用，所以Master高可用主要针对kube-apiserver组件，而该组件是以HTTP API提供服务，因此对他高可用与Web服务器类似，增加负载均衡器对其负载均衡即可，并且可水平扩容。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">多Master架构图：</p>
<figure style="margin: 0; margin-top: 10px; margin-bottom: 10px;"><img style="max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;" alt="" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2020/7/1/1730895b37323660?imageView2/0/w/1280/h/960/ignore-error/1" data-width="1020" data-height="763"></figure>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-34"><span style="display: none;" class="prefix"></span><span class="content">7.1 安装Docker</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">同上，不再赘述。</p>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-35"><span style="display: none;" class="prefix"></span><span class="content">7.2 部署Master2 Node（10.1.1.230）</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">Master2 与已部署的Master1所有操作一致。所以我们只需将Master1所有K8s文件拷贝过来，再修改下服务器IP和主机名启动即可。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 创建etcd证书目录</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">在Master2创建etcd证书目录：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">mkdir -p /opt/etcd/ssl
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. 拷贝文件（Master1操作）</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">拷贝Master1上所有K8s文件和etcd证书到Master2：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">scp -r /opt/kubernetes root@10.1.1.230:/opt
<span>scp -r /opt/cni/ root@10.1.1.230:/opt
<span>scp -r /opt/etcd/ssl root@10.1.1.230:/opt/etcd
<span>scp /usr/lib/systemd/system/kube* root@10.1.1.230:/usr/lib/systemd/system
<span>scp /usr/bin/kubectl  root@10.1.1.230:/usr/bin
<span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">3. 删除证书文件</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">删除kubelet证书和kubeconfig文件：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">rm -f /opt/kubernetes/cfg/kubelet.kubeconfig 
<span>rm -f /opt/kubernetes/ssl/kubelet*
<span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">4. 修改配置文件IP和主机名</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">修改apiserver、kubelet和kube-proxy配置文件为本地IP：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">vi /opt/kubernetes/cfg/kube-apiserver.conf 
<span>...
<span>--<span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">bind</span>-address=10.1.1.230 \
<span>--advertise-address=10.1.1.230 \
<span>...
<span>
<span>vi /opt/kubernetes/cfg/kubelet.conf
<span>--hostname-override=k8s-master2
<span>
<span>vi /opt/kubernetes/cfg/kube-proxy-config.yml
<span>hostnameOverride: k8s-master2
<span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">5. 启动设置开机启动</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">systemctl daemon-reload
<span>systemctl start kube-apiserver
<span>systemctl start kube-controller-manager
<span>systemctl start kube-scheduler
<span>systemctl start kubelet
<span>systemctl start kube-proxy
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kube-apiserver
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kube-controller-manager
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kube-scheduler
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kubelet
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> kube-proxy
<span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">6. 查看集群状态</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl get cs
<span>NAME                 STATUS    MESSAGE             ERROR
<span>scheduler            Healthy   ok                  
<span>controller-manager   Healthy   ok                  
<span>etcd-1               Healthy   {<span style="color: #98c379; line-height: 26px;" class="hljs-string">"health"</span>:<span style="color: #98c379; line-height: 26px;" class="hljs-string">"true"</span>}   
<span>etcd-2               Healthy   {<span style="color: #98c379; line-height: 26px;" class="hljs-string">"health"</span>:<span style="color: #98c379; line-height: 26px;" class="hljs-string">"true"</span>}   
<span>etcd-0               Healthy   {<span style="color: #98c379; line-height: 26px;" class="hljs-string">"health"</span>:<span style="color: #98c379; line-height: 26px;" class="hljs-string">"true"</span>}
<span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">7. 批准kubelet证书申请</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">kubectl get csr
<span>NAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION
<span>node-csr-JYNknakEa_YpHz797oKaN-ZTk43nD51Zc9CJkBLcASU   85m   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
<span>
<span>kubectl certificate approve node-csr-JYNknakEa_YpHz797oKaN-ZTk43nD51Zc9CJkBLcASU
<span>
<span>kubectl get node
<span>NAME          STATUS   ROLES    AGE   VERSION
<span>k8s-master1    Ready    &#x3C;none>   34h   v1.18.3
<span>k8s-master2   Ready    &#x3C;none>   83m   v1.18.3
<span>k8s-worker1     Ready    &#x3C;none>   33h   v1.18.3
<span>k8s-worker2     Ready    &#x3C;none>   33h   v1.18.3
<span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-36"><span style="display: none;" class="prefix"></span><span class="content">7.3 部署Nginx负载均衡器</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">kube-apiserver高可用架构图：</p>
<figure style="margin: 0; margin-top: 10px; margin-bottom: 10px;"><img style="max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;" alt="" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2020/7/1/1730895b392e23da?imageView2/0/w/1280/h/960/ignore-error/1" data-width="806" data-height="449"></figure>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">Nginx是一个主流Web服务和反向代理服务器，这里用四层实现对apiserver实现负载均衡。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">Keepalived是一个主流高可用软件，基于VIP绑定实现服务器双机热备，在上述拓扑中，Keepalived主要根据Nginx运行状态判断是否需要故障转移（偏移VIP），例如当Nginx主节点挂掉，VIP会自动绑定在Nginx备节点，从而保证VIP一直可用，实现Nginx高可用。</section></li></ul>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">1. 安装软件包（主/备）</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">yum install epel-release -y
<span>yum install nginx keepalived -y
<span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">2. Nginx配置文件（主/备一样）</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /etc/nginx/nginx.conf &#x3C;&#x3C; <span style="color: #98c379; line-height: 26px;" class="hljs-string">"EOF"</span>
<span>user nginx;
<span>worker_processes auto;
<span>error_log /var/<span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">log</span>/nginx/error.log;
<span>pid /run/nginx.pid;
<span>
<span>include /usr/share/nginx/modules/*.conf;
<span>
<span>events {
<span>    worker_connections 1024;
<span>}
<span>
<span><span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 四层负载均衡，为两台Master apiserver组件提供负载均衡</span>
<span>stream {
<span>
<span>    log_format  main  <span style="color: #98c379; line-height: 26px;" class="hljs-string">'$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent'</span>;
<span>
<span>    access_log  /var/<span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">log</span>/nginx/k8s-access.log  main;
<span>
<span>    upstream k8s-apiserver {
<span>       server 10.1.1.204:6443;   <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># Master1 APISERVER IP:PORT</span>
<span>       server 10.1.1.230:6443;   <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># Master2 APISERVER IP:PORT</span>
<span>    }
<span>    
<span>    server {
<span>       listen 6443;
<span>       proxy_pass k8s-apiserver;
<span>    }
<span>}
<span>
<span>http {
<span>    log_format  main  <span style="color: #98c379; line-height: 26px;" class="hljs-string">'$remote_addr - $remote_user [$time_local] "$request" '</span>
<span>                      <span style="color: #98c379; line-height: 26px;" class="hljs-string">'$status $body_bytes_sent "$http_referer" '</span>
<span>                      <span style="color: #98c379; line-height: 26px;" class="hljs-string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;
<span>
<span>    access_log  /var/<span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">log</span>/nginx/access.log  main;
<span>
<span>    sendfile            on;
<span>    tcp_nopush          on;
<span>    tcp_nodelay         on;
<span>    keepalive_timeout   65;
<span>    types_hash_max_size 2048;
<span>
<span>    include             /etc/nginx/mime.types;
<span>    default_type        application/octet-stream;
<span>
<span>    server {
<span>        listen       80 default_server;
<span>        server_name  _;
<span>
<span>        location / {
<span>        }
<span>    }
<span>}
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">3. keepalived配置文件（Nginx Master）</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /etc/keepalived/keepalived.conf &#x3C;&#x3C; EOF
<span>global_defs { 
<span>   notification_email { 
<span>     acassen@firewall.loc 
<span>     failover@firewall.loc 
<span>     sysadmin@firewall.loc 
<span>   } 
<span>   notification_email_from Alexandre.Cassen@firewall.loc  
<span>   smtp_server 127.0.0.1 
<span>   smtp_connect_timeout 30 
<span>   router_id NGINX_MASTER
<span>} 
<span>vrrp_script check_nginx {
<span>    script <span style="color: #98c379; line-height: 26px;" class="hljs-string">"/etc/keepalived/check_nginx.sh"</span>
<span>}
<span>vrrp_instance VI_1 { 
<span>    state MASTER 
<span>    interface ens33
<span>    virtual_router_id 51 <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># VRRP 路由 ID实例，每个实例是唯一的 </span>
<span>    priority 100    <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 优先级，备服务器设置 90 </span>
<span>    advert_int 1    <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 指定VRRP 心跳包通告间隔时间，默认1秒 </span>
<span>    authentication { 
<span>        auth_type PASS      
<span>        auth_pass 1111 
<span>    }  
<span>    <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># 虚拟IP</span>
<span>    virtual_ipaddress { 
<span>        10.1.1.170/24
<span>    } 
<span>    track_script {
<span>        check_nginx
<span>    } 
<span>}
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">vrrp_script：指定检查nginx工作状态脚本（根据nginx状态判断是否故障转移）</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;">virtual_ipaddress：虚拟IP（VIP）</section></li></ul>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">检查nginx状态脚本：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /etc/keepalived/check_nginx.sh  &#x3C;&#x3C; <span style="color: #98c379; line-height: 26px;" class="hljs-string">"EOF"</span>
<span><span style="color: #61aeee; line-height: 26px;" class="hljs-meta">#!/bin/bash</span>
<span>count=$(ps -ef |grep nginx |egrep -cv <span style="color: #98c379; line-height: 26px;" class="hljs-string">"grep|$"</span>)
<span>
<span><span style="color: #c678dd; line-height: 26px;" class="hljs-keyword">if</span> [ <span style="color: #98c379; line-height: 26px;" class="hljs-string">"<span style="color: #d19a66; line-height: 26px;" class="hljs-variable">$count</span>"</span> -eq 0 ];<span style="color: #c678dd; line-height: 26px;" class="hljs-keyword">then</span>
<span>    <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">exit</span> 1
<span><span style="color: #c678dd; line-height: 26px;" class="hljs-keyword">else</span>
<span>    <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">exit</span> 0
<span><span style="color: #c678dd; line-height: 26px;" class="hljs-keyword">fi</span>
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">chmod +x /etc/keepalived/check_nginx.sh
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">4. keepalived配置文件（Nginx Backup）</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /etc/keepalived/keepalived.conf &#x3C;&#x3C; EOF
<span>global_defs { 
<span>   notification_email { 
<span>     acassen@firewall.loc 
<span>     failover@firewall.loc 
<span>     sysadmin@firewall.loc 
<span>   } 
<span>   notification_email_from Alexandre.Cassen@firewall.loc  
<span>   smtp_server 127.0.0.1 
<span>   smtp_connect_timeout 30 
<span>   router_id NGINX_BACKUP
<span>} 
<span>vrrp_script check_nginx {
<span>    script <span style="color: #98c379; line-height: 26px;" class="hljs-string">"/etc/keepalived/check_nginx.sh"</span>
<span>}
<span>vrrp_instance VI_1 { 
<span>    state BACKUP 
<span>    interface ens33
<span>    virtual_router_id 51 <span style="color: #5c6370; font-style: italic; line-height: 26px;" class="hljs-comment"># VRRP 路由 ID实例，每个实例是唯一的 </span>
<span>    priority 90
<span>    advert_int 1
<span>    authentication { 
<span>        auth_type PASS      
<span>        auth_pass 1111 
<span>    }  
<span>    virtual_ipaddress { 
<span>        10.1.1.170/24
<span>    } 
<span>    track_script {
<span>        check_nginx
<span>    } 
<span>}
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">上述配置文件中检查nginx运行状态脚本：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">cat > /etc/keepalived/check_nginx.sh  &#x3C;&#x3C; <span style="color: #98c379; line-height: 26px;" class="hljs-string">"EOF"</span>
<span><span style="color: #61aeee; line-height: 26px;" class="hljs-meta">#!/bin/bash</span>
<span>count=$(ps -ef |grep nginx |egrep -cv <span style="color: #98c379; line-height: 26px;" class="hljs-string">"grep|$"</span>)
<span>
<span><span style="color: #c678dd; line-height: 26px;" class="hljs-keyword">if</span> [ <span style="color: #98c379; line-height: 26px;" class="hljs-string">"<span style="color: #d19a66; line-height: 26px;" class="hljs-variable">$count</span>"</span> -eq 0 ];<span style="color: #c678dd; line-height: 26px;" class="hljs-keyword">then</span>
<span>    <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">exit</span> 1
<span><span style="color: #c678dd; line-height: 26px;" class="hljs-keyword">else</span>
<span>    <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">exit</span> 0
<span><span style="color: #c678dd; line-height: 26px;" class="hljs-keyword">fi</span>
<span>EOF
<span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">chmod +x /etc/keepalived/check_nginx.sh
<span></span><span class="copy-code-btn">复制代码</span></code></pre>
<blockquote style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;"><span style="display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;">★ </span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;">注：keepalived根据脚本返回状态码（0为工作正常，非0不正常）判断是否故障转移。</p>
<span style="float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;">”</span></blockquote>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">5. 启动并设置开机启动</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">systemctl daemon-reload
<span>systemctl start nginx
<span>systemctl start keepalived
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> nginx
<span>systemctl <span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">enable</span> keepalived
<span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">6. 查看keepalived工作状态</strong></p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">ip a
<span>
<span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">可以看到，在ens33网卡绑定了10.1.1.170虚拟IP，说明工作正常。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">7. Nginx+Keepalived高可用测试</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">关闭主节点Nginx，测试VIP是否漂移到备节点服务器。</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">在Nginx Master执行 pkill nginx
<span>在Nginx Backup，ip addr命令查看已成功绑定VIP。
<span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;"><strong style="font-weight: border; color: #0e88eb;">8. 访问负载均衡器测试</strong></p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">找K8s集群中任意一个节点，使用curl查看K8s版本测试，使用VIP访问：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">curl -k https://10.1.1.170:6443/version
<span>{
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"major"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"1"</span>,
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"minor"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"18"</span>,
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"gitVersion"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"v1.18.3"</span>,
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"gitCommit"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"2e7996e3e2712684bc73f0dec0200d64eec7fe40"</span>,
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"gitTreeState"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"clean"</span>,
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"buildDate"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"2020-05-20T12:43:34Z"</span>,
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"goVersion"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"go1.13.9"</span>,
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"compiler"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"gc"</span>,
<span>  <span style="color: #98c379; line-height: 26px;" class="hljs-string">"platform"</span>: <span style="color: #98c379; line-height: 26px;" class="hljs-string">"linux/amd64"</span>
<span>}
<span></span></span></span></span></span></span></span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">可以正确获取到K8s版本信息，说明负载均衡器搭建正常。该请求数据流程：<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">curl -> vip(nginx) -> apiserver</code>。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">通过查看Nginx日志也可以看到转发apiserver IP：</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">tail /var/<span style="color: #e6c07b; line-height: 26px;" class="hljs-built_in">log</span>/nginx/k8s-access.log -f
<span>10.1.1.170 10.1.1.204:6443 - [30/May/2020:11:15:10 +0800] 200 422
<span>10.1.1.170 10.1.1.230:6443 - [30/May/2020:11:15:26 +0800] 200 422
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">到此还没结束，还有下面最关键的一步。</p>
<h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;" data-id="heading-37"><span style="display: none;" class="prefix"></span><span class="content">7.4 修改所有Worker Node连接LB VIP</span><span style="display: none;" class="suffix"></span></h4>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">试想下，虽然我们增加了Master2和负载均衡器，但是我们是从单Master架构扩容的，也就是说目前所有的Node组件连接都还是Master1，如果不改为连接VIP走负载均衡器，那么Master还是单点故障。</p>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">因此接下来就是要改所有Worker Node组件配置文件，由原来10.1.1.204修改为10.1.1.170（VIP）：</p>
<table style="display: table; text-align: left;">
<thead>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">角色</th>
<th style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;">IP</th>
</tr>
</thead>
<tbody style="border: 0;">
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-master1</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.204</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-master2</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.230</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: white;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-worker1</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.151</td>
</tr>
<tr style="border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;">
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">k8s-worker2</td>
<td style="border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;">10.1.1.186</td>
</tr>
</tbody>
</table>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">sed -i <span style="color: #98c379; line-height: 26px;" class="hljs-string">'s#10.1.1.204:6443#10.1.1.170:6443#'</span> /opt/kubernetes/cfg/*
<span>systemctl restart kubelet
<span>systemctl restart kube-proxy
<span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">检查节点状态：kubectl get node</p>
<pre style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;" class="custom"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;" class="hljs copyable">NAME          STATUS   ROLES    AGE    VERSION
<span>k8s-master    Ready    &#x3C;none>   34h    v1.18.3
<span>k8s-master2   Ready    &#x3C;none>   101m   v1.18.3
<span>k8s-node1     Ready    &#x3C;none>   33h    v1.18.3
<span>k8s-node2     Ready    &#x3C;none>   33h    v1.18.3
<span></span></span></span></span></span><span class="copy-code-btn">复制代码</span></code></pre>
<p style="padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;">至此，一套完整的 Kubernetes 高可用集群就部署完成了！</p></section></div> <div class="image-viewer-box" data-v-78c9b824><!----></div></div></article> <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div> <!----> <!----> <div class="article-suspended-panel article-suspended-panel" data-v-19356a56 data-v-d6ec2d02><div badge="1" class="like-btn panel-btn like-adjust with-badge" data-v-19356a56></div> <div badge="1" class="comment-btn panel-btn comment-adjust with-badge" data-v-19356a56></div> <div class="collect-btn panel-btn" data-v-19356a56><!----></div> <div class="share-title" data-v-19356a56>分享</div> <div class="weibo-btn share-btn panel-btn" data-v-19356a56></div> <div class="qq-btn share-btn panel-btn" data-v-19356a56></div> <div class="wechat-btn share-btn panel-btn" data-v-19356a56><img src="" class="wechat-qr-code-img shadow" style="display:none;" data-v-19356a56></div></div></div></main></div> <!----></div></div></div><script>window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){return {layout:"default",data:[{}],fetch:[],error:b,state:{view:{activityIndex:{activityList:[],pageInfo:{hasNextPage:a,endCursor:e},afterPosition:e,activityListIsLoading:c,activityListIsError:a,userActivityList:[],placeholder:e,actionType:{FETCH:"@\u002Fview\u002Factivity-index\u002FFETCH",FETCH_RECOMMEND_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_RECOMMEND_LIST",RESET_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FRESET_ACTIVITY_LIST",FETCH_USER_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_USER_ACTIVITY_LIST",FETCH_NEW_COUNT:"@\u002Fview\u002Factivity-index\u002FFETCH_NEW_COUNT",DELETE_ACTIVITY:"@\u002Fview\u002Factivity-index\u002FDELETE_ACTIVITY",TOGGLE_FOLLOW_USER:"@\u002Fview\u002Factivity-index\u002FTOGGLE_FOLLOW_USER",FETCH_ENTRY_COMMENT_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_ENTRY_COMMENT_LIST",UPDATE_LIST_LOADING:"@\u002Fview\u002Factivity-index\u002FUPDATE_LIST_LOADING",RESET:"@\u002Fview\u002Factivity-index\u002FRESET"},hotList:{list:[],after:e,loading:a,hasNextPage:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FRESET"}},sidebar:{bannerList:[],actionType:{RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FUPDATE_STATE",FETCH_BANNER:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FFETCH_BANNER"},recommend:{pageSize:g,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FRESET"},after:d},followed:{pageSize:g,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FRESET"},after:d},recommendPin:{list:[],after:e,loading:a,hasNextPage:c,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FRESET"}}},topicPinList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FRESET"},topicId:e,navList:[{type:j,name:j,title:"推荐 ",id:j},{type:k,name:k,title:"热门 ",id:k},{type:l,name:l,title:"关注 ",id:l},{type:i,name:"opensource",title:"开源推荐 ",id:"5c09ea2b092dcb42c740fe73"},{type:i,name:"recruitment",title:"内推招聘",id:"5abb61e1092dcb4620ca3322"},{type:i,name:"dating",title:"掘金相亲",id:"5abcaa67092dcb4620ca335c"},{type:i,name:"slacking",title:"上班摸鱼",id:"5c106be9092dcb2cc5de7257"},{type:i,name:"app",title:"应用安利",id:"5b514af1092dcb61bd72800d"},{type:i,name:"tool",title:"开发工具",id:"5abb67d2092dcb4620ca3324"},{type:i,name:"news",title:"New资讯",id:"5c46a17f092dcb4737217152"}],sortType:m}},search:{list:[],linkList:[],query:e,period:n,type:n,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fsearch\u002FFETCH",FETCH_MORE:"@\u002Fview\u002Fsearch\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fsearch\u002FRESET"}},columnIndex:{list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FRESET"},sort:o,category:n},hotList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FRESET"}}},timelineIndex:{categoryNavList:[],tagNavList:[],splitTagList:[],timelineAdList:[],list:[],sort:m,category:j,categoryId:e,tagId:e,tag:"全部",actionType:{FETCH_TIMELINE_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TIMELINE_LIST",FETCH_CATEGORY_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_CATEGORY_LIST",FETCH_TAG_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TAG_LIST",DELETE_ENTRY:"@\u002Fview\u002FtimelineIndex\u002FDELETE_ENTRY",FETCH_MORE:"@\u002Fview\u002FtimelineIndex\u002FFETCH_MORE",FETCH:"@\u002Fview\u002FtimelineIndex\u002FFETCH",RESET:"@\u002Fview\u002FtimelineIndex\u002FRESET"},timelineList:{list:[],cursor:f,skeleton:a,loading:a,hasMore:a,categoryId:e,tagId:e,sort:e,actionType:{UPDATE_STATE:"timeline-list\u002FUPDATE_STATE",FETCH_MORE:"timeline-list\u002FFETCH_MORE",FETCH:"timeline-list\u002FFETCH",RESET:"timeline-list\u002FRESET"}},recommendList:{list:[],cursor:f,loading:a,hasMore:a,skeleton:a,actionType:{UPDATE_STATE:"recommend-list\u002FUPDATE_STATE",FETCH_MORE:"recommend-list\u002FFETCH_MORE",FETCH:"recommend-list\u002FFETCH",RESET:"recommend-list\u002FRESET"}},followingList:{list:[],cursor:f,skeleton:a,loading:a,hasMore:c,actionType:{UPDATE_STATE:"following-list\u002FUPDATE_STATE",FETCH_MORE:"following-list\u002FFETCH_MORE",FETCH:"following-list\u002FFETCH",RESET:"following-list\u002FRESET"}}},subscribe:{subscribed:{list:[],cursor:f,skeleton:c,loading:a,hasMore:a,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FRESET"}},all:{list:[],cursor:f,loading:a,skeleton:c,hasMore:a,linkList:e,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fall\u002Flist\u002FRESET"}}},entryPublic:{entry:{user:{}},relatedEntryList:[],relatedCollectionList:[],actionType:{FETCH:"@\u002Fview\u002FentryPublic\u002FFETCH",RESET:"@\u002Fview\u002FentryPublic\u002FRESET"}},user:{user:{},actionType:{FETCH:"@\u002Fview\u002Fuser\u002FFETCH",RESET:"@\u002Fview\u002Fuser\u002FRESET",UPDATE:"@\u002Fview\u002Fuser\u002FUPDATE"},detailList:{actionType:{RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FRESET"},likeList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:c,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FRESET"}},postList:{list:[],hasMore:a,skeleton:a,loading:a,sort:o,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FRESET"}},tagList:{list:[],loading:a,skeleton:c,hasMore:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FRESET"}},collectionList:{list:[],userId:e,skeleton:c,hasMore:a,cursor:f,type:"created",loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FRESET"}},followerList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FRESET"}},followingList:{list:[],cursor:f,hasMore:a,skeleton:a,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FRESET"}},activityList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FRESET"}},bookList:{list:[],cursor:f,skeleton:c,hasMore:a,loading:a,type:"bought",actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FRESET"}},pinList:{list:[],hasMore:a,loading:a,skeleton:c,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FRESET"}},pinPraisedList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:c,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FRESET"}}}},tag:{tag:{},actionType:{FETCH:"@\u002Fview\u002Ftag\u002FFETCH",FETCH_LIST:"@\u002Fview\u002Ftag\u002FFETCH_LIST",RESET:"@\u002Fview\u002Ftag\u002FRESET"},list:{list:[],cursor:f,loading:a,skeleton:a,hasMore:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Ftag\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH",RESET:"@\u002Fview\u002Ftag\u002Flist\u002FRESET"}}},notification:{user:{actionType:{READ_ALL:"@\u002Fview\u002Fnotification\u002Fuser\u002FREAD_ALL",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002FRESET"},listState:{list:[],cursor:f,hasMore:a,isLoading:a,messageType:3,msgTotal:d,msgSubMap:{"1":d,"2":d,"3":d,"4":d}},list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FRESET"}}},system:{actionType:{READ_ALL:"@\u002Fview\u002Fnotification\u002Fsystem\u002FREAD_ALL",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002FRESET"},list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FRESET"}}}},column:{column:{id:q},entry:{id:q,screenshot:void 0,liked:a,article_id:q,article_info:{article_id:q,user_id:"1503787639375096",category_id:"6809637772874219534",tag_ids:[6809640675944956000],visible_level:d,link_url:"https:\u002F\u002Fjuejin.im\u002Fpost\u002F6844904205556121608",cover_image:e,is_gfw:d,title:"Kubernetes高可用集群二进制安装",brief_content:"1. 前置知识点 Kubeadm是一个K8s部署工具，提供kubeadm init和kubeadm join，用于快速部署Kubernetes集群。官方地址：https:\u002F\u002Fkubernetes.io\u002Fdocs\u002Freference\u002Fsetup-tools\u002Fkubeadm\u002Fkub…",is_english:d,is_original:h,user_index:d,original_type:d,original_author:e,content:"\u003Csection style=\"font-size: 16px; color: black; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; margin-top: -10px; font-family: PingFangSC-Light;\" data-website=\"https:\u002F\u002Fwww.mdnice.com\" data-tool=\"mdnice编辑器\" id=\"nice\"\u003E\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E1. 前置知识点\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E1.1 生产环境可部署Kubernetes集群的两种方式\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E目前生产部署Kubernetes集群主要有两种方式：\u003C\u002Fp\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EKubeadm\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: square;\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EKubeadm是一个K8s部署工具，提供kubeadm init和kubeadm join，用于快速部署Kubernetes集群。官方地址：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fkubernetes.io\u002Fdocs\u002Freference\u002Fsetup-tools\u002Fkubeadm\u002Fkubeadm\u002F\u003C\u002Fcode\u003E。\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E二进制包\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: square;\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E从github下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群。Kubeadm降低部署门槛，但屏蔽了很多细节，遇到问题很难排查。如果想更容易可控，推荐使用二进制包部署Kubernetes集群，虽然手动部署麻烦点，期间可以学习很多工作原理，也利于后期维护。\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E1.2 安装要求\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E在开始之前，部署Kubernetes集群机器需要满足以下几个条件：\u003C\u002Fp\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E一台或多台机器，操作系统 CentOS7.x-86_x64\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E硬件配置：2GB或更多RAM，2个CPU或更多CPU，硬盘30GB或更多\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E可以访问外网，需要拉取镜像，如果服务器不能上网，需要提前下载镜像并导入节点\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E禁止swap分区\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E1.3 准备环境\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E软件环境：\u003C\u002Fp\u003E\n\u003Ctable style=\"display: table; text-align: left;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cthead\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E软件\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E版本\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody style=\"border: 0;\"\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E操作系统\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003ECentOS7.6_x64(mini)\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003EDocker\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E19-ce\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003EKubernetes\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E1.18\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E服务器规划：\u003C\u002Fp\u003E\n\u003Ctable style=\"display: table; text-align: left;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cthead\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E角色\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003EIP\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E组件\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody style=\"border: 0;\"\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-master1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.204\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekube-apiserver, kube-controller-manager, kube-scheduler, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-master2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.230\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekube-apiserver, kube-controller-manager, kube-scheduler, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.151\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekubelet, kube-proxy, docker, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.186\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekubelet, kube-proxy, docker, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-lb1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.220, 10.1.1.170(VIP)\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003ENginx L4\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-lb2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.169\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003ENginx L4\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E须知：考虑到有些朋友电脑配置较低，这么多虚拟机跑不动，所以这一套高可用集群分两部分实施，先部署一套单Master架构（10.1.1.204\u002F151\u002F186），再扩容为多Master架构（上述规划），顺便熟悉下Master扩容流程。\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E单Master架构图：\u003C\u002Fp\u003E\n\u003Cfigure style=\"margin: 0; margin-top: 10px; margin-bottom: 10px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cimg style=\"max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;\" alt=\"\" src=\"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F1730895b367d0ea1?w=1559&amp;h=1133&amp;f=png&amp;s=75776\"\u003E\u003C\u002Ffigure\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E单Master服务器规划：\u003C\u002Fp\u003E\n\u003Ctable style=\"display: table; text-align: left;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cthead\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E角色\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003EIP\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E组件\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody style=\"border: 0;\"\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-master1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.204\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekube-apiserver, kube-controller-manager, kube-scheduler, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.151\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekubelet, kube-proxy, docker, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.186\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekubelet, kube-proxy, docker, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E1.4 操作系统初始化配置\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 关闭防火墙\u003C\u002Fspan\u003E\n\u003Cspan\u003Esystemctl stop firewalld\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Edisable\u003C\u002Fspan\u003E firewalld\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 关闭selinux\u003C\u002Fspan\u003E\n\u003Cspan\u003Esed -i \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E's\u002Fenforcing\u002Fdisabled\u002F'\u003C\u002Fspan\u003E \u002Fetc\u002Fselinux\u002Fconfig  \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 永久\u003C\u002Fspan\u003E\n\u003Cspan\u003Esetenforce 0  \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 临时\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 关闭swap\u003C\u002Fspan\u003E\n\u003Cspan\u003Eswapoff -a  \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 临时\u003C\u002Fspan\u003E\n\u003Cspan\u003Esed -ri \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E's\u002F.*swap.*\u002F#&amp;\u002F'\u003C\u002Fspan\u003E \u002Fetc\u002Ffstab    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 永久\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 根据规划设置主机名\u003C\u002Fspan\u003E\n\u003Cspan\u003Ehostnamectl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-hostname &lt;hostname&gt;\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 在所有主机添加hosts\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecat &gt;&gt; \u002Fetc\u002Fhosts &lt;&lt; EOF\n\u003Cspan\u003E10.1.1.204 k8s-master1\n\u003Cspan\u003E10.1.1.230 k8s-master2\n\u003Cspan\u003E10.1.1.151 k8s-worker1\n\u003Cspan\u003E10.1.1.186 k8s-worker2\n\u003Cspan\u003E10.1.1.220 k8s-lb1\n\u003Cspan\u003E10.1.1.169 k8s-lb2\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 将桥接的IPv4流量传递到iptables的链\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecat &gt; \u002Fetc\u002Fsysctl.d\u002Fk8s.conf &lt;&lt; EOF\n\u003Cspan\u003Enet.bridge.bridge-nf-call-ip6tables = 1\n\u003Cspan\u003Enet.bridge.bridge-nf-call-iptables = 1\n\u003Cspan\u003EEOF\n\u003Cspan\u003Esysctl --system  \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 生效\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 时间同步\u003C\u002Fspan\u003E\n\u003Cspan\u003Eyum install ntpdate -y\n\u003Cspan\u003Entpdate time.windows.com\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E2. 部署Etcd集群\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EEtcd 是一个分布式键值存储系统，Kubernetes使用Etcd进行数据存储，所以先准备一个Etcd数据库，为解决Etcd单点故障，应采用集群方式部署，这里使用3台组建集群，可容忍1台机器故障，当然，你也可以使用5台组建集群，可容忍2台机器故障。\u003C\u002Fp\u003E\n\u003Ctable style=\"display: table; text-align: left;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cthead\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E节点名称\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003EIP\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody style=\"border: 0;\"\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Eetcd1(k8s-master1)\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.204\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Eetcd2(k8s-worker1)\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.151\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Eetcd3(k8s-worker2)\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.186\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：为了节省机器，这里与K8s节点机器复用。也可以独立于k8s集群之外部署，只要apiserver能连接到就行。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E2.1 准备cfssl证书生成工具\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003Ecfssl是一个开源的证书管理工具，使用json文件生成证书，相比openssl更方便使用。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E找任意一台服务器操作，这里用Master节点。\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ewget https:\u002F\u002Fpkg.cfssl.org\u002FR1.2\u002Fcfssl_linux-amd64\n\u003Cspan\u003Ewget https:\u002F\u002Fpkg.cfssl.org\u002FR1.2\u002Fcfssljson_linux-amd64\n\u003Cspan\u003Ewget https:\u002F\u002Fpkg.cfssl.org\u002FR1.2\u002Fcfssl-certinfo_linux-amd64\n\u003Cspan\u003Echmod +x cfssl_linux-amd64 cfssljson_linux-amd64 cfssl-certinfo_linux-amd64\n\u003Cspan\u003Emv cfssl_linux-amd64 \u002Fusr\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elocal\u003C\u002Fspan\u003E\u002Fbin\u002Fcfssl\n\u003Cspan\u003Emv cfssljson_linux-amd64 \u002Fusr\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elocal\u003C\u002Fspan\u003E\u002Fbin\u002Fcfssljson\n\u003Cspan\u003Emv cfssl-certinfo_linux-amd64 \u002Fusr\u002Fbin\u002Fcfssl-certinfo\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E2.2 生成Etcd证书\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 自签证书颁发机构（CA）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E创建工作目录：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir -p ~\u002FTLS\u002F{etcd,k8s}\n\u003Cspan\u003E\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E ~\u002FTLS\u002Fetcd\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E自签CA：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; ca-config.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"signing\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"default\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"expiry\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"87600h\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"profiles\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"www\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E         \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"expiry\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"87600h\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E         \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"usages\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"signing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key encipherment\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"server auth\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"client auth\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        ]\n\u003Cspan\u003E      }\n\u003Cspan\u003E    }\n\u003Cspan\u003E  }\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\n\u003Cspan\u003Ecat &gt; ca-csr.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd CA\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"algo\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"rsa\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"size\"\u003C\u002Fspan\u003E: 2048\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"names\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E        {\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"C\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"L\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"Beijing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"ST\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"Beijing\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        }\n\u003Cspan\u003E    ]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成证书：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecfssl gencert -initca ca-csr.json | cfssljson -bare ca -\n\u003Cspan\u003Els *pem\n\u003Cspan\u003Eca-key.pem  ca.pem\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 使用自签CA签发Etcd HTTPS证书\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E创建证书申请文件：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; server-csr.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"hosts\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.204\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.151\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.186\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    ],\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"algo\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"rsa\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"size\"\u003C\u002Fspan\u003E: 2048\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"names\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E        {\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"C\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"L\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"ST\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        }\n\u003Cspan\u003E    ]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：上述文件hosts字段中IP为所有etcd节点的集群内部通信IP，一个都不能少！为了方便后期扩容可以多写几个预留的IP。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成证书：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=www server-csr.json | cfssljson -bare server\n\u003Cspan\u003E\n\u003Cspan\u003Els server*pem\n\u003Cspan\u003Eserver-key.pem  server.pem\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E2.3 从GitHub上下载二进制文件\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E下载地址：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fetcd-io\u002Fetcd\u002Freleases\u002Fdownload\u002Fv3.4.9\u002Fetcd-v3.4.9-linux-amd64.tar.gz\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E2.4 部署Etcd集群\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E以下在节点1上操作，为简化操作，待会将节点1生成的所有文件拷贝到节点2和节点3。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建工作目录并解压二进制包\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir \u002Fopt\u002Fetcd\u002F{bin,cfg,ssl} -p\n\u003Cspan\u003Etar zxvf etcd-v3.4.9-linux-amd64.tar.gz\n\u003Cspan\u003Emv etcd-v3.4.9-linux-amd64\u002F{etcd,etcdctl} \u002Fopt\u002Fetcd\u002Fbin\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 创建etcd配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fetcd\u002Fcfg\u002Fetcd.conf &lt;&lt; EOF\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E#[Member]\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_NAME=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-1\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_DATA_DIR=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u002Fvar\u002Flib\u002Fetcd\u002Fdefault.etcd\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_LISTEN_PEER_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:2380\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_LISTEN_CLIENT_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:2379\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E#[Clustering]\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_ADVERTISE_PEER_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:2380\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_ADVERTISE_CLIENT_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:2379\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-1=https:\u002F\u002F10.1.1.204:2380,etcd-2=https:\u002F\u002F10.1.1.151:2380,etcd-3=https:\u002F\u002F10.1.1.186:2380\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER_TOKEN=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-cluster\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER_STATE=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"new\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_NAME：节点名称，集群中唯一\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_DATA_DIR：数据目录\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_LISTEN_PEER_URLS：集群通信监听地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_LISTEN_CLIENT_URLS：客户端访问监听地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_INITIAL_ADVERTISE_PEER_URLS：集群通告地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_ADVERTISE_CLIENT_URLS：客户端通告地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_INITIAL_CLUSTER：集群节点地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_INITIAL_CLUSTER_TOKEN：集群Token\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_INITIAL_CLUSTER_STATE：加入集群的当前状态，new是新集群，existing表示加入已有集群\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. systemd管理etcd集群\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fetcd.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Etcd Server\n\u003Cspan\u003EAfter=network.target\n\u003Cspan\u003EAfter=network-online.target\n\u003Cspan\u003EWants=network-online.target\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EType=notify\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fetcd\u002Fcfg\u002Fetcd.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fetcd\u002Fbin\u002Fetcd \\\n\u003Cspan\u003E--cert-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver.pem \\\n\u003Cspan\u003E--key-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver-key.pem \\\n\u003Cspan\u003E--peer-cert-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver.pem \\\n\u003Cspan\u003E--peer-key-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver-key.pem \\\n\u003Cspan\u003E--trusted-ca-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fca.pem \\\n\u003Cspan\u003E--peer-trusted-ca-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fca.pem \\\n\u003Cspan\u003E--logger=zap\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003ELimitNOFILE=65536\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. 拷贝刚才生成的证书\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E把刚才生成的证书拷贝到配置文件中的路径：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecp ~\u002FTLS\u002Fetcd\u002Fca*pem ~\u002FTLS\u002Fetcd\u002Fserver*pem \u002Fopt\u002Fetcd\u002Fssl\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动并设置开机自启\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start etcd\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E etcd\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E6. 将上面节点1所有生成的文件拷贝到节点2和节点3\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Escp -r \u002Fopt\u002Fetcd\u002F root@10.1.1.151:\u002Fopt\u002F\n\u003Cspan\u003Escp \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fetcd.service root@10.1.1.151:\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002F\n\u003Cspan\u003Escp -r \u002Fopt\u002Fetcd\u002F root@10.1.1.186:\u002Fopt\u002F\n\u003Cspan\u003Escp \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fetcd.service root@10.1.1.186:\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E然后在节点2和节点3分别修改etcd.conf配置文件中的节点名称和当前服务器IP：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Evi \u002Fopt\u002Fetcd\u002Fcfg\u002Fetcd.conf\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E#[Member]\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_NAME=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-1\"\u003C\u002Fspan\u003E   \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 修改此处，节点2改为etcd-2，节点3改为etcd-3\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_DATA_DIR=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u002Fvar\u002Flib\u002Fetcd\u002Fdefault.etcd\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_LISTEN_PEER_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F192.168.31.71:2380\"\u003C\u002Fspan\u003E   \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 修改此处为当前服务器IP\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_LISTEN_CLIENT_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F192.168.31.71:2379\"\u003C\u002Fspan\u003E \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 修改此处为当前服务器IP\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E#[Clustering]\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_ADVERTISE_PEER_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F192.168.31.71:2380\"\u003C\u002Fspan\u003E \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 修改此处为当前服务器IP\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_ADVERTISE_CLIENT_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F192.168.31.71:2379\"\u003C\u002Fspan\u003E \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 修改此处为当前服务器IP\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-1=https:\u002F\u002F192.168.31.71:2380,etcd-2=https:\u002F\u002F192.168.31.72:2380,etcd-3=https:\u002F\u002F192.168.31.73:2380\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER_TOKEN=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-cluster\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER_STATE=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"new\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E最后启动etcd并设置开机启动，同上。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E7. 查看集群状态\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003EETCDCTL_API=3 \u002Fopt\u002Fetcd\u002Fbin\u002Fetcdctl --cacert=\u002Fopt\u002Fetcd\u002Fssl\u002Fca.pem --cert=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver.pem --key=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver-key.pem --endpoints=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:2379,https:\u002F\u002F10.1.1.151:2379,https:\u002F\u002F10.1.1.186:2379\"\u003C\u002Fspan\u003E endpoint health\n\u003Cspan\u003E\n\u003Cspan\u003Ehttps:\u002F\u002F10.1.1.204:2379 is healthy: successfully committed proposal: took = 12.415974ms\n\u003Cspan\u003Ehttps:\u002F\u002F10.1.1.151:2379 is healthy: successfully committed proposal: took = 14.409434ms\n\u003Cspan\u003Ehttps:\u002F\u002F10.1.1.186:2379 is healthy: successfully committed proposal: took = 14.447958ms\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E如果输出上面信息，就说明集群部署成功。如果有问题第一步先看日志：\u002Fvar\u002Flog\u002Fmessage 或 journalctl -u etcd\u003C\u002Fp\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E3. 安装Docker\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E下载地址：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fdownload.docker.com\u002Flinux\u002Fstatic\u002Fstable\u002Fx86_64\u002Fdocker-19.03.9.tgz\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E以下在所有节点操作。这里采用二进制安装，用yum安装也一样。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E3.1 解压二进制包\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Etar zxf docker-19.03.9.tgz\n\u003Cspan\u003Emv docker\u002F* \u002Fusr\u002Fbin\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E3.2 systemd管理docker\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fdocker.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Docker Application Container Engine\n\u003Cspan\u003EDocumentation=https:\u002F\u002Fdocs.docker.com\n\u003Cspan\u003EAfter=network-online.target firewalld.service\n\u003Cspan\u003EWants=network-online.target\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EType=notify\n\u003Cspan\u003EExecStart=\u002Fusr\u002Fbin\u002Fdockerd\n\u003Cspan\u003EExecReload=\u002Fbin\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ekill\u003C\u002Fspan\u003E -s HUP \u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$MAINPID\u003C\u002Fspan\u003E\n\u003Cspan\u003ELimitNOFILE=infinity\n\u003Cspan\u003ELimitNPROC=infinity\n\u003Cspan\u003ELimitCORE=infinity\n\u003Cspan\u003ETimeoutStartSec=0\n\u003Cspan\u003EDelegate=yes\n\u003Cspan\u003EKillMode=process\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003EStartLimitBurst=3\n\u003Cspan\u003EStartLimitInterval=60s\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E3.3 创建配置文件\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir \u002Fetc\u002Fdocker\n\u003Cspan\u003Ecat &gt; \u002Fetc\u002Fdocker\u002Fdaemon.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"registry-mirrors\"\u003C\u002Fspan\u003E: [\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002Fb9pmyelo.mirror.aliyuncs.com\"\u003C\u002Fspan\u003E]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003Eregistry-mirrors 阿里云镜像加速器\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E3.4 启动并设置开机启动\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start docker\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E docker\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E4. 部署Master Node\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.1 生成kube-apiserver证书\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 自签证书颁发机构（CA）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E ~\u002FTLS\u002Fk8s\u002F\n\u003Cspan\u003E\n\u003Cspan\u003Ecat &gt; ca-config.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"signing\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"default\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"expiry\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"87600h\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"profiles\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E         \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"expiry\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"87600h\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E         \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"usages\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"signing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key encipherment\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"server auth\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"client auth\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        ]\n\u003Cspan\u003E      }\n\u003Cspan\u003E    }\n\u003Cspan\u003E  }\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\n\u003Cspan\u003Ecat &gt; ca-csr.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"algo\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"rsa\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"size\"\u003C\u002Fspan\u003E: 2048\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"names\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E        {\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"C\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"L\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"Beijing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"ST\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"Beijing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"O\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"k8s\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"OU\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"System\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        }\n\u003Cspan\u003E    ]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成证书：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecfssl gencert -initca ca-csr.json | cfssljson -bare ca -\n\u003Cspan\u003E\n\u003Cspan\u003Els *pem\n\u003Cspan\u003Eca-key.pem  ca.pem\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 使用自签CA签发kube-apiserver HTTPS证书\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E创建证书申请文件：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; server-csr.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"hosts\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.0.0.1\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"127.0.0.1\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.204\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.230\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.151\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.186\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.220\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.169\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.170\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes.default\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes.default.svc\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes.default.svc.cluster\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes.default.svc.cluster.local\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    ],\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"algo\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"rsa\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"size\"\u003C\u002Fspan\u003E: 2048\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"names\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E        {\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"C\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"L\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"ST\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"O\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"k8s\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"OU\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"System\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        }\n\u003Cspan\u003E    ]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：上述文件hosts字段中IP为所有Master\u002FLB\u002FVIP IP，一个都不能少！为了方便后期扩容可以多写几个预留的IP。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成证书：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes server-csr.json | cfssljson -bare server\n\u003Cspan\u003E\n\u003Cspan\u003Els server*pem\n\u003Cspan\u003Eserver-key.pem  server.pem\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.2 从GitHub下载二进制文件\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E下载地址\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fkubernetes\u002Fkubernetes\u002Fblob\u002Fmaster\u002FCHANGELOG\u002FCHANGELOG-1.18.md#v1183\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：打开链接你会发现里面有很多包，下载一个server包就够了，包含了Master和Worker Node二进制文件。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E例如：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fdl.k8s.io\u002Fv1.18.3\u002Fkubernetes-server-linux-amd64.tar.gz\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.3 解压二进制包\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir -p \u002Fopt\u002Fkubernetes\u002F{bin,cfg,ssl,logs} \n\u003Cspan\u003Etar zxf kubernetes-server-linux-amd64.tar.gz\n\u003Cspan\u003E\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E kubernetes\u002Fserver\u002Fbin\n\u003Cspan\u003Ecp kube-apiserver kube-scheduler kube-controller-manager \u002Fopt\u002Fkubernetes\u002Fbin\n\u003Cspan\u003Ecp kubectl \u002Fusr\u002Fbin\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.4 部署kube-apiserver\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-apiserver.conf &lt;&lt; EOF\n\u003Cspan\u003EKUBE_APISERVER_OPTS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"--logtostderr=false \\\\\n\u003Cspan\u003E--v=2 \\\\\n\u003Cspan\u003E--log-dir=\u002Fopt\u002Fkubernetes\u002Flogs \\\\\n\u003Cspan\u003E--etcd-servers=https:\u002F\u002F10.1.1.204:2379,https:\u002F\u002F10.1.1.151:2379,https:\u002F\u002F10.1.1.186:2379 \\\\\n\u003Cspan\u003E--bind-address=10.1.1.204 \\\\\n\u003Cspan\u003E--secure-port=6443 \\\\\n\u003Cspan\u003E--advertise-address=10.1.1.204 \\\\\n\u003Cspan\u003E--allow-privileged=true \\\\\n\u003Cspan\u003E--service-cluster-ip-range=10.0.0.0\u002F24 \\\\\n\u003Cspan\u003E--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\\\\n\u003Cspan\u003E--authorization-mode=RBAC,Node \\\\\n\u003Cspan\u003E--enable-bootstrap-token-auth=true \\\\\n\u003Cspan\u003E--token-auth-file=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Ftoken.csv \\\\\n\u003Cspan\u003E--service-node-port-range=30000-32767 \\\\\n\u003Cspan\u003E--kubelet-client-certificate=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fserver.pem \\\\\n\u003Cspan\u003E--kubelet-client-key=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fserver-key.pem \\\\\n\u003Cspan\u003E--tls-cert-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fserver.pem  \\\\\n\u003Cspan\u003E--tls-private-key-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fserver-key.pem \\\\\n\u003Cspan\u003E--client-ca-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \\\\\n\u003Cspan\u003E--service-account-key-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca-key.pem \\\\\n\u003Cspan\u003E--etcd-cafile=\u002Fopt\u002Fetcd\u002Fssl\u002Fca.pem \\\\\n\u003Cspan\u003E--etcd-certfile=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver.pem \\\\\n\u003Cspan\u003E--etcd-keyfile=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver-key.pem \\\\\n\u003Cspan\u003E--audit-log-maxage=30 \\\\\n\u003Cspan\u003E--audit-log-maxbackup=3 \\\\\n\u003Cspan\u003E--audit-log-maxsize=100 \\\\\n\u003Cspan\u003E--audit-log-path=\u002Fopt\u002Fkubernetes\u002Flogs\u002Fk8s-audit.log\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：上面两个\\ \\ 第一个是转义符，第二个是换行符，使用转义符是为了使用EOF保留换行符。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--logtostderr：启用日志\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--v：日志等级\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--log-dir：日志目录\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--etcd-servers：etcd集群地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--bind-address：监听地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--secure-port：https安全端口\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--advertise-address：集群通告地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--allow-privileged：启用授权\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--service-cluster-ip-range：Service虚拟IP地址段\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--enable-admission-plugins：准入控制模块\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--authorization-mode：认证授权，启用RBAC授权和节点自管理\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--enable-bootstrap-token-auth：启用TLS bootstrap机制\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--token-auth-file：bootstrap token文件\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--service-node-port-range：Service nodeport类型默认分配端口范围\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--kubelet-client-xxx：apiserver访问kubelet客户端证书\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--tls-xxx-file：apiserver https证书\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--etcd-xxxfile：连接Etcd集群证书\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--audit-log-xxx：审计日志\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 拷贝刚才生成的证书\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E把刚才生成的证书拷贝到配置文件中的路径：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecp ~\u002FTLS\u002Fk8s\u002Fca*pem ~\u002FTLS\u002Fk8s\u002Fserver*pem \u002Fopt\u002Fkubernetes\u002Fssl\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 启用 TLS Bootstrapping 机制\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003ETLS Bootstraping：Master apiserver启用TLS认证后，Node节点kubelet和kube-proxy要与kube-apiserver进行通信，必须使用CA签发的有效证书才可以，当Node节点很多时，这种客户端证书颁发需要大量工作，同样也会增加集群扩展复杂度。为了简化流程，Kubernetes引入了TLS bootstraping机制来自动颁发客户端证书，kubelet会以一个低权限用户自动向apiserver申请证书，kubelet的证书由apiserver动态签署。所以强烈建议在Node上使用这种方式，目前主要用于kubelet，kube-proxy还是由我们统一颁发一个证书。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003ETLS bootstraping 工作流程：\u003C\u002Fp\u003E\n\u003Cfigure style=\"margin: 0; margin-top: 10px; margin-bottom: 10px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cimg style=\"max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;\" alt=\"\" src=\"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F1730895b37203331?w=779&amp;h=677&amp;f=png&amp;s=36862\"\u003E\u003C\u002Ffigure\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E创建上述配置文件中token文件：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Ftoken.csv &lt;&lt; EOF\n\u003Cspan\u003E8054b7219e601b121e8d2b4f73d255ad,kubelet-bootstrap,10001,\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"system:node-bootstrapper\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E格式：token，用户名，UID，用户组\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003Etoken也可自行生成替换：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ehead -c 16 \u002Fdev\u002Furandom | od -An -t x | tr -d \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E' '\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. systemd管理apiserver\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkube-apiserver.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Kubernetes API Server\n\u003Cspan\u003EDocumentation=https:\u002F\u002Fgithub.com\u002Fkubernetes\u002Fkubernetes\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-apiserver.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fkubernetes\u002Fbin\u002Fkube-apiserver \\\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$KUBE_APISERVER_OPTS\u003C\u002Fspan\u003E\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kube-apiserver\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-apiserver\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E6. 授权kubelet-bootstrap用户允许请求证书\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl create clusterrolebinding kubelet-bootstrap \\\n\u003Cspan\u003E--clusterrole=system:node-bootstrapper \\\n\u003Cspan\u003E--user=kubelet-bootstrap\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.5 部署kube-controller-manager\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-controller-manager.conf &lt;&lt; EOF\n\u003Cspan\u003EKUBE_CONTROLLER_MANAGER_OPTS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"--logtostderr=false \\\\\n\u003Cspan\u003E--v=2 \\\\\n\u003Cspan\u003E--log-dir=\u002Fopt\u002Fkubernetes\u002Flogs \\\\\n\u003Cspan\u003E--leader-elect=true \\\\\n\u003Cspan\u003E--master=127.0.0.1:8080 \\\\\n\u003Cspan\u003E--bind-address=127.0.0.1 \\\\\n\u003Cspan\u003E--allocate-node-cidrs=true \\\\\n\u003Cspan\u003E--cluster-cidr=10.244.0.0\u002F16 \\\\\n\u003Cspan\u003E--service-cluster-ip-range=10.0.0.0\u002F24 \\\\\n\u003Cspan\u003E--cluster-signing-cert-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \\\\\n\u003Cspan\u003E--cluster-signing-key-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca-key.pem  \\\\\n\u003Cspan\u003E--root-ca-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \\\\\n\u003Cspan\u003E--service-account-private-key-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca-key.pem \\\\\n\u003Cspan\u003E--experimental-cluster-signing-duration=87600h0m0s\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--master：通过本地非安全本地端口8080连接apiserver\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--leader-elect：当该组件启动多个时，自动选举（HA）\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--cluster-signing-cert-file\u002F–cluster-signing-key-file：自动为kubelet颁发证书的CA，与apiserver保持一致\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. systemd管理controller-manager\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkube-controller-manager.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Kubernetes Controller Manager\n\u003Cspan\u003EDocumentation=https:\u002F\u002Fgithub.com\u002Fkubernetes\u002Fkubernetes\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-controller-manager.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fkubernetes\u002Fbin\u002Fkube-controller-manager \\\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$KUBE_CONTROLLER_MANAGER_OPTS\u003C\u002Fspan\u003E\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kube-controller-manager\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-controller-manager\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.6 部署kube-scheduler\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-scheduler.conf &lt;&lt; EOF\n\u003Cspan\u003EKUBE_SCHEDULER_OPTS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"--logtostderr=false \\\n\u003Cspan\u003E--v=2 \\\n\u003Cspan\u003E--log-dir=\u002Fopt\u002Fkubernetes\u002Flogs \\\n\u003Cspan\u003E--leader-elect \\\n\u003Cspan\u003E--master=127.0.0.1:8080 \\\n\u003Cspan\u003E--bind-address=127.0.0.1\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--master：通过本地非安全本地端口8080连接apiserver\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--leader-elect：当该组件启动多个时，自动选举（HA）\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. systemd管理scheduler\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkube-scheduler.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Kubernetes Scheduler\n\u003Cspan\u003EDocumentation=https:\u002F\u002Fgithub.com\u002Fkubernetes\u002Fkubernetes\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-scheduler.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fkubernetes\u002Fbin\u002Fkube-scheduler \\\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$KUBE_SCHEDULER_OPTS\u003C\u002Fspan\u003E\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kube-scheduler\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-scheduler\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. 查看集群状态\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E所有组件都已经启动成功，通过kubectl工具查看当前集群组件状态：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get cs\n\u003Cspan\u003E\n\u003Cspan\u003ENAME                 STATUS    MESSAGE             ERROR\n\u003Cspan\u003Escheduler            Healthy   ok                  \n\u003Cspan\u003Econtroller-manager   Healthy   ok                  \n\u003Cspan\u003Eetcd-0               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}   \n\u003Cspan\u003Eetcd-2               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}   \n\u003Cspan\u003Eetcd-1               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E如上输出说明Master节点组件运行正常。\u003C\u002Fp\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E5. 部署Worker Node\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E下面还是在Master Node上操作，即同时作为Worker Node。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.1 创建工作目录并拷贝二进制文件\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E在所有worker node创建工作目录：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir -p \u002Fopt\u002Fkubernetes\u002F{bin,cfg,ssl,logs}\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E从master节点拷贝：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E ~\u002Fkubernetes\u002Fserver\u002Fbin\n\u003Cspan\u003Ecp kubelet kube-proxy \u002Fopt\u002Fkubernetes\u002Fbin   \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 本地拷贝\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.2 部署kubelet\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.conf &lt;&lt; EOF\n\u003Cspan\u003EKUBELET_OPTS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"--logtostderr=false \\\\\n\u003Cspan\u003E--v=2 \\\\\n\u003Cspan\u003E--log-dir=\u002Fopt\u002Fkubernetes\u002Flogs \\\\\n\u003Cspan\u003E--hostname-override=k8s-master1 \\\\\n\u003Cspan\u003E--network-plugin=cni \\\\\n\u003Cspan\u003E--kubeconfig=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.kubeconfig \\\\\n\u003Cspan\u003E--bootstrap-kubeconfig=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fbootstrap.kubeconfig \\\\\n\u003Cspan\u003E--config=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet-config.yml \\\\\n\u003Cspan\u003E--cert-dir=\u002Fopt\u002Fkubernetes\u002Fssl \\\\\n\u003Cspan\u003E--pod-infra-container-image=lizhenliang\u002Fpause-amd64:3.0\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–hostname-override：显示名称，集群中唯一\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–network-plugin：启用CNI\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–kubeconfig：空路径，会自动生成，后面用于连接apiserver\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–bootstrap-kubeconfig：首次启动向apiserver申请证书\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–config：配置参数文件\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–cert-dir：kubelet证书生成目录\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–pod-infra-container-image：管理Pod网络容器的镜像\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 配置参数文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet-config.yml &lt;&lt; EOF\n\u003Cspan\u003Ekind: KubeletConfiguration\n\u003Cspan\u003EapiVersion: kubelet.config.k8s.io\u002Fv1beta1\n\u003Cspan\u003Eaddress: 0.0.0.0\n\u003Cspan\u003Eport: 10250\n\u003Cspan\u003EreadOnlyPort: 10255\n\u003Cspan\u003EcgroupDriver: cgroupfs\n\u003Cspan\u003EclusterDNS:\n\u003Cspan\u003E- 10.0.0.2\n\u003Cspan\u003EclusterDomain: cluster.local \n\u003Cspan\u003EfailSwapOn: \u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Efalse\u003C\u002Fspan\u003E\n\u003Cspan\u003Eauthentication:\n\u003Cspan\u003E  anonymous:\n\u003Cspan\u003E    enabled: \u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Efalse\u003C\u002Fspan\u003E\n\u003Cspan\u003E  webhook:\n\u003Cspan\u003E    cacheTTL: 2m0s\n\u003Cspan\u003E    enabled: \u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n\u003Cspan\u003E  x509:\n\u003Cspan\u003E    clientCAFile: \u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \n\u003Cspan\u003Eauthorization:\n\u003Cspan\u003E  mode: Webhook\n\u003Cspan\u003E  webhook:\n\u003Cspan\u003E    cacheAuthorizedTTL: 5m0s\n\u003Cspan\u003E    cacheUnauthorizedTTL: 30s\n\u003Cspan\u003EevictionHard:\n\u003Cspan\u003E  imagefs.available: 15%\n\u003Cspan\u003E  memory.available: 100Mi\n\u003Cspan\u003E  nodefs.available: 10%\n\u003Cspan\u003E  nodefs.inodesFree: 5%\n\u003Cspan\u003EmaxOpenFiles: 1000000\n\u003Cspan\u003EmaxPods: 110\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 生成bootstrap.kubeconfig文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003EKUBE_APISERVER=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:6443\"\u003C\u002Fspan\u003E \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# apiserver IP:PORT\u003C\u002Fspan\u003E\n\u003Cspan\u003ETOKEN=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"8054b7219e601b121e8d2b4f73d255ad\"\u003C\u002Fspan\u003E \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 与token.csv里保持一致\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 生成 kubelet bootstrap kubeconfig 配置文件\u003C\u002Fspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-cluster kubernetes \\\n\u003Cspan\u003E  --certificate-authority=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \\\n\u003Cspan\u003E  --embed-certs=\u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --server=\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E${KUBE_APISERVER}\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --kubeconfig=bootstrap.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-credentials \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubelet-bootstrap\"\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --token=\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E${TOKEN}\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --kubeconfig=bootstrap.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-context default \\\n\u003Cspan\u003E  --cluster=kubernetes \\\n\u003Cspan\u003E  --user=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubelet-bootstrap\"\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --kubeconfig=bootstrap.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config use-context default --kubeconfig=bootstrap.kubeconfig\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E拷贝到配置文件路径：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecp bootstrap.kubeconfig \u002Fopt\u002Fkubernetes\u002Fcfg\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. systemd管理kubelet\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkubelet.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Kubernetes Kubelet\n\u003Cspan\u003EAfter=docker.service\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fkubernetes\u002Fbin\u002Fkubelet \\\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$KUBELET_OPTS\u003C\u002Fspan\u003E\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003ELimitNOFILE=65536\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kubelet\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kubelet\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.3 批准kubelet证书申请并加入集群\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 查看kubelet证书请求\u003C\u002Fspan\u003E\n\u003Cspan\u003Ekubectl get csr\n\u003Cspan\u003E\n\u003Cspan\u003ENAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION\n\u003Cspan\u003Enode-csr-ngC06Pj7kmQUvmzBnbfLRxUVG1J90dlT2lWMkCNbnBA   26s   kubernetes.io\u002Fkube-apiserver-client-kubelet   kubelet-bootstrap   Pending\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 批准申请(approve后跟上一步生成的node-*)\u003C\u002Fspan\u003E\n\u003Cspan\u003Ekubectl certificate approve node-csr-uCEGPOIiDdlLODKts8J658HrFq9CZ--K6M4G7bjhk8A\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 查看节点\u003C\u002Fspan\u003E\n\u003Cspan\u003Ekubectl get node\n\u003Cspan\u003ENAME          STATUS     ROLES    AGE   VERSION\n\u003Cspan\u003Ek8s-master1   NotReady   &lt;none&gt;   6s    v1.18.3\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：由于网络插件还没有部署，节点会没有准备就绪 NotReady。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.4 部署kube-proxy\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy.conf &lt;&lt; EOF\n\u003Cspan\u003EKUBE_PROXY_OPTS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"--logtostderr=false \\\\\n\u003Cspan\u003E--v=2 \\\\\n\u003Cspan\u003E--log-dir=\u002Fopt\u002Fkubernetes\u002Flogs \\\\\n\u003Cspan\u003E--config=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy-config.yml\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 配置参数文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy-config.yml &lt;&lt; EOF\n\u003Cspan\u003Ekind: KubeProxyConfiguration\n\u003Cspan\u003EapiVersion: kubeproxy.config.k8s.io\u002Fv1alpha1\n\u003Cspan\u003EbindAddress: 0.0.0.0\n\u003Cspan\u003EmetricsBindAddress: 0.0.0.0:10249\n\u003Cspan\u003EclientConnection:\n\u003Cspan\u003E  kubeconfig: \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy.kubeconfig\n\u003Cspan\u003EhostnameOverride: k8s-master1\n\u003Cspan\u003EclusterCIDR: 10.0.0.0\u002F24\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 生成kube-proxy.kubeconfig文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成kube-proxy证书：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 切换工作目录\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E ~\u002FTLS\u002Fk8s\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 创建证书请求文件\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecat &gt; kube-proxy-csr.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"system:kube-proxy\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"hosts\"\u003C\u002Fspan\u003E: [],\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"algo\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"rsa\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"size\"\u003C\u002Fspan\u003E: 2048\n\u003Cspan\u003E  },\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"names\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E    {\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"C\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"L\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"ST\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"O\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"k8s\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"OU\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"System\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    }\n\u003Cspan\u003E  ]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 生成证书\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy\n\u003Cspan\u003E\n\u003Cspan\u003Els kube-proxy*pem\n\u003Cspan\u003Ekube-proxy-key.pem  kube-proxy.pem\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成kubeconfig文件：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003EKUBE_APISERVER=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:6443\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-cluster kubernetes \\\n\u003Cspan\u003E  --certificate-authority=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \\\n\u003Cspan\u003E  --embed-certs=\u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --server=\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E${KUBE_APISERVER}\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --kubeconfig=kube-proxy.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-credentials kube-proxy \\\n\u003Cspan\u003E  --client-certificate=.\u002Fkube-proxy.pem \\\n\u003Cspan\u003E  --client-key=.\u002Fkube-proxy-key.pem \\\n\u003Cspan\u003E  --embed-certs=\u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --kubeconfig=kube-proxy.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-context default \\\n\u003Cspan\u003E  --cluster=kubernetes \\\n\u003Cspan\u003E  --user=kube-proxy \\\n\u003Cspan\u003E  --kubeconfig=kube-proxy.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E拷贝到配置文件指定路径：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecp kube-proxy.kubeconfig \u002Fopt\u002Fkubernetes\u002Fcfg\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. systemd管理kube-proxy\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkube-proxy.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Kubernetes Proxy\n\u003Cspan\u003EAfter=network.target\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fkubernetes\u002Fbin\u002Fkube-proxy \\\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$KUBE_PROXY_OPTS\u003C\u002Fspan\u003E\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003ELimitNOFILE=65536\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kube-proxy\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-proxy\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.5 部署CNI网络\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E先准备好CNI二进制文件：\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E下载地址：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fcontainernetworking\u002Fplugins\u002Freleases\u002Fdownload\u002Fv0.8.6\u002Fcni-plugins-linux-amd64-v0.8.6.tgz\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E解压二进制包并移动到默认工作目录：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir -p \u002Fopt\u002Fcni\u002Fbin\n\u003Cspan\u003Etar zxvf cni-plugins-linux-amd64-v0.8.6.tgz -C \u002Fopt\u002Fcni\u002Fbin\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E部署CNI网络：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ewget https:\u002F\u002Fraw.githubusercontent.com\u002Fcoreos\u002Fflannel\u002Fmaster\u002FDocumentation\u002Fkube-flannel.yml\n\u003Cspan\u003Esed -i -r \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"s#quay.io\u002Fcoreos\u002Fflannel:.*-amd64#lizhenliang\u002Fflannel:v0.12.0-amd64#g\"\u003C\u002Fspan\u003E kube-flannel.yml\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 这里需要一个国内镜像地址，国外的无法访问\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E默认镜像地址无法访问，修改为docker hub镜像仓库。\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl apply -f kube-flannel.yml\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl get pods -n kube-system\n\u003Cspan\u003ENAME                          READY   STATUS     RESTARTS   AGE\n\u003Cspan\u003Ekube-flannel-ds-amd64-jj98k   0\u002F1     Init:0\u002F1   0          14s\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl get node\n\u003Cspan\u003ENAME          STATUS     ROLES    AGE   VERSION\n\u003Cspan\u003Ek8s-master1   Ready   &lt;none&gt;   14m   v1.18.3\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E部署好网络插件，Node准备就绪。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.6 授权apiserver访问kubelet\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; apiserver-to-kubelet-rbac.yaml &lt;&lt; EOF\n\u003Cspan\u003EapiVersion: rbac.authorization.k8s.io\u002Fv1\n\u003Cspan\u003Ekind: ClusterRole\n\u003Cspan\u003Emetadata:\n\u003Cspan\u003E  annotations:\n\u003Cspan\u003E    rbac.authorization.kubernetes.io\u002Fautoupdate: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E  labels:\n\u003Cspan\u003E    kubernetes.io\u002Fbootstrapping: rbac-defaults\n\u003Cspan\u003E  name: system:kube-apiserver-to-kubelet\n\u003Cspan\u003Erules:\n\u003Cspan\u003E  - apiGroups:\n\u003Cspan\u003E      - \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    resources:\n\u003Cspan\u003E      - nodes\u002Fproxy\n\u003Cspan\u003E      - nodes\u002Fstats\n\u003Cspan\u003E      - nodes\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\n\u003Cspan\u003E      - nodes\u002Fspec\n\u003Cspan\u003E      - nodes\u002Fmetrics\n\u003Cspan\u003E      - pods\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\n\u003Cspan\u003E    verbs:\n\u003Cspan\u003E      - \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"*\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E---\n\u003Cspan\u003EapiVersion: rbac.authorization.k8s.io\u002Fv1\n\u003Cspan\u003Ekind: ClusterRoleBinding\n\u003Cspan\u003Emetadata:\n\u003Cspan\u003E  name: system:kube-apiserver\n\u003Cspan\u003E  namespace: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EroleRef:\n\u003Cspan\u003E  apiGroup: rbac.authorization.k8s.io\n\u003Cspan\u003E  kind: ClusterRole\n\u003Cspan\u003E  name: system:kube-apiserver-to-kubelet\n\u003Cspan\u003Esubjects:\n\u003Cspan\u003E  - apiGroup: rbac.authorization.k8s.io\n\u003Cspan\u003E    kind: User\n\u003Cspan\u003E    name: kubernetes\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl apply -f apiserver-to-kubelet-rbac.yaml\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.7 新增加Worker Node\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 拷贝已部署好的Node相关文件到新节点(k8s-master1上执行)\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E在Master节点将Worker Node涉及文件拷贝到新节点10.1.1.151\u002F186\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Escp -r \u002Fopt\u002Fkubernetes root@10.1.1.151:\u002Fopt\u002F\n\u003Cspan\u003Escp -r \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002F{kubelet,kube-proxy}.service root@10.1.1.151:\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\n\u003Cspan\u003Escp -r \u002Fopt\u002Fcni\u002F root@10.1.1.151:\u002Fopt\u002F\n\u003Cspan\u003Escp -r \u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem root@10.1.1.151:\u002Fopt\u002Fkubernetes\u002Fssl\n\u003Cspan\u003E\n\u003Cspan\u003Escp -r \u002Fopt\u002Fkubernetes root@10.1.1.186:\u002Fopt\u002F\n\u003Cspan\u003Escp -r \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002F{kubelet,kube-proxy}.service root@10.1.1.186:\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\n\u003Cspan\u003Escp -r \u002Fopt\u002Fcni\u002F root@10.1.1.186:\u002Fopt\u002F\n\u003Cspan\u003Escp -r \u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem root@10.1.1.186:\u002Fopt\u002Fkubernetes\u002Fssl\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 删除kubelet证书和kubeconfig文件(k8s-worker1\u002F2上执行)\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Erm -f \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.kubeconfig\n\u003Cspan\u003Erm -f \u002Fopt\u002Fkubernetes\u002Fssl\u002Fkubelet*\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：这几个文件是证书申请审批后自动生成的，每个Node不同，必须删除重新生成。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 修改主机名(k8s-worker1\u002F2上执行)\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.conf\n\u003Cspan\u003E--hostname-override=k8s-worker1\n\u003Cspan\u003E\n\u003Cspan\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy-config.yml\n\u003Cspan\u003EhostnameOverride: k8s-worker1\n\u003Cspan\u003E\n\u003Cspan\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.conf\n\u003Cspan\u003E--hostname-override=k8s-worker2\n\u003Cspan\u003E\n\u003Cspan\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy-config.yml\n\u003Cspan\u003EhostnameOverride: k8s-worker2\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. 启动并设置开机启动(k8s-worker1\u002F2上执行)\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kubelet\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kubelet\n\u003Cspan\u003Esystemctl start kube-proxy\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-proxy\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 在Master上批准新Node kubelet证书申请\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get csr\n\u003Cspan\u003ENAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION\n\u003Cspan\u003Enode-csr-mZ1Shcds5I90zfqQupi-GaI_4MeKl7PizK5dgOF2wC8   14s   kubernetes.io\u002Fkube-apiserver-client-kubelet   kubelet-bootstrap   Pending\n\u003Cspan\u003Enode-csr-x-lWfrl2pFrMUblecU5NYgpn3zI6j_iiTmcKZ1JRefY   20s   kubernetes.io\u002Fkube-apiserver-client-kubelet   kubelet-bootstrap   Pending\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl certificate approve node-csr-mZ1Shcds5I90zfqQupi-GaI_4MeKl7PizK5dgOF2wC8\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl certificate approve node-csr-x-lWfrl2pFrMUblecU5NYgpn3zI6j_iiTmcKZ1JRefY\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E6. 查看Node状态\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get node\n\u003Cspan\u003ENAME         STATUS     ROLES    AGE   VERSION\n\u003Cspan\u003Ek8s-master1   Ready      &lt;none&gt;   65m   v1.18.3\n\u003Cspan\u003Ek8s-worker1    Ready      &lt;none&gt;   12m   v1.18.3\n\u003Cspan\u003Ek8s-worker2    Ready      &lt;none&gt;   81s   v1.18.3\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E6. 部署Dashboard和CoreDNS\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E6.1 部署Dashboard\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ewget https:\u002F\u002Fraw.githubusercontent.com\u002Fkubernetes\u002Fdashboard\u002Fv2.0.0-beta8\u002Faio\u002Fdeploy\u002Frecommended.yaml\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E默认Dashboard只能集群内部访问，修改Service为NodePort类型，暴露到外部：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Evi recommended.yaml\n\u003Cspan\u003Ekind: Service\n\u003Cspan\u003EapiVersion: v1\n\u003Cspan\u003Emetadata:\n\u003Cspan\u003E  labels:\n\u003Cspan\u003E    k8s-app: kubernetes-dashboard\n\u003Cspan\u003E  name: kubernetes-dashboard\n\u003Cspan\u003E  namespace: kubernetes-dashboard\n\u003Cspan\u003Espec:\n\u003Cspan\u003E  ports:\n\u003Cspan\u003E    - port: 443\n\u003Cspan\u003E      targetPort: 8443\n\u003Cspan\u003E      nodePort: 30001\n\u003Cspan\u003E  \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Etype\u003C\u002Fspan\u003E: NodePort\n\u003Cspan\u003E  selector:\n\u003Cspan\u003E    k8s-app: kubernetes-dashboard\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl apply -f recommended.yaml    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 这里有个坑，需要等待一段时间下方STATUS为Running才行\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get pods,svc -n kubernetes-dashboard\n\u003Cspan\u003E\n\u003Cspan\u003ENAME                                             READY   STATUS    RESTARTS   AGE\n\u003Cspan\u003Epod\u002Fdashboard-metrics-scraper-694557449d-dhlrq   1\u002F1     Running   0          27s\n\u003Cspan\u003Epod\u002Fkubernetes-dashboard-9774cc786-7d6qn         1\u002F1     Running   0          27s\n\u003Cspan\u003E\n\u003Cspan\u003ENAME                                TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)         AGE\n\u003Cspan\u003Eservice\u002Fdashboard-metrics-scraper   ClusterIP   10.0.0.36    &lt;none&gt;        8000\u002FTCP        27s\n\u003Cspan\u003Eservice\u002Fkubernetes-dashboard        NodePort    10.0.0.154   &lt;none&gt;        443:30001\u002FTCP   27s\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E访问地址：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002FNodeIP:30001\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E创建service account并绑定默认cluster-admin管理员集群角色：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl create serviceaccount dashboard-admin -n kube-system\n\u003Cspan\u003Ekubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin\n\u003Cspan\u003Ekubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E'\u002Fdashboard-admin\u002F{print $1}'\u003C\u002Fspan\u003E)\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E获得token：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003EeyJhbGciOiJSUzI1NiIsImtpZCI6IlVZczd4TDN3VHRpLWdNUnRlc1BOY2E0T3Z1Q3UzQmlwUEZpaEZHclJ0MWcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tNWRod2YiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMTMzZmVkODItM2Q3OC00ODk5LWJiMzYtY2YyZjU4NzgzZTRlIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.gTuj33hMUmvgdPU499ifrn4V8AjinlRhzkw2ItdNRVdUmU6YLbSjZIp8WlPOkdtmDM2c3LCkLmnBqIabkIiIwb1HkNOtmglnFghzV8Td5GIGnoRqAmKPXO0aY4Y97w_X0sVC3DB34EY6soPlcI_v6_-nSqRC1rPOSJ9xd8yU774YHYucYqiU-ViiIgqHELo7BT6CVD1iLw4K_C5wfWs4o6htplhGpJ0edLPsZpwnTrW-4qn4d-EdKXcVJhpTUxxLoKL7HrerTwxeUMM1SL0vGnD5z2io9gybylubbgV7xRsSQQCwuXWqlzI6A_YWzl3-wmhwty4x9cWjQHMGw87YhA\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E使用输出的token登录Dashboard。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E6.2 部署CoreDNS\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003ECoreDNS用于集群内部Service名称解析。\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecurl -o .\u002Fcoredns.yaml https:\u002F\u002Fgithub.com\u002Fkubernetes\u002Fkubernetes\u002Fblob\u002Fe176e477195f92919724bd02f81e2b18d4477af7\u002Fcluster\u002Faddons\u002Fdns\u002Fcoredns\u002Fcoredns.yaml.sed\n\u003Cspan\u003Ekubectl apply -f coredns.yaml    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 这个地方需要修改下把CLUSTER_DNS_IP变量删除\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl get pods -n kube-system     \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 等待下方第一个STATUS为Running为准\u003C\u002Fspan\u003E\n\u003Cspan\u003ENAME                          READY   STATUS    RESTARTS   AGE\n\u003Cspan\u003Ecoredns-5ffbfd976d-j6shb      1\u002F1     Running   0          32s\n\u003Cspan\u003Ekube-flannel-ds-amd64-2pc95   1\u002F1     Running   0          38m\n\u003Cspan\u003Ekube-flannel-ds-amd64-7qhdx   1\u002F1     Running   0          15m\n\u003Cspan\u003Ekube-flannel-ds-amd64-99cr8   1\u002F1     Running   0          26m\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EDNS解析测试：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl run -it --rm dns-test --image=busybox:1.28.4 sh\n\u003Cspan\u003EIf you don\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E't see a command prompt, try pressing enter.\n\u003Cspan\u003E\n\u003Cspan\u003E\u002F # nslookup kubernetes\n\u003Cspan\u003EServer:    10.0.0.2\n\u003Cspan\u003EAddress 1: 10.0.0.2 kube-dns.kube-system.svc.cluster.local\n\u003Cspan\u003E\n\u003Cspan\u003EName:      kubernetes\n\u003Cspan\u003EAddress 1: 10.0.0.1 kubernetes.default.svc.cluster.local\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E解析没问题。\u003C\u002Fp\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E7. 高可用架构（扩容多Master架构）\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EKubernetes作为容器集群系统，通过健康检查+重启策略实现了Pod故障自我修复能力，通过调度算法实现将Pod分布式部署，并保持预期副本数，根据Node失效状态自动在其他Node拉起Pod，实现了应用层的高可用性。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E针对Kubernetes集群，高可用性还应包含以下两个层面的考虑：Etcd数据库的高可用性和Kubernetes Master组件的高可用性。 而Etcd我们已经采用3个节点组建集群实现高可用，本节将对Master节点高可用进行说明和实施。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EMaster节点扮演着总控中心的角色，通过不断与工作节点上的Kubelet和kube-proxy进行通信来维护整个集群的健康工作状态。如果Master节点故障，将无法使用kubectl工具或者API做任何集群管理。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EMaster节点主要有三个服务kube-apiserver、kube-controller-manager和kube-scheduler，其中kube-controller-manager和kube-scheduler组件自身通过选择机制已经实现了高可用，所以Master高可用主要针对kube-apiserver组件，而该组件是以HTTP API提供服务，因此对他高可用与Web服务器类似，增加负载均衡器对其负载均衡即可，并且可水平扩容。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E多Master架构图：\u003C\u002Fp\u003E\n\u003Cfigure style=\"margin: 0; margin-top: 10px; margin-bottom: 10px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cimg style=\"max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;\" alt=\"\" src=\"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F1730895b37323660?w=1020&amp;h=763&amp;f=png&amp;s=37599\"\u003E\u003C\u002Ffigure\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E7.1 安装Docker\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E同上，不再赘述。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E7.2 部署Master2 Node（10.1.1.230）\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EMaster2 与已部署的Master1所有操作一致。所以我们只需将Master1所有K8s文件拷贝过来，再修改下服务器IP和主机名启动即可。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建etcd证书目录\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E在Master2创建etcd证书目录：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir -p \u002Fopt\u002Fetcd\u002Fssl\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 拷贝文件（Master1操作）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E拷贝Master1上所有K8s文件和etcd证书到Master2：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Escp -r \u002Fopt\u002Fkubernetes root@10.1.1.230:\u002Fopt\n\u003Cspan\u003Escp -r \u002Fopt\u002Fcni\u002F root@10.1.1.230:\u002Fopt\n\u003Cspan\u003Escp -r \u002Fopt\u002Fetcd\u002Fssl root@10.1.1.230:\u002Fopt\u002Fetcd\n\u003Cspan\u003Escp \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkube* root@10.1.1.230:\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\n\u003Cspan\u003Escp \u002Fusr\u002Fbin\u002Fkubectl  root@10.1.1.230:\u002Fusr\u002Fbin\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 删除证书文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E删除kubelet证书和kubeconfig文件：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Erm -f \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.kubeconfig \n\u003Cspan\u003Erm -f \u002Fopt\u002Fkubernetes\u002Fssl\u002Fkubelet*\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. 修改配置文件IP和主机名\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E修改apiserver、kubelet和kube-proxy配置文件为本地IP：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-apiserver.conf \n\u003Cspan\u003E...\n\u003Cspan\u003E--\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ebind\u003C\u002Fspan\u003E-address=10.1.1.230 \\\n\u003Cspan\u003E--advertise-address=10.1.1.230 \\\n\u003Cspan\u003E...\n\u003Cspan\u003E\n\u003Cspan\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.conf\n\u003Cspan\u003E--hostname-override=k8s-master2\n\u003Cspan\u003E\n\u003Cspan\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy-config.yml\n\u003Cspan\u003EhostnameOverride: k8s-master2\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kube-apiserver\n\u003Cspan\u003Esystemctl start kube-controller-manager\n\u003Cspan\u003Esystemctl start kube-scheduler\n\u003Cspan\u003Esystemctl start kubelet\n\u003Cspan\u003Esystemctl start kube-proxy\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-apiserver\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-controller-manager\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-scheduler\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kubelet\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-proxy\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E6. 查看集群状态\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get cs\n\u003Cspan\u003ENAME                 STATUS    MESSAGE             ERROR\n\u003Cspan\u003Escheduler            Healthy   ok                  \n\u003Cspan\u003Econtroller-manager   Healthy   ok                  \n\u003Cspan\u003Eetcd-1               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}   \n\u003Cspan\u003Eetcd-2               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}   \n\u003Cspan\u003Eetcd-0               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E7. 批准kubelet证书申请\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get csr\n\u003Cspan\u003ENAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION\n\u003Cspan\u003Enode-csr-JYNknakEa_YpHz797oKaN-ZTk43nD51Zc9CJkBLcASU   85m   kubernetes.io\u002Fkube-apiserver-client-kubelet   kubelet-bootstrap   Pending\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl certificate approve node-csr-JYNknakEa_YpHz797oKaN-ZTk43nD51Zc9CJkBLcASU\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl get node\n\u003Cspan\u003ENAME          STATUS   ROLES    AGE   VERSION\n\u003Cspan\u003Ek8s-master1    Ready    &lt;none&gt;   34h   v1.18.3\n\u003Cspan\u003Ek8s-master2   Ready    &lt;none&gt;   83m   v1.18.3\n\u003Cspan\u003Ek8s-worker1     Ready    &lt;none&gt;   33h   v1.18.3\n\u003Cspan\u003Ek8s-worker2     Ready    &lt;none&gt;   33h   v1.18.3\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E7.3 部署Nginx负载均衡器\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003Ekube-apiserver高可用架构图：\u003C\u002Fp\u003E\n\u003Cfigure style=\"margin: 0; margin-top: 10px; margin-bottom: 10px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cimg style=\"max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;\" alt=\"\" src=\"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F1730895b392e23da?w=806&amp;h=449&amp;f=png&amp;s=38210\"\u003E\u003C\u002Ffigure\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003ENginx是一个主流Web服务和反向代理服务器，这里用四层实现对apiserver实现负载均衡。\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EKeepalived是一个主流高可用软件，基于VIP绑定实现服务器双机热备，在上述拓扑中，Keepalived主要根据Nginx运行状态判断是否需要故障转移（偏移VIP），例如当Nginx主节点挂掉，VIP会自动绑定在Nginx备节点，从而保证VIP一直可用，实现Nginx高可用。\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 安装软件包（主\u002F备）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Eyum install epel-release -y\n\u003Cspan\u003Eyum install nginx keepalived -y\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. Nginx配置文件（主\u002F备一样）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fetc\u002Fnginx\u002Fnginx.conf &lt;&lt; \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"EOF\"\u003C\u002Fspan\u003E\n\u003Cspan\u003Euser nginx;\n\u003Cspan\u003Eworker_processes auto;\n\u003Cspan\u003Eerror_log \u002Fvar\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\u002Fnginx\u002Ferror.log;\n\u003Cspan\u003Epid \u002Frun\u002Fnginx.pid;\n\u003Cspan\u003E\n\u003Cspan\u003Einclude \u002Fusr\u002Fshare\u002Fnginx\u002Fmodules\u002F*.conf;\n\u003Cspan\u003E\n\u003Cspan\u003Eevents {\n\u003Cspan\u003E    worker_connections 1024;\n\u003Cspan\u003E}\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 四层负载均衡，为两台Master apiserver组件提供负载均衡\u003C\u002Fspan\u003E\n\u003Cspan\u003Estream {\n\u003Cspan\u003E\n\u003Cspan\u003E    log_format  main  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E'$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent'\u003C\u002Fspan\u003E;\n\u003Cspan\u003E\n\u003Cspan\u003E    access_log  \u002Fvar\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\u002Fnginx\u002Fk8s-access.log  main;\n\u003Cspan\u003E\n\u003Cspan\u003E    upstream k8s-apiserver {\n\u003Cspan\u003E       server 10.1.1.204:6443;   \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# Master1 APISERVER IP:PORT\u003C\u002Fspan\u003E\n\u003Cspan\u003E       server 10.1.1.230:6443;   \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# Master2 APISERVER IP:PORT\u003C\u002Fspan\u003E\n\u003Cspan\u003E    }\n\u003Cspan\u003E    \n\u003Cspan\u003E    server {\n\u003Cspan\u003E       listen 6443;\n\u003Cspan\u003E       proxy_pass k8s-apiserver;\n\u003Cspan\u003E    }\n\u003Cspan\u003E}\n\u003Cspan\u003E\n\u003Cspan\u003Ehttp {\n\u003Cspan\u003E    log_format  main  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E'$remote_addr - $remote_user [$time_local] \"$request\" '\u003C\u002Fspan\u003E\n\u003Cspan\u003E                      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E'$status $body_bytes_sent \"$http_referer\" '\u003C\u002Fspan\u003E\n\u003Cspan\u003E                      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E'\"$http_user_agent\" \"$http_x_forwarded_for\"'\u003C\u002Fspan\u003E;\n\u003Cspan\u003E\n\u003Cspan\u003E    access_log  \u002Fvar\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\u002Fnginx\u002Faccess.log  main;\n\u003Cspan\u003E\n\u003Cspan\u003E    sendfile            on;\n\u003Cspan\u003E    tcp_nopush          on;\n\u003Cspan\u003E    tcp_nodelay         on;\n\u003Cspan\u003E    keepalive_timeout   65;\n\u003Cspan\u003E    types_hash_max_size 2048;\n\u003Cspan\u003E\n\u003Cspan\u003E    include             \u002Fetc\u002Fnginx\u002Fmime.types;\n\u003Cspan\u003E    default_type        application\u002Foctet-stream;\n\u003Cspan\u003E\n\u003Cspan\u003E    server {\n\u003Cspan\u003E        listen       80 default_server;\n\u003Cspan\u003E        server_name  _;\n\u003Cspan\u003E\n\u003Cspan\u003E        location \u002F {\n\u003Cspan\u003E        }\n\u003Cspan\u003E    }\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. keepalived配置文件（Nginx Master）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fetc\u002Fkeepalived\u002Fkeepalived.conf &lt;&lt; EOF\n\u003Cspan\u003Eglobal_defs { \n\u003Cspan\u003E   notification_email { \n\u003Cspan\u003E     acassen@firewall.loc \n\u003Cspan\u003E     failover@firewall.loc \n\u003Cspan\u003E     sysadmin@firewall.loc \n\u003Cspan\u003E   } \n\u003Cspan\u003E   notification_email_from Alexandre.Cassen@firewall.loc  \n\u003Cspan\u003E   smtp_server 127.0.0.1 \n\u003Cspan\u003E   smtp_connect_timeout 30 \n\u003Cspan\u003E   router_id NGINX_MASTER\n\u003Cspan\u003E} \n\u003Cspan\u003Evrrp_script check_nginx {\n\u003Cspan\u003E    script \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E}\n\u003Cspan\u003Evrrp_instance VI_1 { \n\u003Cspan\u003E    state MASTER \n\u003Cspan\u003E    interface ens33\n\u003Cspan\u003E    virtual_router_id 51 \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# VRRP 路由 ID实例，每个实例是唯一的 \u003C\u002Fspan\u003E\n\u003Cspan\u003E    priority 100    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 优先级，备服务器设置 90 \u003C\u002Fspan\u003E\n\u003Cspan\u003E    advert_int 1    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 指定VRRP 心跳包通告间隔时间，默认1秒 \u003C\u002Fspan\u003E\n\u003Cspan\u003E    authentication { \n\u003Cspan\u003E        auth_type PASS      \n\u003Cspan\u003E        auth_pass 1111 \n\u003Cspan\u003E    }  \n\u003Cspan\u003E    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 虚拟IP\u003C\u002Fspan\u003E\n\u003Cspan\u003E    virtual_ipaddress { \n\u003Cspan\u003E        10.1.1.170\u002F24\n\u003Cspan\u003E    } \n\u003Cspan\u003E    track_script {\n\u003Cspan\u003E        check_nginx\n\u003Cspan\u003E    } \n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003Evrrp_script：指定检查nginx工作状态脚本（根据nginx状态判断是否故障转移）\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003Evirtual_ipaddress：虚拟IP（VIP）\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E检查nginx状态脚本：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh  &lt;&lt; \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"EOF\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #61aeee; line-height: 26px;\" class=\"hljs-meta\"\u003E#!\u002Fbin\u002Fbash\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecount=$(ps -ef |grep nginx |egrep -cv \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"grep|$\"\u003C\u002Fspan\u003E)\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E [ \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$count\u003C\u002Fspan\u003E\"\u003C\u002Fspan\u003E -eq 0 ];\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Ethen\u003C\u002Fspan\u003E\n\u003Cspan\u003E    \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eexit\u003C\u002Fspan\u003E 1\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E\n\u003Cspan\u003E    \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eexit\u003C\u002Fspan\u003E 0\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Efi\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Echmod +x \u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. keepalived配置文件（Nginx Backup）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fetc\u002Fkeepalived\u002Fkeepalived.conf &lt;&lt; EOF\n\u003Cspan\u003Eglobal_defs { \n\u003Cspan\u003E   notification_email { \n\u003Cspan\u003E     acassen@firewall.loc \n\u003Cspan\u003E     failover@firewall.loc \n\u003Cspan\u003E     sysadmin@firewall.loc \n\u003Cspan\u003E   } \n\u003Cspan\u003E   notification_email_from Alexandre.Cassen@firewall.loc  \n\u003Cspan\u003E   smtp_server 127.0.0.1 \n\u003Cspan\u003E   smtp_connect_timeout 30 \n\u003Cspan\u003E   router_id NGINX_BACKUP\n\u003Cspan\u003E} \n\u003Cspan\u003Evrrp_script check_nginx {\n\u003Cspan\u003E    script \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E}\n\u003Cspan\u003Evrrp_instance VI_1 { \n\u003Cspan\u003E    state BACKUP \n\u003Cspan\u003E    interface ens33\n\u003Cspan\u003E    virtual_router_id 51 \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# VRRP 路由 ID实例，每个实例是唯一的 \u003C\u002Fspan\u003E\n\u003Cspan\u003E    priority 90\n\u003Cspan\u003E    advert_int 1\n\u003Cspan\u003E    authentication { \n\u003Cspan\u003E        auth_type PASS      \n\u003Cspan\u003E        auth_pass 1111 \n\u003Cspan\u003E    }  \n\u003Cspan\u003E    virtual_ipaddress { \n\u003Cspan\u003E        10.1.1.170\u002F24\n\u003Cspan\u003E    } \n\u003Cspan\u003E    track_script {\n\u003Cspan\u003E        check_nginx\n\u003Cspan\u003E    } \n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E上述配置文件中检查nginx运行状态脚本：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh  &lt;&lt; \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"EOF\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #61aeee; line-height: 26px;\" class=\"hljs-meta\"\u003E#!\u002Fbin\u002Fbash\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecount=$(ps -ef |grep nginx |egrep -cv \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"grep|$\"\u003C\u002Fspan\u003E)\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E [ \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$count\u003C\u002Fspan\u003E\"\u003C\u002Fspan\u003E -eq 0 ];\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Ethen\u003C\u002Fspan\u003E\n\u003Cspan\u003E    \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eexit\u003C\u002Fspan\u003E 1\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E\n\u003Cspan\u003E    \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eexit\u003C\u002Fspan\u003E 0\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Efi\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Echmod +x \u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：keepalived根据脚本返回状态码（0为工作正常，非0不正常）判断是否故障转移。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start nginx\n\u003Cspan\u003Esystemctl start keepalived\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E nginx\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E keepalived\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E6. 查看keepalived工作状态\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Eip a\n\u003Cspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E可以看到，在ens33网卡绑定了10.1.1.170虚拟IP，说明工作正常。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E7. Nginx+Keepalived高可用测试\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E关闭主节点Nginx，测试VIP是否漂移到备节点服务器。\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E在Nginx Master执行 pkill nginx\n\u003Cspan\u003E在Nginx Backup，ip addr命令查看已成功绑定VIP。\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E8. 访问负载均衡器测试\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E找K8s集群中任意一个节点，使用curl查看K8s版本测试，使用VIP访问：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecurl -k https:\u002F\u002F10.1.1.170:6443\u002Fversion\n\u003Cspan\u003E{\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"major\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"1\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"minor\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"18\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"gitVersion\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"v1.18.3\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"gitCommit\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"2e7996e3e2712684bc73f0dec0200d64eec7fe40\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"gitTreeState\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"clean\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"buildDate\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"2020-05-20T12:43:34Z\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"goVersion\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"go1.13.9\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"compiler\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"gc\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"platform\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"linux\u002Famd64\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E}\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E可以正确获取到K8s版本信息，说明负载均衡器搭建正常。该请求数据流程：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ecurl -&gt; vip(nginx) -&gt; apiserver\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E通过查看Nginx日志也可以看到转发apiserver IP：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Etail \u002Fvar\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\u002Fnginx\u002Fk8s-access.log -f\n\u003Cspan\u003E10.1.1.170 10.1.1.204:6443 - [30\u002FMay\u002F2020:11:15:10 +0800] 200 422\n\u003Cspan\u003E10.1.1.170 10.1.1.230:6443 - [30\u002FMay\u002F2020:11:15:26 +0800] 200 422\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E到此还没结束，还有下面最关键的一步。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E7.4 修改所有Worker Node连接LB VIP\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E试想下，虽然我们增加了Master2和负载均衡器，但是我们是从单Master架构扩容的，也就是说目前所有的Node组件连接都还是Master1，如果不改为连接VIP走负载均衡器，那么Master还是单点故障。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E因此接下来就是要改所有Worker Node组件配置文件，由原来10.1.1.204修改为10.1.1.170（VIP）：\u003C\u002Fp\u003E\n\u003Ctable style=\"display: table; text-align: left;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cthead\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E角色\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003EIP\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody style=\"border: 0;\"\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-master1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.204\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-master2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.230\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.151\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.186\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esed -i \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E's#10.1.1.204:6443#10.1.1.170:6443#'\u003C\u002Fspan\u003E \u002Fopt\u002Fkubernetes\u002Fcfg\u002F*\n\u003Cspan\u003Esystemctl restart kubelet\n\u003Cspan\u003Esystemctl restart kube-proxy\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E检查节点状态：kubectl get node\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003ENAME          STATUS   ROLES    AGE    VERSION\n\u003Cspan\u003Ek8s-master    Ready    &lt;none&gt;   34h    v1.18.3\n\u003Cspan\u003Ek8s-master2   Ready    &lt;none&gt;   101m   v1.18.3\n\u003Cspan\u003Ek8s-node1     Ready    &lt;none&gt;   33h    v1.18.3\n\u003Cspan\u003Ek8s-node2     Ready    &lt;none&gt;   33h    v1.18.3\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E至此，一套完整的 Kubernetes 高可用集群就部署完成了！\u003C\u002Fp\u003E\u003C\u002Fsection\u003E",ctime:"1593577107",mtime:"1599054630",rtime:"1593596133",draft_id:"6845076845545684999",view_count:784,collect_count:d,digg_count:h,comment_count:h,hot_index:41,is_hot:d,rank_index:.00041381,status:2,verify_status:h,audit_status:2,mark_content:e},author_user_info:{user_id:"1503787639375096",user_name:"iuskye",company:e,job_title:"运维开发工程师",avatar_large:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F173088b467209a0b?w=807&h=1024&f=jpeg&s=130639",level:h,description:e,followee_count:6,follower_count:3,post_article_count:3,digg_article_count:d,got_digg_count:h,got_view_count:852,post_shortmsg_count:d,digg_shortmsg_count:d,isfollowed:a,favorable_author:d,power:9},category:{category_id:"6809637772874219534",category_name:"阅读",category_url:"article",rank:8,ctime:1457483895,mtime:1432503208,show_type:3,id:"6809637772874219534",name:"阅读",title:"阅读",alias:"article"},tags:[{entriesCount:void 0,subscribed:a,id:"6809640675944955918",tag_id:"6809640675944955918",tag_name:"Kubernetes",color:"#000000",icon:"https:\u002F\u002Flc-gold-cdn.xitu.io\u002Ff3388aa0b59e4d864cc2.png",back_ground:e,show_navi:d,tag_alias:e,post_article_count:2195,concern_user_count:15549,title:"Kubernetes",tagId:"6809640675944955918",articleCount:2195,subscribersCount:15549,createdAt:b,updatedAt:b}],user_interact:{id:6844904205556122000,omitempty:2,user_id:d,is_digg:a,is_follow:a,is_collect:a},title:"Kubernetes高可用集群二进制安装",user:{id:"1503787639375096",self_description:void 0,followed:a,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:d,wroteBookCount:d,boughtBookCount:d,isBindedPhone:a,level:h,user_id:"1503787639375096",user_name:"iuskye",company:e,job_title:"运维开发工程师",avatar_large:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F173088b467209a0b?w=807&h=1024&f=jpeg&s=130639",description:e,followee_count:6,follower_count:3,post_article_count:3,digg_article_count:d,got_digg_count:h,got_view_count:852,post_shortmsg_count:d,digg_shortmsg_count:d,isfollowed:a,favorable_author:d,power:9,juejinPower:9,jobTitle:"运维开发工程师",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"iuskye",blogAddress:void 0,selfDescription:e,beLikedCount:h,beReadCount:852,followerCount:3,followingCount:6,collectionCount:d,createdCollectionCount:d,followingCollectionCount:d,postedPostsCount:3,pinCount:d,likedArticleCount:d,likedPinCount:d,avatar:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F173088b467209a0b?w=807&h=1024&f=jpeg&s=130639",latestLoginedInAt:b,createdAt:b,updatedAt:b,phoneNumber:e,titleDescription:e,followeesCount:6},viewCount:void 0,commentsCount:h,isEvent:void 0,abstract:"1. 前置知识点 Kubeadm是一个K8s部署工具，提供kubeadm init和kubeadm join，用于快速部署Kubernetes集群。官方地址：https:\u002F\u002Fkubernetes.io\u002Fdocs\u002Freference\u002Fsetup-tools\u002Fkubeadm\u002Fkub…",latestCommentAt:b,createdAt:new Date(1593577107000),updatedAt:b,isTopicEvent:a,likedCount:h,likeCount:h,content:"\u003Csection style=\"font-size: 16px; color: black; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; margin-top: -10px; font-family: PingFangSC-Light;\" data-website=\"https:\u002F\u002Fwww.mdnice.com\" data-tool=\"mdnice编辑器\" id=\"nice\"\u003E\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E1. 前置知识点\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E1.1 生产环境可部署Kubernetes集群的两种方式\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E目前生产部署Kubernetes集群主要有两种方式：\u003C\u002Fp\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EKubeadm\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: square;\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EKubeadm是一个K8s部署工具，提供kubeadm init和kubeadm join，用于快速部署Kubernetes集群。官方地址：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fkubernetes.io\u002Fdocs\u002Freference\u002Fsetup-tools\u002Fkubeadm\u002Fkubeadm\u002F\u003C\u002Fcode\u003E。\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E二进制包\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: square;\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E从github下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群。Kubeadm降低部署门槛，但屏蔽了很多细节，遇到问题很难排查。如果想更容易可控，推荐使用二进制包部署Kubernetes集群，虽然手动部署麻烦点，期间可以学习很多工作原理，也利于后期维护。\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E1.2 安装要求\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E在开始之前，部署Kubernetes集群机器需要满足以下几个条件：\u003C\u002Fp\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E一台或多台机器，操作系统 CentOS7.x-86_x64\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E硬件配置：2GB或更多RAM，2个CPU或更多CPU，硬盘30GB或更多\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E可以访问外网，需要拉取镜像，如果服务器不能上网，需要提前下载镜像并导入节点\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E禁止swap分区\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E1.3 准备环境\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E软件环境：\u003C\u002Fp\u003E\n\u003Ctable style=\"display: table; text-align: left;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cthead\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E软件\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E版本\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody style=\"border: 0;\"\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E操作系统\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003ECentOS7.6_x64(mini)\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003EDocker\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E19-ce\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003EKubernetes\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E1.18\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E服务器规划：\u003C\u002Fp\u003E\n\u003Ctable style=\"display: table; text-align: left;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cthead\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E角色\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003EIP\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E组件\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody style=\"border: 0;\"\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-master1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.204\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekube-apiserver, kube-controller-manager, kube-scheduler, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-master2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.230\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekube-apiserver, kube-controller-manager, kube-scheduler, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.151\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekubelet, kube-proxy, docker, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.186\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekubelet, kube-proxy, docker, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-lb1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.220, 10.1.1.170(VIP)\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003ENginx L4\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-lb2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.169\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003ENginx L4\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E须知：考虑到有些朋友电脑配置较低，这么多虚拟机跑不动，所以这一套高可用集群分两部分实施，先部署一套单Master架构（10.1.1.204\u002F151\u002F186），再扩容为多Master架构（上述规划），顺便熟悉下Master扩容流程。\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E单Master架构图：\u003C\u002Fp\u003E\n\u003Cfigure style=\"margin: 0; margin-top: 10px; margin-bottom: 10px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cimg style=\"max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;\" alt=\"\" src=\"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F1730895b367d0ea1?w=1559&amp;h=1133&amp;f=png&amp;s=75776\"\u003E\u003C\u002Ffigure\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E单Master服务器规划：\u003C\u002Fp\u003E\n\u003Ctable style=\"display: table; text-align: left;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cthead\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E角色\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003EIP\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E组件\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody style=\"border: 0;\"\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-master1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.204\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekube-apiserver, kube-controller-manager, kube-scheduler, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.151\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekubelet, kube-proxy, docker, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.186\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ekubelet, kube-proxy, docker, etcd\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E1.4 操作系统初始化配置\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 关闭防火墙\u003C\u002Fspan\u003E\n\u003Cspan\u003Esystemctl stop firewalld\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Edisable\u003C\u002Fspan\u003E firewalld\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 关闭selinux\u003C\u002Fspan\u003E\n\u003Cspan\u003Esed -i \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E's\u002Fenforcing\u002Fdisabled\u002F'\u003C\u002Fspan\u003E \u002Fetc\u002Fselinux\u002Fconfig  \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 永久\u003C\u002Fspan\u003E\n\u003Cspan\u003Esetenforce 0  \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 临时\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 关闭swap\u003C\u002Fspan\u003E\n\u003Cspan\u003Eswapoff -a  \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 临时\u003C\u002Fspan\u003E\n\u003Cspan\u003Esed -ri \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E's\u002F.*swap.*\u002F#&amp;\u002F'\u003C\u002Fspan\u003E \u002Fetc\u002Ffstab    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 永久\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 根据规划设置主机名\u003C\u002Fspan\u003E\n\u003Cspan\u003Ehostnamectl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-hostname &lt;hostname&gt;\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 在所有主机添加hosts\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecat &gt;&gt; \u002Fetc\u002Fhosts &lt;&lt; EOF\n\u003Cspan\u003E10.1.1.204 k8s-master1\n\u003Cspan\u003E10.1.1.230 k8s-master2\n\u003Cspan\u003E10.1.1.151 k8s-worker1\n\u003Cspan\u003E10.1.1.186 k8s-worker2\n\u003Cspan\u003E10.1.1.220 k8s-lb1\n\u003Cspan\u003E10.1.1.169 k8s-lb2\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 将桥接的IPv4流量传递到iptables的链\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecat &gt; \u002Fetc\u002Fsysctl.d\u002Fk8s.conf &lt;&lt; EOF\n\u003Cspan\u003Enet.bridge.bridge-nf-call-ip6tables = 1\n\u003Cspan\u003Enet.bridge.bridge-nf-call-iptables = 1\n\u003Cspan\u003EEOF\n\u003Cspan\u003Esysctl --system  \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 生效\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 时间同步\u003C\u002Fspan\u003E\n\u003Cspan\u003Eyum install ntpdate -y\n\u003Cspan\u003Entpdate time.windows.com\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E2. 部署Etcd集群\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EEtcd 是一个分布式键值存储系统，Kubernetes使用Etcd进行数据存储，所以先准备一个Etcd数据库，为解决Etcd单点故障，应采用集群方式部署，这里使用3台组建集群，可容忍1台机器故障，当然，你也可以使用5台组建集群，可容忍2台机器故障。\u003C\u002Fp\u003E\n\u003Ctable style=\"display: table; text-align: left;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cthead\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E节点名称\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003EIP\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody style=\"border: 0;\"\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Eetcd1(k8s-master1)\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.204\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Eetcd2(k8s-worker1)\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.151\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Eetcd3(k8s-worker2)\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.186\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：为了节省机器，这里与K8s节点机器复用。也可以独立于k8s集群之外部署，只要apiserver能连接到就行。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E2.1 准备cfssl证书生成工具\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003Ecfssl是一个开源的证书管理工具，使用json文件生成证书，相比openssl更方便使用。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E找任意一台服务器操作，这里用Master节点。\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ewget https:\u002F\u002Fpkg.cfssl.org\u002FR1.2\u002Fcfssl_linux-amd64\n\u003Cspan\u003Ewget https:\u002F\u002Fpkg.cfssl.org\u002FR1.2\u002Fcfssljson_linux-amd64\n\u003Cspan\u003Ewget https:\u002F\u002Fpkg.cfssl.org\u002FR1.2\u002Fcfssl-certinfo_linux-amd64\n\u003Cspan\u003Echmod +x cfssl_linux-amd64 cfssljson_linux-amd64 cfssl-certinfo_linux-amd64\n\u003Cspan\u003Emv cfssl_linux-amd64 \u002Fusr\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elocal\u003C\u002Fspan\u003E\u002Fbin\u002Fcfssl\n\u003Cspan\u003Emv cfssljson_linux-amd64 \u002Fusr\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elocal\u003C\u002Fspan\u003E\u002Fbin\u002Fcfssljson\n\u003Cspan\u003Emv cfssl-certinfo_linux-amd64 \u002Fusr\u002Fbin\u002Fcfssl-certinfo\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E2.2 生成Etcd证书\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 自签证书颁发机构（CA）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E创建工作目录：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir -p ~\u002FTLS\u002F{etcd,k8s}\n\u003Cspan\u003E\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E ~\u002FTLS\u002Fetcd\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E自签CA：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; ca-config.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"signing\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"default\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"expiry\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"87600h\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"profiles\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"www\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E         \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"expiry\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"87600h\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E         \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"usages\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"signing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key encipherment\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"server auth\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"client auth\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        ]\n\u003Cspan\u003E      }\n\u003Cspan\u003E    }\n\u003Cspan\u003E  }\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\n\u003Cspan\u003Ecat &gt; ca-csr.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd CA\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"algo\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"rsa\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"size\"\u003C\u002Fspan\u003E: 2048\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"names\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E        {\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"C\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"L\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"Beijing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"ST\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"Beijing\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        }\n\u003Cspan\u003E    ]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成证书：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecfssl gencert -initca ca-csr.json | cfssljson -bare ca -\n\u003Cspan\u003Els *pem\n\u003Cspan\u003Eca-key.pem  ca.pem\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 使用自签CA签发Etcd HTTPS证书\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E创建证书申请文件：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; server-csr.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"hosts\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.204\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.151\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.186\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    ],\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"algo\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"rsa\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"size\"\u003C\u002Fspan\u003E: 2048\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"names\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E        {\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"C\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"L\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"ST\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        }\n\u003Cspan\u003E    ]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：上述文件hosts字段中IP为所有etcd节点的集群内部通信IP，一个都不能少！为了方便后期扩容可以多写几个预留的IP。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成证书：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=www server-csr.json | cfssljson -bare server\n\u003Cspan\u003E\n\u003Cspan\u003Els server*pem\n\u003Cspan\u003Eserver-key.pem  server.pem\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E2.3 从GitHub上下载二进制文件\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E下载地址：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fetcd-io\u002Fetcd\u002Freleases\u002Fdownload\u002Fv3.4.9\u002Fetcd-v3.4.9-linux-amd64.tar.gz\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E2.4 部署Etcd集群\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E以下在节点1上操作，为简化操作，待会将节点1生成的所有文件拷贝到节点2和节点3。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建工作目录并解压二进制包\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir \u002Fopt\u002Fetcd\u002F{bin,cfg,ssl} -p\n\u003Cspan\u003Etar zxvf etcd-v3.4.9-linux-amd64.tar.gz\n\u003Cspan\u003Emv etcd-v3.4.9-linux-amd64\u002F{etcd,etcdctl} \u002Fopt\u002Fetcd\u002Fbin\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 创建etcd配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fetcd\u002Fcfg\u002Fetcd.conf &lt;&lt; EOF\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E#[Member]\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_NAME=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-1\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_DATA_DIR=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u002Fvar\u002Flib\u002Fetcd\u002Fdefault.etcd\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_LISTEN_PEER_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:2380\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_LISTEN_CLIENT_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:2379\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E#[Clustering]\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_ADVERTISE_PEER_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:2380\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_ADVERTISE_CLIENT_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:2379\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-1=https:\u002F\u002F10.1.1.204:2380,etcd-2=https:\u002F\u002F10.1.1.151:2380,etcd-3=https:\u002F\u002F10.1.1.186:2380\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER_TOKEN=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-cluster\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER_STATE=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"new\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_NAME：节点名称，集群中唯一\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_DATA_DIR：数据目录\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_LISTEN_PEER_URLS：集群通信监听地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_LISTEN_CLIENT_URLS：客户端访问监听地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_INITIAL_ADVERTISE_PEER_URLS：集群通告地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_ADVERTISE_CLIENT_URLS：客户端通告地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_INITIAL_CLUSTER：集群节点地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_INITIAL_CLUSTER_TOKEN：集群Token\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EETCD_INITIAL_CLUSTER_STATE：加入集群的当前状态，new是新集群，existing表示加入已有集群\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. systemd管理etcd集群\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fetcd.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Etcd Server\n\u003Cspan\u003EAfter=network.target\n\u003Cspan\u003EAfter=network-online.target\n\u003Cspan\u003EWants=network-online.target\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EType=notify\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fetcd\u002Fcfg\u002Fetcd.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fetcd\u002Fbin\u002Fetcd \\\n\u003Cspan\u003E--cert-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver.pem \\\n\u003Cspan\u003E--key-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver-key.pem \\\n\u003Cspan\u003E--peer-cert-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver.pem \\\n\u003Cspan\u003E--peer-key-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver-key.pem \\\n\u003Cspan\u003E--trusted-ca-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fca.pem \\\n\u003Cspan\u003E--peer-trusted-ca-file=\u002Fopt\u002Fetcd\u002Fssl\u002Fca.pem \\\n\u003Cspan\u003E--logger=zap\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003ELimitNOFILE=65536\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. 拷贝刚才生成的证书\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E把刚才生成的证书拷贝到配置文件中的路径：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecp ~\u002FTLS\u002Fetcd\u002Fca*pem ~\u002FTLS\u002Fetcd\u002Fserver*pem \u002Fopt\u002Fetcd\u002Fssl\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动并设置开机自启\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start etcd\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E etcd\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E6. 将上面节点1所有生成的文件拷贝到节点2和节点3\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Escp -r \u002Fopt\u002Fetcd\u002F root@10.1.1.151:\u002Fopt\u002F\n\u003Cspan\u003Escp \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fetcd.service root@10.1.1.151:\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002F\n\u003Cspan\u003Escp -r \u002Fopt\u002Fetcd\u002F root@10.1.1.186:\u002Fopt\u002F\n\u003Cspan\u003Escp \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fetcd.service root@10.1.1.186:\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E然后在节点2和节点3分别修改etcd.conf配置文件中的节点名称和当前服务器IP：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Evi \u002Fopt\u002Fetcd\u002Fcfg\u002Fetcd.conf\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E#[Member]\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_NAME=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-1\"\u003C\u002Fspan\u003E   \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 修改此处，节点2改为etcd-2，节点3改为etcd-3\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_DATA_DIR=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u002Fvar\u002Flib\u002Fetcd\u002Fdefault.etcd\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_LISTEN_PEER_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F192.168.31.71:2380\"\u003C\u002Fspan\u003E   \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 修改此处为当前服务器IP\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_LISTEN_CLIENT_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F192.168.31.71:2379\"\u003C\u002Fspan\u003E \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 修改此处为当前服务器IP\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E#[Clustering]\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_ADVERTISE_PEER_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F192.168.31.71:2380\"\u003C\u002Fspan\u003E \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 修改此处为当前服务器IP\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_ADVERTISE_CLIENT_URLS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F192.168.31.71:2379\"\u003C\u002Fspan\u003E \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 修改此处为当前服务器IP\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-1=https:\u002F\u002F192.168.31.71:2380,etcd-2=https:\u002F\u002F192.168.31.72:2380,etcd-3=https:\u002F\u002F192.168.31.73:2380\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER_TOKEN=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"etcd-cluster\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EETCD_INITIAL_CLUSTER_STATE=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"new\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E最后启动etcd并设置开机启动，同上。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E7. 查看集群状态\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003EETCDCTL_API=3 \u002Fopt\u002Fetcd\u002Fbin\u002Fetcdctl --cacert=\u002Fopt\u002Fetcd\u002Fssl\u002Fca.pem --cert=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver.pem --key=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver-key.pem --endpoints=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:2379,https:\u002F\u002F10.1.1.151:2379,https:\u002F\u002F10.1.1.186:2379\"\u003C\u002Fspan\u003E endpoint health\n\u003Cspan\u003E\n\u003Cspan\u003Ehttps:\u002F\u002F10.1.1.204:2379 is healthy: successfully committed proposal: took = 12.415974ms\n\u003Cspan\u003Ehttps:\u002F\u002F10.1.1.151:2379 is healthy: successfully committed proposal: took = 14.409434ms\n\u003Cspan\u003Ehttps:\u002F\u002F10.1.1.186:2379 is healthy: successfully committed proposal: took = 14.447958ms\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E如果输出上面信息，就说明集群部署成功。如果有问题第一步先看日志：\u002Fvar\u002Flog\u002Fmessage 或 journalctl -u etcd\u003C\u002Fp\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E3. 安装Docker\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E下载地址：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fdownload.docker.com\u002Flinux\u002Fstatic\u002Fstable\u002Fx86_64\u002Fdocker-19.03.9.tgz\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E以下在所有节点操作。这里采用二进制安装，用yum安装也一样。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E3.1 解压二进制包\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Etar zxf docker-19.03.9.tgz\n\u003Cspan\u003Emv docker\u002F* \u002Fusr\u002Fbin\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E3.2 systemd管理docker\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fdocker.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Docker Application Container Engine\n\u003Cspan\u003EDocumentation=https:\u002F\u002Fdocs.docker.com\n\u003Cspan\u003EAfter=network-online.target firewalld.service\n\u003Cspan\u003EWants=network-online.target\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EType=notify\n\u003Cspan\u003EExecStart=\u002Fusr\u002Fbin\u002Fdockerd\n\u003Cspan\u003EExecReload=\u002Fbin\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ekill\u003C\u002Fspan\u003E -s HUP \u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$MAINPID\u003C\u002Fspan\u003E\n\u003Cspan\u003ELimitNOFILE=infinity\n\u003Cspan\u003ELimitNPROC=infinity\n\u003Cspan\u003ELimitCORE=infinity\n\u003Cspan\u003ETimeoutStartSec=0\n\u003Cspan\u003EDelegate=yes\n\u003Cspan\u003EKillMode=process\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003EStartLimitBurst=3\n\u003Cspan\u003EStartLimitInterval=60s\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E3.3 创建配置文件\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir \u002Fetc\u002Fdocker\n\u003Cspan\u003Ecat &gt; \u002Fetc\u002Fdocker\u002Fdaemon.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"registry-mirrors\"\u003C\u002Fspan\u003E: [\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002Fb9pmyelo.mirror.aliyuncs.com\"\u003C\u002Fspan\u003E]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003Eregistry-mirrors 阿里云镜像加速器\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E3.4 启动并设置开机启动\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start docker\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E docker\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E4. 部署Master Node\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.1 生成kube-apiserver证书\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 自签证书颁发机构（CA）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E ~\u002FTLS\u002Fk8s\u002F\n\u003Cspan\u003E\n\u003Cspan\u003Ecat &gt; ca-config.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"signing\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"default\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"expiry\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"87600h\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"profiles\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E         \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"expiry\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"87600h\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E         \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"usages\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"signing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key encipherment\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"server auth\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"client auth\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        ]\n\u003Cspan\u003E      }\n\u003Cspan\u003E    }\n\u003Cspan\u003E  }\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\n\u003Cspan\u003Ecat &gt; ca-csr.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"algo\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"rsa\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"size\"\u003C\u002Fspan\u003E: 2048\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"names\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E        {\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"C\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"L\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"Beijing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"ST\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"Beijing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"O\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"k8s\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"OU\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"System\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        }\n\u003Cspan\u003E    ]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成证书：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecfssl gencert -initca ca-csr.json | cfssljson -bare ca -\n\u003Cspan\u003E\n\u003Cspan\u003Els *pem\n\u003Cspan\u003Eca-key.pem  ca.pem\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 使用自签CA签发kube-apiserver HTTPS证书\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E创建证书申请文件：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; server-csr.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"hosts\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.0.0.1\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"127.0.0.1\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.204\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.230\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.151\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.186\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.220\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.169\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"10.1.1.170\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes.default\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes.default.svc\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes.default.svc.cluster\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubernetes.default.svc.cluster.local\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    ],\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"algo\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"rsa\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E        \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"size\"\u003C\u002Fspan\u003E: 2048\n\u003Cspan\u003E    },\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"names\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E        {\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"C\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"L\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"ST\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"O\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"k8s\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E            \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"OU\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"System\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E        }\n\u003Cspan\u003E    ]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：上述文件hosts字段中IP为所有Master\u002FLB\u002FVIP IP，一个都不能少！为了方便后期扩容可以多写几个预留的IP。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成证书：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes server-csr.json | cfssljson -bare server\n\u003Cspan\u003E\n\u003Cspan\u003Els server*pem\n\u003Cspan\u003Eserver-key.pem  server.pem\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.2 从GitHub下载二进制文件\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E下载地址\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fkubernetes\u002Fkubernetes\u002Fblob\u002Fmaster\u002FCHANGELOG\u002FCHANGELOG-1.18.md#v1183\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：打开链接你会发现里面有很多包，下载一个server包就够了，包含了Master和Worker Node二进制文件。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E例如：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fdl.k8s.io\u002Fv1.18.3\u002Fkubernetes-server-linux-amd64.tar.gz\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.3 解压二进制包\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir -p \u002Fopt\u002Fkubernetes\u002F{bin,cfg,ssl,logs} \n\u003Cspan\u003Etar zxf kubernetes-server-linux-amd64.tar.gz\n\u003Cspan\u003E\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E kubernetes\u002Fserver\u002Fbin\n\u003Cspan\u003Ecp kube-apiserver kube-scheduler kube-controller-manager \u002Fopt\u002Fkubernetes\u002Fbin\n\u003Cspan\u003Ecp kubectl \u002Fusr\u002Fbin\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.4 部署kube-apiserver\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-apiserver.conf &lt;&lt; EOF\n\u003Cspan\u003EKUBE_APISERVER_OPTS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"--logtostderr=false \\\\\n\u003Cspan\u003E--v=2 \\\\\n\u003Cspan\u003E--log-dir=\u002Fopt\u002Fkubernetes\u002Flogs \\\\\n\u003Cspan\u003E--etcd-servers=https:\u002F\u002F10.1.1.204:2379,https:\u002F\u002F10.1.1.151:2379,https:\u002F\u002F10.1.1.186:2379 \\\\\n\u003Cspan\u003E--bind-address=10.1.1.204 \\\\\n\u003Cspan\u003E--secure-port=6443 \\\\\n\u003Cspan\u003E--advertise-address=10.1.1.204 \\\\\n\u003Cspan\u003E--allow-privileged=true \\\\\n\u003Cspan\u003E--service-cluster-ip-range=10.0.0.0\u002F24 \\\\\n\u003Cspan\u003E--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\\\\n\u003Cspan\u003E--authorization-mode=RBAC,Node \\\\\n\u003Cspan\u003E--enable-bootstrap-token-auth=true \\\\\n\u003Cspan\u003E--token-auth-file=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Ftoken.csv \\\\\n\u003Cspan\u003E--service-node-port-range=30000-32767 \\\\\n\u003Cspan\u003E--kubelet-client-certificate=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fserver.pem \\\\\n\u003Cspan\u003E--kubelet-client-key=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fserver-key.pem \\\\\n\u003Cspan\u003E--tls-cert-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fserver.pem  \\\\\n\u003Cspan\u003E--tls-private-key-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fserver-key.pem \\\\\n\u003Cspan\u003E--client-ca-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \\\\\n\u003Cspan\u003E--service-account-key-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca-key.pem \\\\\n\u003Cspan\u003E--etcd-cafile=\u002Fopt\u002Fetcd\u002Fssl\u002Fca.pem \\\\\n\u003Cspan\u003E--etcd-certfile=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver.pem \\\\\n\u003Cspan\u003E--etcd-keyfile=\u002Fopt\u002Fetcd\u002Fssl\u002Fserver-key.pem \\\\\n\u003Cspan\u003E--audit-log-maxage=30 \\\\\n\u003Cspan\u003E--audit-log-maxbackup=3 \\\\\n\u003Cspan\u003E--audit-log-maxsize=100 \\\\\n\u003Cspan\u003E--audit-log-path=\u002Fopt\u002Fkubernetes\u002Flogs\u002Fk8s-audit.log\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：上面两个\\ \\ 第一个是转义符，第二个是换行符，使用转义符是为了使用EOF保留换行符。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--logtostderr：启用日志\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--v：日志等级\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--log-dir：日志目录\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--etcd-servers：etcd集群地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--bind-address：监听地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--secure-port：https安全端口\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--advertise-address：集群通告地址\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--allow-privileged：启用授权\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--service-cluster-ip-range：Service虚拟IP地址段\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--enable-admission-plugins：准入控制模块\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--authorization-mode：认证授权，启用RBAC授权和节点自管理\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--enable-bootstrap-token-auth：启用TLS bootstrap机制\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--token-auth-file：bootstrap token文件\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--service-node-port-range：Service nodeport类型默认分配端口范围\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--kubelet-client-xxx：apiserver访问kubelet客户端证书\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--tls-xxx-file：apiserver https证书\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--etcd-xxxfile：连接Etcd集群证书\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--audit-log-xxx：审计日志\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 拷贝刚才生成的证书\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E把刚才生成的证书拷贝到配置文件中的路径：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecp ~\u002FTLS\u002Fk8s\u002Fca*pem ~\u002FTLS\u002Fk8s\u002Fserver*pem \u002Fopt\u002Fkubernetes\u002Fssl\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 启用 TLS Bootstrapping 机制\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003ETLS Bootstraping：Master apiserver启用TLS认证后，Node节点kubelet和kube-proxy要与kube-apiserver进行通信，必须使用CA签发的有效证书才可以，当Node节点很多时，这种客户端证书颁发需要大量工作，同样也会增加集群扩展复杂度。为了简化流程，Kubernetes引入了TLS bootstraping机制来自动颁发客户端证书，kubelet会以一个低权限用户自动向apiserver申请证书，kubelet的证书由apiserver动态签署。所以强烈建议在Node上使用这种方式，目前主要用于kubelet，kube-proxy还是由我们统一颁发一个证书。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003ETLS bootstraping 工作流程：\u003C\u002Fp\u003E\n\u003Cfigure style=\"margin: 0; margin-top: 10px; margin-bottom: 10px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cimg style=\"max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;\" alt=\"\" src=\"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F1730895b37203331?w=779&amp;h=677&amp;f=png&amp;s=36862\"\u003E\u003C\u002Ffigure\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E创建上述配置文件中token文件：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Ftoken.csv &lt;&lt; EOF\n\u003Cspan\u003E8054b7219e601b121e8d2b4f73d255ad,kubelet-bootstrap,10001,\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"system:node-bootstrapper\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E格式：token，用户名，UID，用户组\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003Etoken也可自行生成替换：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ehead -c 16 \u002Fdev\u002Furandom | od -An -t x | tr -d \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E' '\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. systemd管理apiserver\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkube-apiserver.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Kubernetes API Server\n\u003Cspan\u003EDocumentation=https:\u002F\u002Fgithub.com\u002Fkubernetes\u002Fkubernetes\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-apiserver.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fkubernetes\u002Fbin\u002Fkube-apiserver \\\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$KUBE_APISERVER_OPTS\u003C\u002Fspan\u003E\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kube-apiserver\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-apiserver\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E6. 授权kubelet-bootstrap用户允许请求证书\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl create clusterrolebinding kubelet-bootstrap \\\n\u003Cspan\u003E--clusterrole=system:node-bootstrapper \\\n\u003Cspan\u003E--user=kubelet-bootstrap\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.5 部署kube-controller-manager\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-controller-manager.conf &lt;&lt; EOF\n\u003Cspan\u003EKUBE_CONTROLLER_MANAGER_OPTS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"--logtostderr=false \\\\\n\u003Cspan\u003E--v=2 \\\\\n\u003Cspan\u003E--log-dir=\u002Fopt\u002Fkubernetes\u002Flogs \\\\\n\u003Cspan\u003E--leader-elect=true \\\\\n\u003Cspan\u003E--master=127.0.0.1:8080 \\\\\n\u003Cspan\u003E--bind-address=127.0.0.1 \\\\\n\u003Cspan\u003E--allocate-node-cidrs=true \\\\\n\u003Cspan\u003E--cluster-cidr=10.244.0.0\u002F16 \\\\\n\u003Cspan\u003E--service-cluster-ip-range=10.0.0.0\u002F24 \\\\\n\u003Cspan\u003E--cluster-signing-cert-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \\\\\n\u003Cspan\u003E--cluster-signing-key-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca-key.pem  \\\\\n\u003Cspan\u003E--root-ca-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \\\\\n\u003Cspan\u003E--service-account-private-key-file=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca-key.pem \\\\\n\u003Cspan\u003E--experimental-cluster-signing-duration=87600h0m0s\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--master：通过本地非安全本地端口8080连接apiserver\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--leader-elect：当该组件启动多个时，自动选举（HA）\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--cluster-signing-cert-file\u002F–cluster-signing-key-file：自动为kubelet颁发证书的CA，与apiserver保持一致\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. systemd管理controller-manager\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkube-controller-manager.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Kubernetes Controller Manager\n\u003Cspan\u003EDocumentation=https:\u002F\u002Fgithub.com\u002Fkubernetes\u002Fkubernetes\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-controller-manager.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fkubernetes\u002Fbin\u002Fkube-controller-manager \\\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$KUBE_CONTROLLER_MANAGER_OPTS\u003C\u002Fspan\u003E\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kube-controller-manager\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-controller-manager\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E4.6 部署kube-scheduler\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-scheduler.conf &lt;&lt; EOF\n\u003Cspan\u003EKUBE_SCHEDULER_OPTS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"--logtostderr=false \\\n\u003Cspan\u003E--v=2 \\\n\u003Cspan\u003E--log-dir=\u002Fopt\u002Fkubernetes\u002Flogs \\\n\u003Cspan\u003E--leader-elect \\\n\u003Cspan\u003E--master=127.0.0.1:8080 \\\n\u003Cspan\u003E--bind-address=127.0.0.1\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--master：通过本地非安全本地端口8080连接apiserver\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E--leader-elect：当该组件启动多个时，自动选举（HA）\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. systemd管理scheduler\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkube-scheduler.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Kubernetes Scheduler\n\u003Cspan\u003EDocumentation=https:\u002F\u002Fgithub.com\u002Fkubernetes\u002Fkubernetes\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-scheduler.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fkubernetes\u002Fbin\u002Fkube-scheduler \\\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$KUBE_SCHEDULER_OPTS\u003C\u002Fspan\u003E\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kube-scheduler\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-scheduler\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. 查看集群状态\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E所有组件都已经启动成功，通过kubectl工具查看当前集群组件状态：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get cs\n\u003Cspan\u003E\n\u003Cspan\u003ENAME                 STATUS    MESSAGE             ERROR\n\u003Cspan\u003Escheduler            Healthy   ok                  \n\u003Cspan\u003Econtroller-manager   Healthy   ok                  \n\u003Cspan\u003Eetcd-0               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}   \n\u003Cspan\u003Eetcd-2               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}   \n\u003Cspan\u003Eetcd-1               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E如上输出说明Master节点组件运行正常。\u003C\u002Fp\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E5. 部署Worker Node\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E下面还是在Master Node上操作，即同时作为Worker Node。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.1 创建工作目录并拷贝二进制文件\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E在所有worker node创建工作目录：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir -p \u002Fopt\u002Fkubernetes\u002F{bin,cfg,ssl,logs}\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E从master节点拷贝：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E ~\u002Fkubernetes\u002Fserver\u002Fbin\n\u003Cspan\u003Ecp kubelet kube-proxy \u002Fopt\u002Fkubernetes\u002Fbin   \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 本地拷贝\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.2 部署kubelet\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.conf &lt;&lt; EOF\n\u003Cspan\u003EKUBELET_OPTS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"--logtostderr=false \\\\\n\u003Cspan\u003E--v=2 \\\\\n\u003Cspan\u003E--log-dir=\u002Fopt\u002Fkubernetes\u002Flogs \\\\\n\u003Cspan\u003E--hostname-override=k8s-master1 \\\\\n\u003Cspan\u003E--network-plugin=cni \\\\\n\u003Cspan\u003E--kubeconfig=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.kubeconfig \\\\\n\u003Cspan\u003E--bootstrap-kubeconfig=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fbootstrap.kubeconfig \\\\\n\u003Cspan\u003E--config=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet-config.yml \\\\\n\u003Cspan\u003E--cert-dir=\u002Fopt\u002Fkubernetes\u002Fssl \\\\\n\u003Cspan\u003E--pod-infra-container-image=lizhenliang\u002Fpause-amd64:3.0\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–hostname-override：显示名称，集群中唯一\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–network-plugin：启用CNI\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–kubeconfig：空路径，会自动生成，后面用于连接apiserver\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–bootstrap-kubeconfig：首次启动向apiserver申请证书\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–config：配置参数文件\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–cert-dir：kubelet证书生成目录\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003E–pod-infra-container-image：管理Pod网络容器的镜像\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 配置参数文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet-config.yml &lt;&lt; EOF\n\u003Cspan\u003Ekind: KubeletConfiguration\n\u003Cspan\u003EapiVersion: kubelet.config.k8s.io\u002Fv1beta1\n\u003Cspan\u003Eaddress: 0.0.0.0\n\u003Cspan\u003Eport: 10250\n\u003Cspan\u003EreadOnlyPort: 10255\n\u003Cspan\u003EcgroupDriver: cgroupfs\n\u003Cspan\u003EclusterDNS:\n\u003Cspan\u003E- 10.0.0.2\n\u003Cspan\u003EclusterDomain: cluster.local \n\u003Cspan\u003EfailSwapOn: \u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Efalse\u003C\u002Fspan\u003E\n\u003Cspan\u003Eauthentication:\n\u003Cspan\u003E  anonymous:\n\u003Cspan\u003E    enabled: \u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Efalse\u003C\u002Fspan\u003E\n\u003Cspan\u003E  webhook:\n\u003Cspan\u003E    cacheTTL: 2m0s\n\u003Cspan\u003E    enabled: \u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n\u003Cspan\u003E  x509:\n\u003Cspan\u003E    clientCAFile: \u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \n\u003Cspan\u003Eauthorization:\n\u003Cspan\u003E  mode: Webhook\n\u003Cspan\u003E  webhook:\n\u003Cspan\u003E    cacheAuthorizedTTL: 5m0s\n\u003Cspan\u003E    cacheUnauthorizedTTL: 30s\n\u003Cspan\u003EevictionHard:\n\u003Cspan\u003E  imagefs.available: 15%\n\u003Cspan\u003E  memory.available: 100Mi\n\u003Cspan\u003E  nodefs.available: 10%\n\u003Cspan\u003E  nodefs.inodesFree: 5%\n\u003Cspan\u003EmaxOpenFiles: 1000000\n\u003Cspan\u003EmaxPods: 110\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 生成bootstrap.kubeconfig文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003EKUBE_APISERVER=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:6443\"\u003C\u002Fspan\u003E \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# apiserver IP:PORT\u003C\u002Fspan\u003E\n\u003Cspan\u003ETOKEN=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"8054b7219e601b121e8d2b4f73d255ad\"\u003C\u002Fspan\u003E \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 与token.csv里保持一致\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 生成 kubelet bootstrap kubeconfig 配置文件\u003C\u002Fspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-cluster kubernetes \\\n\u003Cspan\u003E  --certificate-authority=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \\\n\u003Cspan\u003E  --embed-certs=\u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --server=\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E${KUBE_APISERVER}\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --kubeconfig=bootstrap.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-credentials \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubelet-bootstrap\"\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --token=\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E${TOKEN}\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --kubeconfig=bootstrap.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-context default \\\n\u003Cspan\u003E  --cluster=kubernetes \\\n\u003Cspan\u003E  --user=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"kubelet-bootstrap\"\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --kubeconfig=bootstrap.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config use-context default --kubeconfig=bootstrap.kubeconfig\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E拷贝到配置文件路径：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecp bootstrap.kubeconfig \u002Fopt\u002Fkubernetes\u002Fcfg\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. systemd管理kubelet\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkubelet.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Kubernetes Kubelet\n\u003Cspan\u003EAfter=docker.service\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fkubernetes\u002Fbin\u002Fkubelet \\\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$KUBELET_OPTS\u003C\u002Fspan\u003E\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003ELimitNOFILE=65536\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kubelet\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kubelet\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.3 批准kubelet证书申请并加入集群\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 查看kubelet证书请求\u003C\u002Fspan\u003E\n\u003Cspan\u003Ekubectl get csr\n\u003Cspan\u003E\n\u003Cspan\u003ENAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION\n\u003Cspan\u003Enode-csr-ngC06Pj7kmQUvmzBnbfLRxUVG1J90dlT2lWMkCNbnBA   26s   kubernetes.io\u002Fkube-apiserver-client-kubelet   kubelet-bootstrap   Pending\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 批准申请(approve后跟上一步生成的node-*)\u003C\u002Fspan\u003E\n\u003Cspan\u003Ekubectl certificate approve node-csr-uCEGPOIiDdlLODKts8J658HrFq9CZ--K6M4G7bjhk8A\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 查看节点\u003C\u002Fspan\u003E\n\u003Cspan\u003Ekubectl get node\n\u003Cspan\u003ENAME          STATUS     ROLES    AGE   VERSION\n\u003Cspan\u003Ek8s-master1   NotReady   &lt;none&gt;   6s    v1.18.3\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：由于网络插件还没有部署，节点会没有准备就绪 NotReady。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.4 部署kube-proxy\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建配置文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy.conf &lt;&lt; EOF\n\u003Cspan\u003EKUBE_PROXY_OPTS=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"--logtostderr=false \\\\\n\u003Cspan\u003E--v=2 \\\\\n\u003Cspan\u003E--log-dir=\u002Fopt\u002Fkubernetes\u002Flogs \\\\\n\u003Cspan\u003E--config=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy-config.yml\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 配置参数文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy-config.yml &lt;&lt; EOF\n\u003Cspan\u003Ekind: KubeProxyConfiguration\n\u003Cspan\u003EapiVersion: kubeproxy.config.k8s.io\u002Fv1alpha1\n\u003Cspan\u003EbindAddress: 0.0.0.0\n\u003Cspan\u003EmetricsBindAddress: 0.0.0.0:10249\n\u003Cspan\u003EclientConnection:\n\u003Cspan\u003E  kubeconfig: \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy.kubeconfig\n\u003Cspan\u003EhostnameOverride: k8s-master1\n\u003Cspan\u003EclusterCIDR: 10.0.0.0\u002F24\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 生成kube-proxy.kubeconfig文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成kube-proxy证书：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 切换工作目录\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E ~\u002FTLS\u002Fk8s\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 创建证书请求文件\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecat &gt; kube-proxy-csr.json &lt;&lt; EOF\n\u003Cspan\u003E{\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"system:kube-proxy\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"hosts\"\u003C\u002Fspan\u003E: [],\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"key\"\u003C\u002Fspan\u003E: {\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"algo\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"rsa\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E    \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"size\"\u003C\u002Fspan\u003E: 2048\n\u003Cspan\u003E  },\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"names\"\u003C\u002Fspan\u003E: [\n\u003Cspan\u003E    {\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"C\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"CN\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"L\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"ST\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"BeiJing\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"O\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"k8s\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"OU\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"System\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    }\n\u003Cspan\u003E  ]\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 生成证书\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy\n\u003Cspan\u003E\n\u003Cspan\u003Els kube-proxy*pem\n\u003Cspan\u003Ekube-proxy-key.pem  kube-proxy.pem\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E生成kubeconfig文件：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003EKUBE_APISERVER=\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"https:\u002F\u002F10.1.1.204:6443\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-cluster kubernetes \\\n\u003Cspan\u003E  --certificate-authority=\u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem \\\n\u003Cspan\u003E  --embed-certs=\u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --server=\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E${KUBE_APISERVER}\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --kubeconfig=kube-proxy.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-credentials kube-proxy \\\n\u003Cspan\u003E  --client-certificate=.\u002Fkube-proxy.pem \\\n\u003Cspan\u003E  --client-key=.\u002Fkube-proxy-key.pem \\\n\u003Cspan\u003E  --embed-certs=\u003Cspan style=\"color: #56b6c2; line-height: 26px;\" class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E \\\n\u003Cspan\u003E  --kubeconfig=kube-proxy.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eset\u003C\u002Fspan\u003E-context default \\\n\u003Cspan\u003E  --cluster=kubernetes \\\n\u003Cspan\u003E  --user=kube-proxy \\\n\u003Cspan\u003E  --kubeconfig=kube-proxy.kubeconfig\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E拷贝到配置文件指定路径：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecp kube-proxy.kubeconfig \u002Fopt\u002Fkubernetes\u002Fcfg\u002F\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. systemd管理kube-proxy\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkube-proxy.service &lt;&lt; EOF\n\u003Cspan\u003E[Unit]\n\u003Cspan\u003EDescription=Kubernetes Proxy\n\u003Cspan\u003EAfter=network.target\n\u003Cspan\u003E[Service]\n\u003Cspan\u003EEnvironmentFile=\u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy.conf\n\u003Cspan\u003EExecStart=\u002Fopt\u002Fkubernetes\u002Fbin\u002Fkube-proxy \\\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$KUBE_PROXY_OPTS\u003C\u002Fspan\u003E\n\u003Cspan\u003ERestart=on-failure\n\u003Cspan\u003ELimitNOFILE=65536\n\u003Cspan\u003E[Install]\n\u003Cspan\u003EWantedBy=multi-user.target\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kube-proxy\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-proxy\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.5 部署CNI网络\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E先准备好CNI二进制文件：\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E下载地址：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fcontainernetworking\u002Fplugins\u002Freleases\u002Fdownload\u002Fv0.8.6\u002Fcni-plugins-linux-amd64-v0.8.6.tgz\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E解压二进制包并移动到默认工作目录：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir -p \u002Fopt\u002Fcni\u002Fbin\n\u003Cspan\u003Etar zxvf cni-plugins-linux-amd64-v0.8.6.tgz -C \u002Fopt\u002Fcni\u002Fbin\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E部署CNI网络：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ewget https:\u002F\u002Fraw.githubusercontent.com\u002Fcoreos\u002Fflannel\u002Fmaster\u002FDocumentation\u002Fkube-flannel.yml\n\u003Cspan\u003Esed -i -r \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"s#quay.io\u002Fcoreos\u002Fflannel:.*-amd64#lizhenliang\u002Fflannel:v0.12.0-amd64#g\"\u003C\u002Fspan\u003E kube-flannel.yml\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 这里需要一个国内镜像地址，国外的无法访问\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E默认镜像地址无法访问，修改为docker hub镜像仓库。\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl apply -f kube-flannel.yml\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl get pods -n kube-system\n\u003Cspan\u003ENAME                          READY   STATUS     RESTARTS   AGE\n\u003Cspan\u003Ekube-flannel-ds-amd64-jj98k   0\u002F1     Init:0\u002F1   0          14s\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl get node\n\u003Cspan\u003ENAME          STATUS     ROLES    AGE   VERSION\n\u003Cspan\u003Ek8s-master1   Ready   &lt;none&gt;   14m   v1.18.3\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E部署好网络插件，Node准备就绪。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.6 授权apiserver访问kubelet\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; apiserver-to-kubelet-rbac.yaml &lt;&lt; EOF\n\u003Cspan\u003EapiVersion: rbac.authorization.k8s.io\u002Fv1\n\u003Cspan\u003Ekind: ClusterRole\n\u003Cspan\u003Emetadata:\n\u003Cspan\u003E  annotations:\n\u003Cspan\u003E    rbac.authorization.kubernetes.io\u002Fautoupdate: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E  labels:\n\u003Cspan\u003E    kubernetes.io\u002Fbootstrapping: rbac-defaults\n\u003Cspan\u003E  name: system:kube-apiserver-to-kubelet\n\u003Cspan\u003Erules:\n\u003Cspan\u003E  - apiGroups:\n\u003Cspan\u003E      - \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E    resources:\n\u003Cspan\u003E      - nodes\u002Fproxy\n\u003Cspan\u003E      - nodes\u002Fstats\n\u003Cspan\u003E      - nodes\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\n\u003Cspan\u003E      - nodes\u002Fspec\n\u003Cspan\u003E      - nodes\u002Fmetrics\n\u003Cspan\u003E      - pods\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\n\u003Cspan\u003E    verbs:\n\u003Cspan\u003E      - \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"*\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E---\n\u003Cspan\u003EapiVersion: rbac.authorization.k8s.io\u002Fv1\n\u003Cspan\u003Ekind: ClusterRoleBinding\n\u003Cspan\u003Emetadata:\n\u003Cspan\u003E  name: system:kube-apiserver\n\u003Cspan\u003E  namespace: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\"\u003C\u002Fspan\u003E\n\u003Cspan\u003EroleRef:\n\u003Cspan\u003E  apiGroup: rbac.authorization.k8s.io\n\u003Cspan\u003E  kind: ClusterRole\n\u003Cspan\u003E  name: system:kube-apiserver-to-kubelet\n\u003Cspan\u003Esubjects:\n\u003Cspan\u003E  - apiGroup: rbac.authorization.k8s.io\n\u003Cspan\u003E    kind: User\n\u003Cspan\u003E    name: kubernetes\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl apply -f apiserver-to-kubelet-rbac.yaml\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E5.7 新增加Worker Node\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 拷贝已部署好的Node相关文件到新节点(k8s-master1上执行)\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E在Master节点将Worker Node涉及文件拷贝到新节点10.1.1.151\u002F186\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Escp -r \u002Fopt\u002Fkubernetes root@10.1.1.151:\u002Fopt\u002F\n\u003Cspan\u003Escp -r \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002F{kubelet,kube-proxy}.service root@10.1.1.151:\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\n\u003Cspan\u003Escp -r \u002Fopt\u002Fcni\u002F root@10.1.1.151:\u002Fopt\u002F\n\u003Cspan\u003Escp -r \u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem root@10.1.1.151:\u002Fopt\u002Fkubernetes\u002Fssl\n\u003Cspan\u003E\n\u003Cspan\u003Escp -r \u002Fopt\u002Fkubernetes root@10.1.1.186:\u002Fopt\u002F\n\u003Cspan\u003Escp -r \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002F{kubelet,kube-proxy}.service root@10.1.1.186:\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\n\u003Cspan\u003Escp -r \u002Fopt\u002Fcni\u002F root@10.1.1.186:\u002Fopt\u002F\n\u003Cspan\u003Escp -r \u002Fopt\u002Fkubernetes\u002Fssl\u002Fca.pem root@10.1.1.186:\u002Fopt\u002Fkubernetes\u002Fssl\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 删除kubelet证书和kubeconfig文件(k8s-worker1\u002F2上执行)\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Erm -f \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.kubeconfig\n\u003Cspan\u003Erm -f \u002Fopt\u002Fkubernetes\u002Fssl\u002Fkubelet*\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：这几个文件是证书申请审批后自动生成的，每个Node不同，必须删除重新生成。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 修改主机名(k8s-worker1\u002F2上执行)\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.conf\n\u003Cspan\u003E--hostname-override=k8s-worker1\n\u003Cspan\u003E\n\u003Cspan\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy-config.yml\n\u003Cspan\u003EhostnameOverride: k8s-worker1\n\u003Cspan\u003E\n\u003Cspan\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.conf\n\u003Cspan\u003E--hostname-override=k8s-worker2\n\u003Cspan\u003E\n\u003Cspan\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy-config.yml\n\u003Cspan\u003EhostnameOverride: k8s-worker2\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. 启动并设置开机启动(k8s-worker1\u002F2上执行)\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kubelet\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kubelet\n\u003Cspan\u003Esystemctl start kube-proxy\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-proxy\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 在Master上批准新Node kubelet证书申请\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get csr\n\u003Cspan\u003ENAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION\n\u003Cspan\u003Enode-csr-mZ1Shcds5I90zfqQupi-GaI_4MeKl7PizK5dgOF2wC8   14s   kubernetes.io\u002Fkube-apiserver-client-kubelet   kubelet-bootstrap   Pending\n\u003Cspan\u003Enode-csr-x-lWfrl2pFrMUblecU5NYgpn3zI6j_iiTmcKZ1JRefY   20s   kubernetes.io\u002Fkube-apiserver-client-kubelet   kubelet-bootstrap   Pending\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl certificate approve node-csr-mZ1Shcds5I90zfqQupi-GaI_4MeKl7PizK5dgOF2wC8\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl certificate approve node-csr-x-lWfrl2pFrMUblecU5NYgpn3zI6j_iiTmcKZ1JRefY\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E6. 查看Node状态\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get node\n\u003Cspan\u003ENAME         STATUS     ROLES    AGE   VERSION\n\u003Cspan\u003Ek8s-master1   Ready      &lt;none&gt;   65m   v1.18.3\n\u003Cspan\u003Ek8s-worker1    Ready      &lt;none&gt;   12m   v1.18.3\n\u003Cspan\u003Ek8s-worker2    Ready      &lt;none&gt;   81s   v1.18.3\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E6. 部署Dashboard和CoreDNS\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E6.1 部署Dashboard\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ewget https:\u002F\u002Fraw.githubusercontent.com\u002Fkubernetes\u002Fdashboard\u002Fv2.0.0-beta8\u002Faio\u002Fdeploy\u002Frecommended.yaml\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E默认Dashboard只能集群内部访问，修改Service为NodePort类型，暴露到外部：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Evi recommended.yaml\n\u003Cspan\u003Ekind: Service\n\u003Cspan\u003EapiVersion: v1\n\u003Cspan\u003Emetadata:\n\u003Cspan\u003E  labels:\n\u003Cspan\u003E    k8s-app: kubernetes-dashboard\n\u003Cspan\u003E  name: kubernetes-dashboard\n\u003Cspan\u003E  namespace: kubernetes-dashboard\n\u003Cspan\u003Espec:\n\u003Cspan\u003E  ports:\n\u003Cspan\u003E    - port: 443\n\u003Cspan\u003E      targetPort: 8443\n\u003Cspan\u003E      nodePort: 30001\n\u003Cspan\u003E  \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Etype\u003C\u002Fspan\u003E: NodePort\n\u003Cspan\u003E  selector:\n\u003Cspan\u003E    k8s-app: kubernetes-dashboard\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl apply -f recommended.yaml    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 这里有个坑，需要等待一段时间下方STATUS为Running才行\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get pods,svc -n kubernetes-dashboard\n\u003Cspan\u003E\n\u003Cspan\u003ENAME                                             READY   STATUS    RESTARTS   AGE\n\u003Cspan\u003Epod\u002Fdashboard-metrics-scraper-694557449d-dhlrq   1\u002F1     Running   0          27s\n\u003Cspan\u003Epod\u002Fkubernetes-dashboard-9774cc786-7d6qn         1\u002F1     Running   0          27s\n\u003Cspan\u003E\n\u003Cspan\u003ENAME                                TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)         AGE\n\u003Cspan\u003Eservice\u002Fdashboard-metrics-scraper   ClusterIP   10.0.0.36    &lt;none&gt;        8000\u002FTCP        27s\n\u003Cspan\u003Eservice\u002Fkubernetes-dashboard        NodePort    10.0.0.154   &lt;none&gt;        443:30001\u002FTCP   27s\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E访问地址：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ehttps:\u002F\u002FNodeIP:30001\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E创建service account并绑定默认cluster-admin管理员集群角色：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl create serviceaccount dashboard-admin -n kube-system\n\u003Cspan\u003Ekubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin\n\u003Cspan\u003Ekubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E'\u002Fdashboard-admin\u002F{print $1}'\u003C\u002Fspan\u003E)\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E获得token：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003EeyJhbGciOiJSUzI1NiIsImtpZCI6IlVZczd4TDN3VHRpLWdNUnRlc1BOY2E0T3Z1Q3UzQmlwUEZpaEZHclJ0MWcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tNWRod2YiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMTMzZmVkODItM2Q3OC00ODk5LWJiMzYtY2YyZjU4NzgzZTRlIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.gTuj33hMUmvgdPU499ifrn4V8AjinlRhzkw2ItdNRVdUmU6YLbSjZIp8WlPOkdtmDM2c3LCkLmnBqIabkIiIwb1HkNOtmglnFghzV8Td5GIGnoRqAmKPXO0aY4Y97w_X0sVC3DB34EY6soPlcI_v6_-nSqRC1rPOSJ9xd8yU774YHYucYqiU-ViiIgqHELo7BT6CVD1iLw4K_C5wfWs4o6htplhGpJ0edLPsZpwnTrW-4qn4d-EdKXcVJhpTUxxLoKL7HrerTwxeUMM1SL0vGnD5z2io9gybylubbgV7xRsSQQCwuXWqlzI6A_YWzl3-wmhwty4x9cWjQHMGw87YhA\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E使用输出的token登录Dashboard。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E6.2 部署CoreDNS\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003ECoreDNS用于集群内部Service名称解析。\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecurl -o .\u002Fcoredns.yaml https:\u002F\u002Fgithub.com\u002Fkubernetes\u002Fkubernetes\u002Fblob\u002Fe176e477195f92919724bd02f81e2b18d4477af7\u002Fcluster\u002Faddons\u002Fdns\u002Fcoredns\u002Fcoredns.yaml.sed\n\u003Cspan\u003Ekubectl apply -f coredns.yaml    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 这个地方需要修改下把CLUSTER_DNS_IP变量删除\u003C\u002Fspan\u003E\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl get pods -n kube-system     \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 等待下方第一个STATUS为Running为准\u003C\u002Fspan\u003E\n\u003Cspan\u003ENAME                          READY   STATUS    RESTARTS   AGE\n\u003Cspan\u003Ecoredns-5ffbfd976d-j6shb      1\u002F1     Running   0          32s\n\u003Cspan\u003Ekube-flannel-ds-amd64-2pc95   1\u002F1     Running   0          38m\n\u003Cspan\u003Ekube-flannel-ds-amd64-7qhdx   1\u002F1     Running   0          15m\n\u003Cspan\u003Ekube-flannel-ds-amd64-99cr8   1\u002F1     Running   0          26m\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EDNS解析测试：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl run -it --rm dns-test --image=busybox:1.28.4 sh\n\u003Cspan\u003EIf you don\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E't see a command prompt, try pressing enter.\n\u003Cspan\u003E\n\u003Cspan\u003E\u002F # nslookup kubernetes\n\u003Cspan\u003EServer:    10.0.0.2\n\u003Cspan\u003EAddress 1: 10.0.0.2 kube-dns.kube-system.svc.cluster.local\n\u003Cspan\u003E\n\u003Cspan\u003EName:      kubernetes\n\u003Cspan\u003EAddress 1: 10.0.0.1 kubernetes.default.svc.cluster.local\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E解析没问题。\u003C\u002Fp\u003E\n\u003Ch2 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; text-align: left; margin: 20px 10px 0px 0px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"font-family: STHeitiSC-Light; font-size: 22px; color: #0e88eb; font-weight: bolder; display: inline-block; padding-left: 10px; border-left: 5px solid #0e88eb;\" class=\"content\"\u003E7. 高可用架构（扩容多Master架构）\u003C\u002Fspan\u003E\u003Cspan class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh2\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EKubernetes作为容器集群系统，通过健康检查+重启策略实现了Pod故障自我修复能力，通过调度算法实现将Pod分布式部署，并保持预期副本数，根据Node失效状态自动在其他Node拉起Pod，实现了应用层的高可用性。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E针对Kubernetes集群，高可用性还应包含以下两个层面的考虑：Etcd数据库的高可用性和Kubernetes Master组件的高可用性。 而Etcd我们已经采用3个节点组建集群实现高可用，本节将对Master节点高可用进行说明和实施。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EMaster节点扮演着总控中心的角色，通过不断与工作节点上的Kubelet和kube-proxy进行通信来维护整个集群的健康工作状态。如果Master节点故障，将无法使用kubectl工具或者API做任何集群管理。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EMaster节点主要有三个服务kube-apiserver、kube-controller-manager和kube-scheduler，其中kube-controller-manager和kube-scheduler组件自身通过选择机制已经实现了高可用，所以Master高可用主要针对kube-apiserver组件，而该组件是以HTTP API提供服务，因此对他高可用与Web服务器类似，增加负载均衡器对其负载均衡即可，并且可水平扩容。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E多Master架构图：\u003C\u002Fp\u003E\n\u003Cfigure style=\"margin: 0; margin-top: 10px; margin-bottom: 10px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cimg style=\"max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;\" alt=\"\" src=\"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F1730895b37323660?w=1020&amp;h=763&amp;f=png&amp;s=37599\"\u003E\u003C\u002Ffigure\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E7.1 安装Docker\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E同上，不再赘述。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E7.2 部署Master2 Node（10.1.1.230）\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003EMaster2 与已部署的Master1所有操作一致。所以我们只需将Master1所有K8s文件拷贝过来，再修改下服务器IP和主机名启动即可。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 创建etcd证书目录\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E在Master2创建etcd证书目录：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Emkdir -p \u002Fopt\u002Fetcd\u002Fssl\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. 拷贝文件（Master1操作）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E拷贝Master1上所有K8s文件和etcd证书到Master2：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Escp -r \u002Fopt\u002Fkubernetes root@10.1.1.230:\u002Fopt\n\u003Cspan\u003Escp -r \u002Fopt\u002Fcni\u002F root@10.1.1.230:\u002Fopt\n\u003Cspan\u003Escp -r \u002Fopt\u002Fetcd\u002Fssl root@10.1.1.230:\u002Fopt\u002Fetcd\n\u003Cspan\u003Escp \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fkube* root@10.1.1.230:\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\n\u003Cspan\u003Escp \u002Fusr\u002Fbin\u002Fkubectl  root@10.1.1.230:\u002Fusr\u002Fbin\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. 删除证书文件\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E删除kubelet证书和kubeconfig文件：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Erm -f \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.kubeconfig \n\u003Cspan\u003Erm -f \u002Fopt\u002Fkubernetes\u002Fssl\u002Fkubelet*\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. 修改配置文件IP和主机名\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E修改apiserver、kubelet和kube-proxy配置文件为本地IP：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-apiserver.conf \n\u003Cspan\u003E...\n\u003Cspan\u003E--\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Ebind\u003C\u002Fspan\u003E-address=10.1.1.230 \\\n\u003Cspan\u003E--advertise-address=10.1.1.230 \\\n\u003Cspan\u003E...\n\u003Cspan\u003E\n\u003Cspan\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkubelet.conf\n\u003Cspan\u003E--hostname-override=k8s-master2\n\u003Cspan\u003E\n\u003Cspan\u003Evi \u002Fopt\u002Fkubernetes\u002Fcfg\u002Fkube-proxy-config.yml\n\u003Cspan\u003EhostnameOverride: k8s-master2\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start kube-apiserver\n\u003Cspan\u003Esystemctl start kube-controller-manager\n\u003Cspan\u003Esystemctl start kube-scheduler\n\u003Cspan\u003Esystemctl start kubelet\n\u003Cspan\u003Esystemctl start kube-proxy\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-apiserver\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-controller-manager\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-scheduler\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kubelet\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E kube-proxy\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E6. 查看集群状态\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get cs\n\u003Cspan\u003ENAME                 STATUS    MESSAGE             ERROR\n\u003Cspan\u003Escheduler            Healthy   ok                  \n\u003Cspan\u003Econtroller-manager   Healthy   ok                  \n\u003Cspan\u003Eetcd-1               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}   \n\u003Cspan\u003Eetcd-2               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}   \n\u003Cspan\u003Eetcd-0               Healthy   {\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"health\"\u003C\u002Fspan\u003E:\u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"true\"\u003C\u002Fspan\u003E}\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E7. 批准kubelet证书申请\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ekubectl get csr\n\u003Cspan\u003ENAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION\n\u003Cspan\u003Enode-csr-JYNknakEa_YpHz797oKaN-ZTk43nD51Zc9CJkBLcASU   85m   kubernetes.io\u002Fkube-apiserver-client-kubelet   kubelet-bootstrap   Pending\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl certificate approve node-csr-JYNknakEa_YpHz797oKaN-ZTk43nD51Zc9CJkBLcASU\n\u003Cspan\u003E\n\u003Cspan\u003Ekubectl get node\n\u003Cspan\u003ENAME          STATUS   ROLES    AGE   VERSION\n\u003Cspan\u003Ek8s-master1    Ready    &lt;none&gt;   34h   v1.18.3\n\u003Cspan\u003Ek8s-master2   Ready    &lt;none&gt;   83m   v1.18.3\n\u003Cspan\u003Ek8s-worker1     Ready    &lt;none&gt;   33h   v1.18.3\n\u003Cspan\u003Ek8s-worker2     Ready    &lt;none&gt;   33h   v1.18.3\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E7.3 部署Nginx负载均衡器\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003Ekube-apiserver高可用架构图：\u003C\u002Fp\u003E\n\u003Cfigure style=\"margin: 0; margin-top: 10px; margin-bottom: 10px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cimg style=\"max-width: 100%; border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;\" alt=\"\" src=\"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F1730895b392e23da?w=806&amp;h=449&amp;f=png&amp;s=38210\"\u003E\u003C\u002Ffigure\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003ENginx是一个主流Web服务和反向代理服务器，这里用四层实现对apiserver实现负载均衡。\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003EKeepalived是一个主流高可用软件，基于VIP绑定实现服务器双机热备，在上述拓扑中，Keepalived主要根据Nginx运行状态判断是否需要故障转移（偏移VIP），例如当Nginx主节点挂掉，VIP会自动绑定在Nginx备节点，从而保证VIP一直可用，实现Nginx高可用。\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E1. 安装软件包（主\u002F备）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Eyum install epel-release -y\n\u003Cspan\u003Eyum install nginx keepalived -y\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E2. Nginx配置文件（主\u002F备一样）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fetc\u002Fnginx\u002Fnginx.conf &lt;&lt; \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"EOF\"\u003C\u002Fspan\u003E\n\u003Cspan\u003Euser nginx;\n\u003Cspan\u003Eworker_processes auto;\n\u003Cspan\u003Eerror_log \u002Fvar\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\u002Fnginx\u002Ferror.log;\n\u003Cspan\u003Epid \u002Frun\u002Fnginx.pid;\n\u003Cspan\u003E\n\u003Cspan\u003Einclude \u002Fusr\u002Fshare\u002Fnginx\u002Fmodules\u002F*.conf;\n\u003Cspan\u003E\n\u003Cspan\u003Eevents {\n\u003Cspan\u003E    worker_connections 1024;\n\u003Cspan\u003E}\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 四层负载均衡，为两台Master apiserver组件提供负载均衡\u003C\u002Fspan\u003E\n\u003Cspan\u003Estream {\n\u003Cspan\u003E\n\u003Cspan\u003E    log_format  main  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E'$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent'\u003C\u002Fspan\u003E;\n\u003Cspan\u003E\n\u003Cspan\u003E    access_log  \u002Fvar\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\u002Fnginx\u002Fk8s-access.log  main;\n\u003Cspan\u003E\n\u003Cspan\u003E    upstream k8s-apiserver {\n\u003Cspan\u003E       server 10.1.1.204:6443;   \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# Master1 APISERVER IP:PORT\u003C\u002Fspan\u003E\n\u003Cspan\u003E       server 10.1.1.230:6443;   \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# Master2 APISERVER IP:PORT\u003C\u002Fspan\u003E\n\u003Cspan\u003E    }\n\u003Cspan\u003E    \n\u003Cspan\u003E    server {\n\u003Cspan\u003E       listen 6443;\n\u003Cspan\u003E       proxy_pass k8s-apiserver;\n\u003Cspan\u003E    }\n\u003Cspan\u003E}\n\u003Cspan\u003E\n\u003Cspan\u003Ehttp {\n\u003Cspan\u003E    log_format  main  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E'$remote_addr - $remote_user [$time_local] \"$request\" '\u003C\u002Fspan\u003E\n\u003Cspan\u003E                      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E'$status $body_bytes_sent \"$http_referer\" '\u003C\u002Fspan\u003E\n\u003Cspan\u003E                      \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E'\"$http_user_agent\" \"$http_x_forwarded_for\"'\u003C\u002Fspan\u003E;\n\u003Cspan\u003E\n\u003Cspan\u003E    access_log  \u002Fvar\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\u002Fnginx\u002Faccess.log  main;\n\u003Cspan\u003E\n\u003Cspan\u003E    sendfile            on;\n\u003Cspan\u003E    tcp_nopush          on;\n\u003Cspan\u003E    tcp_nodelay         on;\n\u003Cspan\u003E    keepalive_timeout   65;\n\u003Cspan\u003E    types_hash_max_size 2048;\n\u003Cspan\u003E\n\u003Cspan\u003E    include             \u002Fetc\u002Fnginx\u002Fmime.types;\n\u003Cspan\u003E    default_type        application\u002Foctet-stream;\n\u003Cspan\u003E\n\u003Cspan\u003E    server {\n\u003Cspan\u003E        listen       80 default_server;\n\u003Cspan\u003E        server_name  _;\n\u003Cspan\u003E\n\u003Cspan\u003E        location \u002F {\n\u003Cspan\u003E        }\n\u003Cspan\u003E    }\n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E3. keepalived配置文件（Nginx Master）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fetc\u002Fkeepalived\u002Fkeepalived.conf &lt;&lt; EOF\n\u003Cspan\u003Eglobal_defs { \n\u003Cspan\u003E   notification_email { \n\u003Cspan\u003E     acassen@firewall.loc \n\u003Cspan\u003E     failover@firewall.loc \n\u003Cspan\u003E     sysadmin@firewall.loc \n\u003Cspan\u003E   } \n\u003Cspan\u003E   notification_email_from Alexandre.Cassen@firewall.loc  \n\u003Cspan\u003E   smtp_server 127.0.0.1 \n\u003Cspan\u003E   smtp_connect_timeout 30 \n\u003Cspan\u003E   router_id NGINX_MASTER\n\u003Cspan\u003E} \n\u003Cspan\u003Evrrp_script check_nginx {\n\u003Cspan\u003E    script \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E}\n\u003Cspan\u003Evrrp_instance VI_1 { \n\u003Cspan\u003E    state MASTER \n\u003Cspan\u003E    interface ens33\n\u003Cspan\u003E    virtual_router_id 51 \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# VRRP 路由 ID实例，每个实例是唯一的 \u003C\u002Fspan\u003E\n\u003Cspan\u003E    priority 100    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 优先级，备服务器设置 90 \u003C\u002Fspan\u003E\n\u003Cspan\u003E    advert_int 1    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 指定VRRP 心跳包通告间隔时间，默认1秒 \u003C\u002Fspan\u003E\n\u003Cspan\u003E    authentication { \n\u003Cspan\u003E        auth_type PASS      \n\u003Cspan\u003E        auth_pass 1111 \n\u003Cspan\u003E    }  \n\u003Cspan\u003E    \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# 虚拟IP\u003C\u002Fspan\u003E\n\u003Cspan\u003E    virtual_ipaddress { \n\u003Cspan\u003E        10.1.1.170\u002F24\n\u003Cspan\u003E    } \n\u003Cspan\u003E    track_script {\n\u003Cspan\u003E        check_nginx\n\u003Cspan\u003E    } \n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul style=\"margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003Evrrp_script：指定检查nginx工作状态脚本（根据nginx状态判断是否故障转移）\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Csection style=\"margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500; font-size: 15px;\"\u003Evirtual_ipaddress：虚拟IP（VIP）\u003C\u002Fsection\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E检查nginx状态脚本：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh  &lt;&lt; \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"EOF\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #61aeee; line-height: 26px;\" class=\"hljs-meta\"\u003E#!\u002Fbin\u002Fbash\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecount=$(ps -ef |grep nginx |egrep -cv \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"grep|$\"\u003C\u002Fspan\u003E)\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E [ \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$count\u003C\u002Fspan\u003E\"\u003C\u002Fspan\u003E -eq 0 ];\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Ethen\u003C\u002Fspan\u003E\n\u003Cspan\u003E    \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eexit\u003C\u002Fspan\u003E 1\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E\n\u003Cspan\u003E    \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eexit\u003C\u002Fspan\u003E 0\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Efi\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Echmod +x \u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E4. keepalived配置文件（Nginx Backup）\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fetc\u002Fkeepalived\u002Fkeepalived.conf &lt;&lt; EOF\n\u003Cspan\u003Eglobal_defs { \n\u003Cspan\u003E   notification_email { \n\u003Cspan\u003E     acassen@firewall.loc \n\u003Cspan\u003E     failover@firewall.loc \n\u003Cspan\u003E     sysadmin@firewall.loc \n\u003Cspan\u003E   } \n\u003Cspan\u003E   notification_email_from Alexandre.Cassen@firewall.loc  \n\u003Cspan\u003E   smtp_server 127.0.0.1 \n\u003Cspan\u003E   smtp_connect_timeout 30 \n\u003Cspan\u003E   router_id NGINX_BACKUP\n\u003Cspan\u003E} \n\u003Cspan\u003Evrrp_script check_nginx {\n\u003Cspan\u003E    script \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E}\n\u003Cspan\u003Evrrp_instance VI_1 { \n\u003Cspan\u003E    state BACKUP \n\u003Cspan\u003E    interface ens33\n\u003Cspan\u003E    virtual_router_id 51 \u003Cspan style=\"color: #5c6370; font-style: italic; line-height: 26px;\" class=\"hljs-comment\"\u003E# VRRP 路由 ID实例，每个实例是唯一的 \u003C\u002Fspan\u003E\n\u003Cspan\u003E    priority 90\n\u003Cspan\u003E    advert_int 1\n\u003Cspan\u003E    authentication { \n\u003Cspan\u003E        auth_type PASS      \n\u003Cspan\u003E        auth_pass 1111 \n\u003Cspan\u003E    }  \n\u003Cspan\u003E    virtual_ipaddress { \n\u003Cspan\u003E        10.1.1.170\u002F24\n\u003Cspan\u003E    } \n\u003Cspan\u003E    track_script {\n\u003Cspan\u003E        check_nginx\n\u003Cspan\u003E    } \n\u003Cspan\u003E}\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E上述配置文件中检查nginx运行状态脚本：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecat &gt; \u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh  &lt;&lt; \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"EOF\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #61aeee; line-height: 26px;\" class=\"hljs-meta\"\u003E#!\u002Fbin\u002Fbash\u003C\u002Fspan\u003E\n\u003Cspan\u003Ecount=$(ps -ef |grep nginx |egrep -cv \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"grep|$\"\u003C\u002Fspan\u003E)\n\u003Cspan\u003E\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E [ \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"\u003Cspan style=\"color: #d19a66; line-height: 26px;\" class=\"hljs-variable\"\u003E$count\u003C\u002Fspan\u003E\"\u003C\u002Fspan\u003E -eq 0 ];\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Ethen\u003C\u002Fspan\u003E\n\u003Cspan\u003E    \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eexit\u003C\u002Fspan\u003E 1\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E\n\u003Cspan\u003E    \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eexit\u003C\u002Fspan\u003E 0\n\u003Cspan\u003E\u003Cspan style=\"color: #c678dd; line-height: 26px;\" class=\"hljs-keyword\"\u003Efi\u003C\u002Fspan\u003E\n\u003Cspan\u003EEOF\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Echmod +x \u002Fetc\u002Fkeepalived\u002Fcheck_nginx.sh\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote style=\"display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; font-style: normal; border-left: none; padding: 10px; position: relative; line-height: 1.8; border-radius: 0px 0px 10px 10px; color: #0e88eb; background: #fff; box-shadow: #84A1A8 0px 10px 15px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: inline; color: #0e88eb; font-size: 4em; font-family: Arial,serif; line-height: 1em; font-weight: 700;\"\u003E★ \u003C\u002Fspan\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; letter-spacing: 0.2em; word-spacing: 0.1em; margin: 0px; line-height: 26px; color: #0e88eb; font-size: 15px; display: inline;\"\u003E注：keepalived根据脚本返回状态码（0为工作正常，非0不正常）判断是否故障转移。\u003C\u002Fp\u003E\n\u003Cspan style=\"float: right; display: inline; color: #0e88eb; font-size: 3em; line-height: 1em; font-weight: 500;\"\u003E”\u003C\u002Fspan\u003E\u003C\u002Fblockquote\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E5. 启动并设置开机启动\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esystemctl daemon-reload\n\u003Cspan\u003Esystemctl start nginx\n\u003Cspan\u003Esystemctl start keepalived\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E nginx\n\u003Cspan\u003Esystemctl \u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Eenable\u003C\u002Fspan\u003E keepalived\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E6. 查看keepalived工作状态\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Eip a\n\u003Cspan\u003E\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E可以看到，在ens33网卡绑定了10.1.1.170虚拟IP，说明工作正常。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E7. Nginx+Keepalived高可用测试\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E关闭主节点Nginx，测试VIP是否漂移到备节点服务器。\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003E在Nginx Master执行 pkill nginx\n\u003Cspan\u003E在Nginx Backup，ip addr命令查看已成功绑定VIP。\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E\u003Cstrong style=\"font-weight: border; color: #0e88eb;\"\u003E8. 访问负载均衡器测试\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E找K8s集群中任意一个节点，使用curl查看K8s版本测试，使用VIP访问：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Ecurl -k https:\u002F\u002F10.1.1.170:6443\u002Fversion\n\u003Cspan\u003E{\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"major\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"1\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"minor\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"18\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"gitVersion\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"v1.18.3\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"gitCommit\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"2e7996e3e2712684bc73f0dec0200d64eec7fe40\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"gitTreeState\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"clean\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"buildDate\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"2020-05-20T12:43:34Z\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"goVersion\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"go1.13.9\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"compiler\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"gc\"\u003C\u002Fspan\u003E,\n\u003Cspan\u003E  \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"platform\"\u003C\u002Fspan\u003E: \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E\"linux\u002Famd64\"\u003C\u002Fspan\u003E\n\u003Cspan\u003E}\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E可以正确获取到K8s版本信息，说明负载均衡器搭建正常。该请求数据流程：\u003Ccode style=\"font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;\"\u003Ecurl -&gt; vip(nginx) -&gt; apiserver\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E通过查看Nginx日志也可以看到转发apiserver IP：\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Etail \u002Fvar\u002F\u003Cspan style=\"color: #e6c07b; line-height: 26px;\" class=\"hljs-built_in\"\u003Elog\u003C\u002Fspan\u003E\u002Fnginx\u002Fk8s-access.log -f\n\u003Cspan\u003E10.1.1.170 10.1.1.204:6443 - [30\u002FMay\u002F2020:11:15:10 +0800] 200 422\n\u003Cspan\u003E10.1.1.170 10.1.1.230:6443 - [30\u002FMay\u002F2020:11:15:26 +0800] 200 422\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E到此还没结束，还有下面最关键的一步。\u003C\u002Fp\u003E\n\u003Ch4 style=\"margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 18px;\" data-tool=\"mdnice编辑器\"\u003E\u003Cspan style=\"display: none;\" class=\"prefix\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"content\"\u003E7.4 修改所有Worker Node连接LB VIP\u003C\u002Fspan\u003E\u003Cspan style=\"display: none;\" class=\"suffix\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fh4\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E试想下，虽然我们增加了Master2和负载均衡器，但是我们是从单Master架构扩容的，也就是说目前所有的Node组件连接都还是Master1，如果不改为连接VIP走负载均衡器，那么Master还是单点故障。\u003C\u002Fp\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E因此接下来就是要改所有Worker Node组件配置文件，由原来10.1.1.204修改为10.1.1.170（VIP）：\u003C\u002Fp\u003E\n\u003Ctable style=\"display: table; text-align: left;\" data-tool=\"mdnice编辑器\"\u003E\n\u003Cthead\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003E角色\u003C\u002Fth\u003E\n\u003Cth style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-weight: bold; background-color: #f0f0f0; font-size: 15px;\"\u003EIP\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody style=\"border: 0;\"\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-master1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.204\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-master2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.230\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: white;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker1\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.151\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr style=\"border: 0; border-top: 1px solid #ccc; background-color: #F8F8F8;\"\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003Ek8s-worker2\u003C\u002Ftd\u003E\n\u003Ctd style=\"border: 1px solid #ccc; padding: 5px 10px; text-align: left; font-size: 15px;\"\u003E10.1.1.186\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003Esed -i \u003Cspan style=\"color: #98c379; line-height: 26px;\" class=\"hljs-string\"\u003E's#10.1.1.204:6443#10.1.1.170:6443#'\u003C\u002Fspan\u003E \u002Fopt\u002Fkubernetes\u002Fcfg\u002F*\n\u003Cspan\u003Esystemctl restart kubelet\n\u003Cspan\u003Esystemctl restart kube-proxy\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E检查节点状态：kubectl get node\u003C\u002Fp\u003E\n\u003Cpre style=\"margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\" data-tool=\"mdnice编辑器\" class=\"custom\"\u003E\u003Cspan style=\"display: block; background: url(https:\u002F\u002Fimgkr.cn-bj.ufileos.com\u002F97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"\u003E\u003C\u002Fspan\u003E\u003Ccode style=\"overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;\" class=\"hljs\"\u003ENAME          STATUS   ROLES    AGE    VERSION\n\u003Cspan\u003Ek8s-master    Ready    &lt;none&gt;   34h    v1.18.3\n\u003Cspan\u003Ek8s-master2   Ready    &lt;none&gt;   101m   v1.18.3\n\u003Cspan\u003Ek8s-node1     Ready    &lt;none&gt;   33h    v1.18.3\n\u003Cspan\u003Ek8s-node2     Ready    &lt;none&gt;   33h    v1.18.3\n\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp style=\"padding-top: 8px; padding-bottom: 8px; color: black; margin: 10px 10px; line-height: 1.75; letter-spacing: 0.2em; font-size: 15px; word-spacing: 0.1em;\" data-tool=\"mdnice编辑器\"\u003E至此，一套完整的 Kubernetes 高可用集群就部署完成了！\u003C\u002Fp\u003E\u003C\u002Fsection\u003E",originalUrl:"https:\u002F\u002Fjuejin.im\u002Fpost\u002F6844904205556121608",type:"post",collected:a,viewsCount:784,username:"iuskye",viewerHasLiked:a,draftId:"6845076845545684999",collectionCount:d},entryView:{},author:{id:"1503787639375096",self_description:void 0,followed:a,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:d,wroteBookCount:d,boughtBookCount:d,isBindedPhone:a,level:h,user_id:"1503787639375096",user_name:"iuskye",company:e,job_title:"运维开发工程师",avatar_large:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F173088b467209a0b?w=807&h=1024&f=jpeg&s=130639",description:e,followee_count:6,follower_count:3,post_article_count:3,digg_article_count:d,got_digg_count:h,got_view_count:852,post_shortmsg_count:d,digg_shortmsg_count:d,isfollowed:a,favorable_author:d,power:9,juejinPower:9,jobTitle:"运维开发工程师",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"iuskye",blogAddress:void 0,selfDescription:e,beLikedCount:h,beReadCount:852,followerCount:3,followingCount:6,collectionCount:d,createdCollectionCount:d,followingCollectionCount:d,postedPostsCount:3,pinCount:d,likedArticleCount:d,likedPinCount:d,avatar:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F1\u002F173088b467209a0b?w=807&h=1024&f=jpeg&s=130639",latestLoginedInAt:b,createdAt:b,updatedAt:b,phoneNumber:e,titleDescription:e,followeesCount:6},adEntryList:[],relatedEntryList:[],actionType:{FETCH:"view\u002Fcolumn\u002FFETCH",FETCH_ADDITIONAL:"view\u002Fcolumn\u002FFETCH_ADDITIONAL",FETCH_SIDEBAR_ADENTRY:"view\u002Fcolumn\u002FFETCH_SIDEBAR_ADENTRY",RESET:"view\u002Fcolumn\u002FRESET"},recommendedArticleList:{list:[],tagIds:[],cursor:f,loading:a,skeleton:a,hasMore:a,articleId:e,actionType:{UPDATE_STATE:"view\u002Fcolumn\u002Frecommend-List\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH_MORE",FETCH:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH",RESET:"view\u002Fcolumn\u002Frecommend-List\u002FRESET"}}},collection:{collection:{author:{}},actionType:{FETCH:"@\u002Fview\u002Fcollection\u002FFETCH",REFRESH:"@\u002Fview\u002Fcollection\u002FREFRESH",RESET:"@\u002Fview\u002Fcollection\u002FRESET"},list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fcollection\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fcollection\u002Flist\u002FRESET"},id:e,sort:o}},gettingStarted:{category:{},actionType:{UPDATE_STATE:"@\u002Fview\u002FgettingStarted\u002FUPDATE_STATE",FOLLOW:"@\u002Fview\u002FgettingStarted\u002FFOLLOW",RESET:"@\u002Fview\u002FgettingStarted\u002FRESET",UPDATE_CATEGORY:"@\u002Fview\u002FgettingStarted\u002FUPDATE_CATEGORY"}},pin:{pin:{user:{},imageUrlList:[]},pinList:[],actionType:{FETCH:"@\u002Fview\u002Fpin\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002FRESET"},sidebar:{list:[],after:e,loading:a,isRecommend:a,hasNextPage:c,actionType:{UPDATE_STATE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002Fsidebar\u002FRESET"}},commentList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FcommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FcommentList\u002FRESET"},pinId:b},subCommentList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FRESET"},commentId:b}},topic:{topic:e,followedTopicList:[],actionType:{FETCH:"@\u002Fview\u002Ftopic\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002FUPDATE_STATE",RESET:"@\u002Fview\u002Ftopic\u002FRESET"},allTopicList:{pageSize:r,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FRESET"},sortType:k},pinlist:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FpinList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FpinList\u002FRESET"},sortType:m},sidebar:{actionType:{RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FUPDATE_STATE"},attender:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FRESET"},topicId:b}},followedList:{pageSize:r,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FRESET"},after:d}},recommendationIndex:{actionType:{FETCH_USER:"@\u002Fview\u002Frecommendation\u002FFETCH_USER",FETCH_MORE:"@\u002Fview\u002Frecommendation\u002FFETCH_MORE",RESET:"@\u002Fview\u002Frecommendation\u002FRESET",FETCH:"@\u002Fview\u002Frecommendation\u002FFETCH"},cursor:e,hasMore:e,userList:[],loading:a,skeleton:c,category:j,categoryNavList:[]}},component:{indexAside:{bannerList:[],userList:[],actionType:{FETCH_BANNER:"@\u002Fcomponent\u002Faside\u002FFETCH_BANNER",FETCH_USER:"@\u002Fcomponent\u002Faside\u002FFETCH_USER",CLOSE_BANNER:"@\u002Fcomponent\u002Faside\u002FCLOSE_BANNER"}}},auth:{user:b,clientId:e,token:e},tag:{subscribedTagList:[]},entry:{isLikeLoading:a},collection:{},comment:{},bookComment:{},repoComment:{},category:{list:[]},user:{subscribedTagList:[]},notification:{unreadCount:{user:d,system:d,total:d}},follow:{subscribedTagList:[]},error:{location:b,errorView:b,statusCode:200},abTest:{info:{}},suspensionPanel:{needSuspension:c},pinComment:{},pin:{deleteDialogVisible:a,reportDialogVisible:a,targetPin:b,isOnFocus:a},topic:{visible:a},route:{name:"column",path:p,hash:e,query:{},params:{id:q},fullPath:p,meta:{},from:{name:b,path:s,hash:e,query:{},params:{},fullPath:s,meta:{}}}},serverRendered:c,routePath:p,config:{API_HOST:"apinew.juejin.im",CAPTCHA_HOST:"verify.snssdk.com",PLATFORM_APPID:{wechat:833,weibo:845,github:1032,wechatApp:1070}}}}(false,null,true,0,"","0",20,1,"topic","recommended","hot","following","popular","all","newest","\u002Fpost\u002F6844904205556121608","6844904205556121608",100,"\u002F"));</script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/runtime.114be94.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/layouts/default.30f8654.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/layouts.default.e3ae69c.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/16.042eec3.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/.c96a556.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/app.f6a55cd.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/vendors~app.75ea36e.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/app.6946cbd.js" defer></script>
  </body>
</html>
